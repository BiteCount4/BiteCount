<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BiteCount - Manajemen Kalori & Komunitas Anda</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* ========== VARIABLES & RESET ========== */
        :root {
            --primary-green: #10B981;
            --secondary-green: #34D399;
            --light-green: #A7F3D0;
            --dark-green: #059669;
            
            --primary-pink: #EC4899;
            --secondary-pink: #F472B6;
            --light-pink: #FBCFE8;
            
            --primary-blue: #3B82F6;
            --secondary-blue: #60A5FA;
            --light-blue: #BFDBFE;
            
            --primary-orange: #F59E0B;
            --secondary-orange: #FBBF24;
            
            --neutral-dark: #1F2937;
            --neutral-gray: #6B7280;
            --neutral-light: #F9FAFB;
            --neutral-border: #E5E7EB;
            
            --gradient-primary: linear-gradient(135deg, var(--primary-green) 0%, var(--primary-pink) 100%);
            --gradient-blue: linear-gradient(135deg, var(--primary-blue) 0%, var(--secondary-blue) 100%);
            --gradient-orange: linear-gradient(135deg, var(--primary-orange) 0%, var(--secondary-orange) 100%);
            --gradient-subtle: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(236, 72, 153, 0.1) 100%);
            
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.12);
            --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.08);
            --shadow-lg: 0 10px 25px rgba(0, 0, 0, 0.1);
            --shadow-xl: 0 20px 40px rgba(16, 185, 129, 0.15);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f0fdf4 0%, #fdf2f8 100%);
            color: var(--neutral-dark);
            line-height: 1.6;
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        /* Background decorative elements */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(16, 185, 129, 0.05) 0%, transparent 20%),
                radial-gradient(circle at 90% 30%, rgba(236, 72, 153, 0.05) 0%, transparent 20%),
                radial-gradient(circle at 50% 80%, rgba(59, 130, 246, 0.05) 0%, transparent 20%);
            z-index: -1;
        }

        /* Animated floating elements */
        .floating-element {
            position: fixed;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-green), var(--primary-pink));
            opacity: 0.1;
            z-index: -1;
            animation: float 20s infinite ease-in-out;
        }

        .floating-element:nth-child(1) {
            width: 300px;
            height: 300px;
            top: -150px;
            right: -150px;
            animation-delay: 0s;
        }

        .floating-element:nth-child(2) {
            width: 200px;
            height: 200px;
            bottom: -100px;
            left: -100px;
            animation-delay: 5s;
        }

        .floating-element:nth-child(3) {
            width: 150px;
            height: 150px;
            top: 50%;
            left: 10%;
            animation-delay: 10s;
        }

        @keyframes float {
            0%, 100% {
                transform: translateY(0) rotate(0deg);
            }
            33% {
                transform: translateY(-20px) rotate(120deg);
            }
            66% {
                transform: translateY(20px) rotate(240deg);
            }
        }

        h1, h2, h3, h4, h5, h6 {
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
            color: var(--neutral-dark);
        }

        /* ========== LOADING SCREEN ========== */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #f0fdf4 0%, #fdf2f8 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.5s, visibility 0.5s;
        }

        .loading-screen.hidden {
            opacity: 0;
            visibility: hidden;
        }

        .loading-content {
            text-align: center;
        }

        .loading-spinner {
            width: 80px;
            height: 80px;
            position: relative;
            margin: 0 auto 20px;
        }

        .spinner-circle {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            animation: spin 1.5s linear infinite;
        }

        .spinner-circle:nth-child(1) {
            border: 6px solid var(--light-green);
            border-top-color: var(--primary-green);
        }

        .spinner-circle:nth-child(2) {
            border: 6px solid var(--light-pink);
            border-top-color: var(--primary-pink);
            animation-delay: 0.2s;
            width: 70%;
            height: 70%;
            top: 15%;
            left: 15%;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* ========== LOGO DAUN TERGIGIT ========== */
        .bitten-leaf-logo {
            position: relative;
            width: 80px;
            height: 80px;
            margin: 0 auto 20px;
        }

        .leaf-container {
            position: relative;
            width: 100%;
            height: 100%;
        }

        .leaf-body {
            position: absolute;
            width: 100%;
            height: 100%;
            background: var(--primary-green);
            clip-path: polygon(50% 0%, 100% 25%, 100% 75%, 50% 100%, 0% 75%, 0% 25%);
            transform: rotate(30deg);
            animation: leaf-float 3s ease-in-out infinite;
        }

        .leaf-veins {
            position: absolute;
            width: 100%;
            height: 100%;
        }

        .leaf-vein {
            position: absolute;
            background: var(--secondary-green);
            border-radius: 2px;
        }

        .leaf-vein.main {
            width: 4px;
            height: 60px;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
        }

        .leaf-vein.secondary {
            width: 2px;
            height: 30px;
        }

        .leaf-vein:nth-child(2) {
            top: 20px;
            left: 35%;
            transform: rotate(-30deg);
        }

        .leaf-vein:nth-child(3) {
            top: 20px;
            right: 35%;
            transform: rotate(30deg);
        }

        .leaf-vein:nth-child(4) {
            top: 40px;
            left: 30%;
            transform: rotate(-45deg);
        }

        .leaf-vein:nth-child(5) {
            top: 40px;
            right: 30%;
            transform: rotate(45deg);
        }

        .bite-mark {
            position: absolute;
            width: 25px;
            height: 25px;
            background: var(--primary-pink);
            border-radius: 50%;
            top: 50%;
            right: 20px;
            transform: translateY(-50%);
            z-index: 2;
            animation: bite-pulse 2s infinite;
        }

        .bite-mark::before {
            content: '';
            position: absolute;
            width: 15px;
            height: 15px;
            background: linear-gradient(135deg, #f0fdf4 0%, #fdf2f8 100%);
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        @keyframes leaf-float {
            0%, 100% { transform: rotate(30deg) translateY(0); }
            50% { transform: rotate(30deg) translateY(-10px); }
        }

        @keyframes bite-pulse {
            0%, 100% { transform: translateY(-50%) scale(1); opacity: 0.8; }
            50% { transform: translateY(-50%) scale(1.1); opacity: 1; }
        }

        .logo-text {
            font-family: 'Poppins', sans-serif;
            font-size: 2.5rem;
            font-weight: 700;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .logo-subtext {
            color: var(--neutral-gray);
            font-size: 1rem;
            letter-spacing: 2px;
            text-transform: uppercase;
        }

        /* ========== CARDS & CONTAINERS ========== */
        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 24px;
            box-shadow: var(--shadow-lg);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .glass-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--gradient-primary);
        }

        .glass-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-xl);
            border-color: rgba(16, 185, 129, 0.3);
            background: rgba(255, 255, 255, 0.98);
        }

        .glass-card.green-accent::before {
            background: var(--primary-green);
        }

        .glass-card.pink-accent::before {
            background: var(--primary-pink);
        }

        .glass-card.blue-accent::before {
            background: var(--primary-blue);
        }

        .glass-card.orange-accent::before {
            background: var(--primary-orange);
        }

        /* ========== BUTTONS ========== */
        .btn-primary {
            background: var(--gradient-primary);
            border: none;
            border-radius: 12px;
            color: white;
            font-weight: 600;
            padding: 14px 28px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
            position: relative;
            overflow: hidden;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(16, 185, 129, 0.4);
        }

        .btn-primary:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: white;
            border: 2px solid var(--primary-green);
            border-radius: 12px;
            color: var(--primary-green);
            font-weight: 600;
            padding: 12px 24px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-secondary:hover {
            background: var(--primary-green);
            color: white;
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--neutral-border);
            border-radius: 10px;
            color: var(--neutral-gray);
            padding: 10px 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-outline:hover {
            border-color: var(--primary-green);
            color: var(--primary-green);
        }

        .btn-blue {
            background: var(--gradient-blue);
            border: none;
            border-radius: 12px;
            color: white;
            font-weight: 600;
            padding: 14px 28px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
        }

        .btn-blue:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.4);
        }

        .btn-orange {
            background: var(--gradient-orange);
            border: none;
            border-radius: 12px;
            color: white;
            font-weight: 600;
            padding: 14px 28px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(245, 158, 11, 0.3);
        }

        .btn-orange:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(245, 158, 11, 0.4);
        }

        /* ========== FLOATING ACTION BUTTON ========== */
        .fab {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--gradient-primary);
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(16, 185, 129, 0.4);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .fab:hover {
            transform: scale(1.1) rotate(90deg);
            box-shadow: 0 8px 30px rgba(16, 185, 129, 0.5);
        }

        .fab-secondary {
            bottom: 100px;
            background: var(--primary-pink);
            box-shadow: 0 4px 20px rgba(236, 72, 153, 0.4);
        }

        .fab-secondary:hover {
            box-shadow: 0 8px 30px rgba(236, 72, 153, 0.5);
        }

        .fab-tertiary {
            bottom: 170px;
            background: var(--primary-blue);
            box-shadow: 0 4px 20px rgba(59, 130, 246, 0.4);
        }

        .fab-tertiary:hover {
            box-shadow: 0 8px 30px rgba(59, 130, 246, 0.5);
        }

        /* ========== PROGRESS RING ========== */
        .progress-ring-container {
            position: relative;
            width: 200px;
            height: 200px;
            margin: 0 auto;
        }

        .progress-ring-bg {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: conic-gradient(var(--primary-green) 0%, var(--secondary-green) 50%, var(--light-green) 100%);
            mask: radial-gradient(transparent 75%, white 76%);
            -webkit-mask: radial-gradient(transparent 75%, white 76%);
        }

        .progress-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }

        .progress-text .calories {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--primary-green);
            line-height: 1;
        }

        .progress-text .label {
            font-size: 0.9rem;
            color: var(--neutral-gray);
            margin-top: 5px;
        }

        /* ========== MACRO CARDS ========== */
        .macro-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        .macro-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(5px);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .macro-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
        }

        .macro-card.protein::before {
            background: var(--primary-green);
        }

        .macro-card.carbs::before {
            background: var(--primary-pink);
        }

        .macro-card.fat::before {
            background: var(--secondary-green);
        }

        .macro-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-md);
            background: white;
        }

        .macro-icon {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .macro-value {
            font-size: 1.8rem;
            font-weight: 700;
            margin: 10px 0 5px;
        }

        .macro-label {
            font-size: 0.9rem;
            color: var(--neutral-gray);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* ========== FORM ELEMENTS ========== */
        .form-control {
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid rgba(229, 231, 235, 0.5);
            border-radius: 10px;
            padding: 14px 16px;
            font-size: 1rem;
            color: var(--neutral-dark);
            width: 100%;
            transition: all 0.3s ease;
            font-family: 'Inter', sans-serif;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-green);
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
            background: white;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--neutral-dark);
        }

        .form-group {
            margin-bottom: 20px;
        }

        /* ========== SEARCH BAR ========== */
        .search-container {
            position: relative;
            margin: 20px 0;
        }

        .search-bar {
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid rgba(229, 231, 235, 0.5);
            border-radius: 12px;
            padding: 16px 20px 16px 50px;
            font-size: 1rem;
            color: var(--neutral-dark);
            width: 100%;
            transition: all 0.3s ease;
        }

        .search-bar:focus {
            outline: none;
            border-color: var(--primary-green);
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
            background: white;
        }

        .search-icon {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--neutral-gray);
            font-size: 1.2rem;
        }

        /* ========== FOOD ITEMS ========== */
        .food-item {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 10px;
            padding: 18px;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid rgba(229, 231, 235, 0.5);
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .food-item:hover {
            transform: translateX(5px);
            border-color: var(--primary-green);
            box-shadow: var(--shadow-sm);
            background: white;
        }

        .food-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            background: var(--primary-green);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .food-item:hover::before {
            opacity: 1;
        }

        .food-item-content h5 {
            margin: 0;
            font-weight: 600;
            color: var(--neutral-dark);
        }

        .food-item-content .meta {
            font-size: 0.9rem;
            color: var(--neutral-gray);
            margin-top: 5px;
        }

        .food-calories {
            font-weight: 700;
            color: var(--primary-green);
            font-size: 1.2rem;
        }

        /* ========== TOAST NOTIFICATION ========== */
        .toast-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            color: var(--neutral-dark);
            padding: 18px 24px;
            border-radius: 12px;
            box-shadow: var(--shadow-lg);
            z-index: 9999;
            animation: slideIn 0.3s ease;
            display: none;
            border-left: 4px solid var(--primary-green);
            max-width: 350px;
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.95);
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* ========== MODAL CUSTOMIZATION ========== */
        .modal-content {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            box-shadow: var(--shadow-xl);
        }

        .modal-header {
            border-bottom: 1px solid rgba(229, 231, 235, 0.5);
            padding: 20px 30px;
        }

        .modal-header .modal-title {
            color: var(--neutral-dark);
            font-weight: 700;
        }

        .modal-body {
            padding: 30px;
        }

        .modal-footer {
            border-top: 1px solid rgba(229, 231, 235, 0.5);
            padding: 20px 30px;
        }

        /* ========== EMPTY STATE ========== */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--neutral-gray);
        }

        .empty-state i {
            font-size: 80px;
            color: var(--light-green);
            margin-bottom: 20px;
            opacity: 0.5;
        }

        /* ========== NAVIGATION ========== */
        .page {
            display: none;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .page.active {
            display: block;
            opacity: 1;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .sticky-header {
            position: sticky;
            top: 0;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            z-index: 100;
            padding: 20px 0;
            border-bottom: 1px solid rgba(229, 231, 235, 0.5);
            box-shadow: var(--shadow-sm);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* ========== BOTTOM NAVIGATION ========== */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-top: 1px solid rgba(229, 231, 235, 0.5);
            padding: 12px 20px;
            display: flex;
            justify-content: space-around;
            z-index: 999;
            box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.1);
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-decoration: none;
            color: var(--neutral-gray);
            transition: all 0.3s ease;
            padding: 8px 16px;
            border-radius: 12px;
            min-width: 70px;
        }

        .nav-item.active {
            color: var(--primary-green);
            background: rgba(16, 185, 129, 0.1);
            transform: translateY(-5px);
        }

        .nav-item i {
            font-size: 1.5rem;
            margin-bottom: 4px;
        }

        .nav-item span {
            font-size: 0.75rem;
            font-weight: 600;
        }

        .nav-item:hover {
            color: var(--primary-green);
            transform: translateY(-2px);
        }

        /* ========== CHATBOT STYLES ========== */
        .chat-message {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message-avatar {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            flex-shrink: 0;
            background: var(--gradient-subtle);
            border: 2px solid white;
            box-shadow: var(--shadow-sm);
        }

        .bot-message .message-avatar {
            background: var(--gradient-primary);
            color: white;
        }

        .user-message {
            flex-direction: row-reverse;
        }

        .user-message .message-avatar {
            background: var(--primary-pink);
            color: white;
        }

        .message-content {
            background: var(--gradient-subtle);
            border-radius: 16px;
            padding: 16px 20px;
            max-width: 70%;
            border: 1px solid rgba(229, 231, 235, 0.5);
        }

        .bot-message .message-content {
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid rgba(229, 231, 235, 0.5);
        }

        .user-message .message-content {
            background: var(--primary-pink);
            color: white;
            border: none;
        }

        .quick-reply-btn {
            display: inline-block;
            background: white;
            border: 1px solid rgba(229, 231, 235, 0.8);
            border-radius: 20px;
            padding: 8px 16px;
            margin: 5px 8px 5px 0;
            color: var(--neutral-dark);
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .quick-reply-btn:hover {
            background: var(--primary-green);
            color: white;
            border-color: var(--primary-green);
            transform: translateY(-2px);
        }

        .typing-indicator {
            display: flex;
            gap: 6px;
            padding: 10px;
        }

        .typing-indicator span {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--primary-green);
            animation: typing 1.4s infinite;
        }

        .typing-indicator span:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-indicator span:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {
            0%, 60%, 100% {
                transform: translateY(0);
                opacity: 0.7;
            }
            30% {
                transform: translateY(-10px);
                opacity: 1;
            }
        }

        /* ========== UPLOAD AREA ========== */
        .upload-area {
            border: 3px dashed rgba(229, 231, 235, 0.8);
            border-radius: 16px;
            padding: 60px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: var(--gradient-subtle);
        }

        .upload-area:hover {
            border-color: var(--primary-green);
            background: rgba(255, 255, 255, 0.95);
        }

        .upload-area.active {
            border-color: var(--primary-green);
            background: rgba(16, 185, 129, 0.05);
        }

        .file-preview {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            border: 1px solid rgba(229, 231, 235, 0.5);
        }

        .file-preview img {
            max-width: 200px;
            max-height: 150px;
            border-radius: 8px;
            border: 2px solid var(--primary-green);
        }

        /* ========== PROFILE STYLES ========== */
        .profile-picture {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid var(--primary-green);
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-md);
        }

        .profile-picture:hover {
            transform: scale(1.05);
            box-shadow: 0 0 25px rgba(16, 185, 129, 0.3);
        }

        .profile-picture-lg {
            width: 140px;
            height: 140px;
            border-radius: 50%;
            object-fit: cover;
            border: 4px solid var(--primary-green);
            box-shadow: var(--shadow-lg);
        }

        .profile-info {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 30px;
        }

        .profile-details {
            flex: 1;
        }

        .profile-badge {
            display: inline-block;
            background: var(--gradient-primary);
            color: white;
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            margin-top: 8px;
        }

        .edit-profile-btn {
            background: white;
            border: 2px solid rgba(229, 231, 235, 0.8);
            border-radius: 8px;
            color: var(--neutral-dark);
            padding: 8px 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .edit-profile-btn:hover {
            border-color: var(--primary-green);
            color: var(--primary-green);
            transform: translateY(-2px);
        }

        /* ========== SOCIAL & COMMUNITY STYLES ========== */
        .social-post {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid rgba(229, 231, 235, 0.5);
            transition: all 0.3s ease;
        }

        .social-post:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
            border-color: rgba(16, 185, 129, 0.2);
        }

        .post-header {
            display: flex;
            align-items: center;
            margin-bottom: 16px;
        }

        .post-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
            margin-right: 12px;
            border: 2px solid var(--primary-green);
        }

        .post-user-info h6 {
            margin: 0;
            font-weight: 600;
        }

        .post-user-info .time {
            font-size: 0.8rem;
            color: var(--neutral-gray);
        }

        .post-content {
            margin-bottom: 16px;
        }

        .post-stats {
            display: flex;
            gap: 20px;
            margin-bottom: 12px;
        }

        .post-stat {
            display: flex;
            align-items: center;
            gap: 6px;
            color: var(--neutral-gray);
            font-size: 0.9rem;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .post-stat:hover {
            color: var(--primary-green);
        }

        .post-stat.active {
            color: var(--primary-pink);
        }

        .post-actions {
            display: flex;
            gap: 10px;
            padding-top: 12px;
            border-top: 1px solid rgba(229, 231, 235, 0.5);
        }

        .action-btn {
            flex: 1;
            background: transparent;
            border: 1px solid rgba(229, 231, 235, 0.8);
            border-radius: 8px;
            padding: 8px;
            color: var(--neutral-gray);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            font-size: 0.9rem;
        }

        .action-btn:hover {
            background: rgba(16, 185, 129, 0.1);
            color: var(--primary-green);
            border-color: var(--primary-green);
        }

        .action-btn.active {
            background: rgba(16, 185, 129, 0.1);
            color: var(--primary-green);
            border-color: var(--primary-green);
        }

        .achievement-badge {
            background: linear-gradient(135deg, var(--primary-orange), var(--secondary-orange));
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
            font-size: 0.85rem;
            margin: 5px;
        }

        .challenge-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid rgba(229, 231, 235, 0.5);
            transition: all 0.3s ease;
        }

        .challenge-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .challenge-progress {
            height: 8px;
            background: rgba(229, 231, 235, 0.5);
            border-radius: 4px;
            margin: 15px 0;
            overflow: hidden;
        }

        .challenge-progress-bar {
            height: 100%;
            background: var(--gradient-primary);
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        .friend-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .friend-item {
            display: flex;
            align-items: center;
            padding: 12px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 12px;
            border: 1px solid rgba(229, 231, 235, 0.5);
            transition: all 0.3s ease;
        }

        .friend-item:hover {
            transform: translateX(5px);
            border-color: var(--primary-green);
            box-shadow: var(--shadow-sm);
        }

        .friend-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
            margin-right: 12px;
            border: 2px solid var(--primary-green);
        }

        .friend-info {
            flex: 1;
        }

        .friend-info h6 {
            margin: 0;
            font-weight: 600;
        }

        .friend-info .streak {
            font-size: 0.8rem;
            color: var(--primary-orange);
            font-weight: 600;
        }

        .friend-status {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--secondary-green);
        }

        .friend-status.offline {
            background: var(--neutral-gray);
        }

        .group-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid rgba(229, 231, 235, 0.5);
            transition: all 0.3s ease;
        }

        .group-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .group-members {
            display: flex;
            margin-top: 15px;
        }

        .group-member {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid white;
            margin-left: -10px;
        }

        .group-member:first-child {
            margin-left: 0;
        }

        .leaderboard-item {
            display: flex;
            align-items: center;
            padding: 15px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            margin-bottom: 10px;
            border: 1px solid rgba(229, 231, 235, 0.5);
            transition: all 0.3s ease;
        }

        .leaderboard-item:hover {
            transform: translateX(5px);
            border-color: var(--primary-green);
            box-shadow: var(--shadow-sm);
        }

        .leaderboard-rank {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--gradient-primary);
            color: white;
            font-weight: 700;
            font-size: 1.2rem;
            margin-right: 15px;
        }

        .leaderboard-rank.gold {
            background: linear-gradient(135deg, #FFD700, #FFA500);
        }

        .leaderboard-rank.silver {
            background: linear-gradient(135deg, #C0C0C0, #808080);
        }

        .leaderboard-rank.bronze {
            background: linear-gradient(135deg, #CD7F32, #8B4513);
        }

        /* ========== RESPONSIVE DESIGN ========== */
        @media (max-width: 768px) {
            .glass-card {
                padding: 20px;
            }
            
            .macro-grid {
                grid-template-columns: 1fr;
                gap: 12px;
            }
            
            .progress-ring-container {
                width: 180px;
                height: 180px;
            }
            
            .progress-text .calories {
                font-size: 2rem;
            }
            
            .fab {
                width: 56px;
                height: 56px;
                bottom: 80px;
                right: 20px;
            }
            
            .fab-secondary {
                bottom: 150px;
            }
            
            .fab-tertiary {
                bottom: 220px;
            }
            
            .message-content {
                max-width: 85%;
            }
            
            .modal-body {
                padding: 20px;
            }
            
            .bottom-nav {
                padding: 10px 15px;
            }
            
            .nav-item {
                min-width: 60px;
                padding: 6px 12px;
            }
            
            .nav-item i {
                font-size: 1.2rem;
            }
            
            .nav-item span {
                font-size: 0.7rem;
            }
        }

        @media (max-width: 480px) {
            .header-content {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }
            
            .profile-info {
                flex-direction: column;
                text-align: center;
                gap: 15px;
            }
            
            .food-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .food-calories {
                align-self: flex-end;
            }
            
            .post-actions {
                flex-wrap: wrap;
            }
            
            .action-btn {
                min-width: calc(50% - 5px);
            }
        }

        /* ========== UTILITY CLASSES ========== */
        .text-gradient {
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            font-weight: 700;
        }

        .text-gradient-blue {
            background: var(--gradient-blue);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            font-weight: 700;
        }

        .text-gradient-orange {
            background: var(--gradient-orange);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            font-weight: 700;
        }

        .bg-gradient {
            background: var(--gradient-primary);
        }

        .text-green {
            color: var(--primary-green);
        }

        .text-pink {
            color: var(--primary-pink);
        }

        .text-blue {
            color: var(--primary-blue);
        }

        .text-orange {
            color: var(--primary-orange);
        }

        .bg-green {
            background-color: var(--primary-green);
        }

        .bg-pink {
            background-color: var(--primary-pink);
        }

        .bg-blue {
            background-color: var(--primary-blue);
        }

        .bg-orange {
            background-color: var(--primary-orange);
        }

        .shadow-lg {
            box-shadow: var(--shadow-lg);
        }

        .mb-4 {
            margin-bottom: 1.5rem;
        }

        .mt-4 {
            margin-top: 1.5rem;
        }

        .text-center {
            text-align: center;
        }

        .d-flex {
            display: flex;
        }

        .align-items-center {
            align-items: center;
        }

        .justify-content-between {
            justify-content: space-between;
        }

        .gap-2 {
            gap: 0.5rem;
        }

        .gap-3 {
            gap: 1rem;
        }

        .w-100 {
            width: 100%;
        }

        /* ========== SPECIFIC COMPONENTS ========== */
        .welcome-hero {
            text-align: center;
            margin-bottom: 40px;
        }

        .dashboard-summary {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 25px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .chat-container {
            height: 60vh;
            overflow-y: auto;
            padding: 20px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 16px;
            border: 1px solid rgba(229, 231, 235, 0.5);
            scroll-behavior: smooth;
        }

        .chat-input-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 15px;
            border: 1px solid rgba(229, 231, 235, 0.5);
            margin-top: 15px;
        }

        .nutrition-tip {
            background: var(--gradient-subtle);
            border-left: 4px solid var(--primary-green);
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }

        .food-recommendation {
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid rgba(229, 231, 235, 0.5);
            border-radius: 12px;
            padding: 15px;
            margin: 10px 0;
        }

        .community-section {
            margin-bottom: 30px;
        }

        /* Mini leaf logo for headers */
        .mini-leaf {
            display: inline-block;
            width: 24px;
            height: 24px;
            background: var(--primary-green);
            clip-path: polygon(50% 0%, 100% 25%, 100% 75%, 50% 100%, 0% 75%, 0% 25%);
            transform: rotate(30deg);
            position: relative;
            margin-right: 10px;
        }

        .mini-leaf::after {
            content: '';
            position: absolute;
            width: 8px;
            height: 8px;
            background: var(--primary-pink);
            border-radius: 50%;
            top: 50%;
            right: 5px;
            transform: translateY(-50%);
        }
    </style>
</head>
<body>
    <!-- Floating background elements -->
    <div class="floating-element"></div>
    <div class="floating-element"></div>
    <div class="floating-element"></div>

    <!-- Loading Screen -->
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-content">
            <div class="bitten-leaf-logo">
                <div class="leaf-container">
                    <div class="leaf-body"></div>
                    <div class="leaf-veins">
                        <div class="leaf-vein main"></div>
                        <div class="leaf-vein secondary"></div>
                        <div class="leaf-vein secondary"></div>
                        <div class="leaf-vein secondary"></div>
                        <div class="leaf-vein secondary"></div>
                    </div>
                    <div class="bite-mark"></div>
                </div>
            </div>
            <h3 class="logo-text mb-2">BiteCount</h3>
            <p class="text-muted">Memuat aplikasi...</p>
        </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast-notification" id="toast">
        <div class="d-flex align-items-center">
            <i class="fas fa-check-circle text-green me-3" style="font-size: 1.5rem;"></i>
            <div>
                <strong id="toastTitle">Sukses!</strong>
                <p id="toastMessage" class="mb-0"></p>
            </div>
        </div>
    </div>

    <!-- Page: Welcome -->
    <div class="page active" id="welcomePage">
        <div class="container py-5" style="max-width: 800px;">
            <div class="welcome-hero">
                <div class="bitten-leaf-logo" style="width: 100px; height: 100px; margin-bottom: 20px;">
                    <div class="leaf-container">
                        <div class="leaf-body"></div>
                        <div class="leaf-veins">
                            <div class="leaf-vein main"></div>
                            <div class="leaf-vein secondary"></div>
                            <div class="leaf-vein secondary"></div>
                            <div class="leaf-vein secondary"></div>
                            <div class="leaf-vein secondary"></div>
                        </div>
                        <div class="bite-mark"></div>
                    </div>
                </div>
                <h1 class="logo-text">BiteCount</h1>
                <p class="lead">Kelola kalori Anda dengan mudah dan efektif</p>
                <p class="logo-subtext">Health • Balance • Progress • Community</p>
            </div>

            <div class="glass-card">
                <h3 class="mb-4 text-center">Profil Diri Anda</h3>
                <p class="text-center text-muted mb-4">Isi data Anda untuk mendapatkan rekomendasi yang personal</p>
                
                <form id="profileForm">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="form-label">Nama Lengkap</label>
                                <input type="text" class="form-control" id="userName" required placeholder="Masukkan nama Anda">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="form-label">Jenis Kelamin</label>
                                <select class="form-control" id="gender" required>
                                    <option value="">Pilih jenis kelamin</option>
                                    <option value="male">Pria</option>
                                    <option value="female">Wanita</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="form-label">Usia (tahun)</label>
                                <input type="number" class="form-control" id="age" required min="10" max="100" placeholder="25">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="form-label">Tinggi Badan (cm)</label>
                                <input type="number" class="form-control" id="height" required min="100" max="250" placeholder="170">
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="form-label">Berat Badan (kg)</label>
                                <input type="number" class="form-control" id="weight" required min="30" max="300" placeholder="70">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="form-label">Tingkat Aktivitas</label>
                                <select class="form-control" id="activity" required>
                                    <option value="">Pilih tingkat aktivitas</option>
                                    <option value="1.2">Sangat Sedentari (jarang olahraga)</option>
                                    <option value="1.375">Sedikit Aktif (olahraga ringan 1-3x/minggu)</option>
                                    <option value="1.55">Cukup Aktif (olahraga sedang 3-5x/minggu)</option>
                                    <option value="1.725">Sangat Aktif (olahraga berat 6-7x/minggu)</option>
                                    <option value="1.9">Ekstra Aktif (atlet atau kerja fisik berat)</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Target Utama</label>
                        <select class="form-control" id="goal" required>
                            <option value="">Pilih target Anda</option>
                            <option value="deficit">Turunkan Berat Badan (Kalori Defisit)</option>
                            <option value="maintain">Pertahankan Berat Badan</option>
                            <option value="surplus">Naikkan Berat Badan/Massa Otot</option>
                        </select>
                    </div>

                    <button type="submit" class="btn-primary w-100 mt-4">
                        <i class="fas fa-rocket me-2"></i>Mulai Perjalanan Sehat
                    </button>

                    <div class="text-center mt-4">
                        <button type="button" class="btn-secondary" onclick="showWelcomeChatbot()">
                            <i class="fas fa-robot me-2"></i>Tanya NutriBot AI
                        </button>
                    </div>
                </form>
            </div>

            <div class="text-center mt-4">
                <p class="text-muted">
                    <small>Dengan mendaftar, Anda menyetujui kebijakan privasi kami</small>
                </p>
            </div>
        </div>
    </div>

    <!-- Page: Dashboard -->
    <div class="page" id="dashboardPage">
        <div class="sticky-header">
            <div class="container">
                <div class="header-content">
                    <div class="d-flex align-items-center gap-3">
                        <div class="bitten-leaf-logo" style="width: 40px; height: 40px;">
                            <div class="leaf-container">
                                <div class="leaf-body"></div>
                                <div class="leaf-veins">
                                    <div class="leaf-vein main"></div>
                                    <div class="leaf-vein secondary"></div>
                                    <div class="leaf-vein secondary"></div>
                                </div>
                                <div class="bite-mark"></div>
                            </div>
                        </div>
                        <div>
                            <h4 class="mb-0">BiteCount</h4>
                            <small class="text-muted">Dashboard Nutrisi</small>
                        </div>
                    </div>
                    <div class="d-flex align-items-center gap-2">
                        <button class="edit-profile-btn" onclick="showSettings()">
                            <i class="fas fa-cog"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="container py-4">
            <!-- User Profile Section -->
            <div class="dashboard-summary">
                <div class="profile-info">
                    <div class="position-relative">
                        <img id="userProfileImage" 
                             src="https://ui-avatars.com/api/?name=User&background=10B981&color=fff&size=128" 
                             class="profile-picture"
                             onclick="showEditProfileModal()">
                        <span class="position-absolute bottom-0 end-0 bg-green border border-3 border-white rounded-circle" 
                              style="width: 16px; height: 16px;"></span>
                    </div>
                    <div class="profile-details">
                        <h4 class="mb-1" id="displayName">User</h4>
                        <div class="d-flex align-items-center gap-2 flex-wrap">
                            <span class="profile-badge" id="userGoalBadge">
                                <i class="fas fa-bullseye me-1"></i>Target: Turunkan Berat
                            </span>
                            <button class="edit-profile-btn" onclick="showEditProfileModal()">
                                <i class="fas fa-edit"></i> Edit Profil
                            </button>
                        </div>
                        <p class="text-muted small mb-0 mt-2" id="userBio">Belum ada bio</p>
                    </div>
                </div>

                <div class="mt-4">
                    <div class="progress-ring-container">
                        <div class="progress-ring-bg" id="progressRing"></div>
                        <div class="progress-text">
                            <div class="calories" id="remainingCalories">0</div>
                            <div class="label">kkal tersisa hari ini</div>
                        </div>
                    </div>

                    <div class="macro-grid">
                        <div class="macro-card protein">
                            <div class="macro-icon">🥩</div>
                            <div class="macro-value" id="proteinValue">0</div>
                            <div class="macro-label">Protein (g)</div>
                        </div>
                        <div class="macro-card carbs">
                            <div class="macro-icon">🍚</div>
                            <div class="macro-value" id="carbValue">0</div>
                            <div class="macro-label">Karbo (g)</div>
                        </div>
                        <div class="macro-card fat">
                            <div class="macro-icon">🥑</div>
                            <div class="macro-value" id="fatValue">0</div>
                            <div class="macro-label">Lemak (g)</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quick Community Stats -->
            <div class="glass-card mb-4">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h5 class="mb-0">Komunitas Hari Ini</h5>
                    <button class="btn-outline btn-sm" onclick="showCommunity()">
                        <i class="fas fa-users me-1"></i> Lihat Semua
                    </button>
                </div>
                <div class="row">
                    <div class="col-4 text-center">
                        <div class="macro-value text-blue" id="communityPosts">0</div>
                        <div class="macro-label">Postingan</div>
                    </div>
                    <div class="col-4 text-center">
                        <div class="macro-value text-pink" id="communityLikes">0</div>
                        <div class="macro-label">Like</div>
                    </div>
                    <div class="col-4 text-center">
                        <div class="macro-value text-orange" id="communityFriends">0</div>
                        <div class="macro-label">Teman</div>
                    </div>
                </div>
            </div>

            <!-- Search and Food Log -->
            <div class="glass-card mb-4">
                <div class="search-container">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" class="search-bar" id="searchFood" placeholder="Cari makanan atau minuman...">
                </div>
                <div id="searchResults" class="mt-3"></div>
            </div>

            <div class="glass-card">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h5 class="mb-0">Riwayat Makan Hari Ini</h5>
                    <span class="badge bg-green" id="totalItems">0 item</span>
                </div>
                <div id="foodHistory">
                    <div class="empty-state">
                        <i class="fas fa-utensils"></i>
                        <h5>Belum ada makanan tercatat</h5>
                        <p class="mb-3">Mulai tambahkan makanan pertama Anda!</p>
                        <button class="btn-primary" onclick="showAddFoodModal()">
                            <i class="fas fa-plus me-2"></i>Tambah Makanan
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Floating Action Buttons -->
        <button class="fab" onclick="showAddFoodModal()">
            <i class="fas fa-plus"></i>
        </button>

        <button class="fab fab-secondary" onclick="showChatbot()">
            <i class="fas fa-robot"></i>
        </button>

        <button class="fab fab-tertiary" onclick="showCommunity()">
            <i class="fas fa-users"></i>
        </button>
    </div>

    <!-- Page: Community -->
    <div class="page" id="communityPage">
        <div class="sticky-header">
            <div class="container">
                <div class="header-content">
                    <div class="d-flex align-items-center gap-3">
                        <div class="bitten-leaf-logo" style="width: 40px; height: 40px;">
                            <div class="leaf-container">
                                <div class="leaf-body"></div>
                                <div class="leaf-veins">
                                    <div class="leaf-vein main"></div>
                                    <div class="leaf-vein secondary"></div>
                                    <div class="leaf-vein secondary"></div>
                                </div>
                                <div class="bite-mark"></div>
                            </div>
                        </div>
                        <div>
                            <h4 class="mb-0">Komunitas BiteCount</h4>
                            <small class="text-muted">Berbagi dan tumbuh bersama</small>
                        </div>
                    </div>
                    <button class="btn-outline" onclick="showDashboard()">
                        <i class="fas fa-arrow-left me-2"></i>Kembali
                    </button>
                </div>
            </div>
        </div>

        <div class="container py-4">
            <!-- Create Post -->
            <div class="glass-card mb-4">
                <div class="post-header">
                    <img id="userProfileImageCommunity" 
                         src="https://ui-avatars.com/api/?name=User&background=10B981&color=fff&size=128" 
                         class="post-avatar">
                    <div class="post-user-info">
                        <h6 id="communityUserName">User</h6>
                        <div class="time">Bagikan pencapaian Anda...</div>
                    </div>
                </div>
                <textarea class="form-control mb-3" id="newPostContent" rows="3" placeholder="Apa yang ingin Anda bagikan hari ini?"></textarea>
                <div class="d-flex justify-content-between">
                    <div class="d-flex gap-2">
                        <button class="action-btn" onclick="addPostImage()">
                            <i class="fas fa-image"></i> Foto
                        </button>
                        <button class="action-btn" onclick="addAchievement()">
                            <i class="fas fa-trophy"></i> Pencapaian
                        </button>
                        <button class="action-btn" onclick="addFoodToPost()">
                            <i class="fas fa-utensils"></i> Makanan
                        </button>
                    </div>
                    <button class="btn-primary" onclick="createNewPost()">
                        <i class="fas fa-paper-plane me-2"></i>Posting
                    </button>
                </div>
            </div>

            <!-- Community Tabs -->
            <div class="mb-4">
                <div class="d-flex overflow-auto pb-2">
                    <button class="action-btn me-2 active" onclick="switchCommunityTab('feed')" id="tabFeed">
                        <i class="fas fa-home me-1"></i> Feed
                    </button>
                    <button class="action-btn me-2" onclick="switchCommunityTab('challenges')" id="tabChallenges">
                        <i class="fas fa-flag me-1"></i> Tantangan
                    </button>
                    <button class="action-btn me-2" onclick="switchCommunityTab('leaderboard')" id="tabLeaderboard">
                        <i class="fas fa-trophy me-1"></i> Peringkat
                    </button>
                    <button class="action-btn me-2" onclick="switchCommunityTab('groups')" id="tabGroups">
                        <i class="fas fa-users me-1"></i> Grup
                    </button>
                    <button class="action-btn" onclick="switchCommunityTab('friends')" id="tabFriends">
                        <i class="fas fa-user-friends me-1"></i> Teman
                    </button>
                </div>
            </div>

            <!-- Feed Content -->
            <div id="communityFeed" class="community-section">
                <div class="text-center">
                    <div class="spinner-border text-green" role="status">
                        <span class="visually-hidden">Memuat...</span>
                    </div>
                    <p class="mt-2">Memuat postingan komunitas...</p>
                </div>
            </div>

            <!-- Challenges Content -->
            <div id="communityChallenges" class="community-section" style="display: none;">
                <h5 class="mb-3">Tantangan Aktif</h5>
                <div id="challengesList">
                    <!-- Challenges will be loaded here -->
                </div>
                <button class="btn-primary w-100 mt-3" onclick="showChallengeModal()">
                    <i class="fas fa-plus me-2"></i>Buat Tantangan Baru
                </button>
            </div>

            <!-- Leaderboard Content -->
            <div id="communityLeaderboard" class="community-section" style="display: none;">
                <h5 class="mb-3">Peringkat Mingguan</h5>
                <div id="leaderboardList">
                    <!-- Leaderboard will be loaded here -->
                </div>
            </div>

            <!-- Groups Content -->
            <div id="communityGroups" class="community-section" style="display: none;">
                <h5 class="mb-3">Grup Populer</h5>
                <div id="groupsList">
                    <!-- Groups will be loaded here -->
                </div>
                <button class="btn-blue w-100 mt-3" onclick="showGroupModal()">
                    <i class="fas fa-plus me-2"></i>Buat Grup Baru
                </button>
            </div>

            <!-- Friends Content -->
            <div id="communityFriends" class="community-section" style="display: none;">
                <h5 class="mb-3">Teman & Koneksi</h5>
                <div class="friend-list" id="friendsList">
                    <!-- Friends will be loaded here -->
                </div>
                <button class="btn-outline w-100 mt-3" onclick="showAddFriendModal()">
                    <i class="fas fa-user-plus me-2"></i>Tambah Teman
                </button>
            </div>
        </div>
    </div>

    <!-- Page: Chatbot -->
    <div class="page" id="chatbotPage">
        <div class="container py-4" style="max-width: 900px;">
            <div class="sticky-header">
                <div class="container">
                    <div class="header-content">
                        <div class="d-flex align-items-center gap-3">
                            <div class="bitten-leaf-logo" style="width: 40px; height: 40px;">
                                <div class="leaf-container">
                                    <div class="leaf-body"></div>
                                    <div class="leaf-veins">
                                        <div class="leaf-vein main"></div>
                                        <div class="leaf-vein secondary"></div>
                                        <div class="leaf-vein secondary"></div>
                                    </div>
                                    <div class="bite-mark"></div>
                                </div>
                            </div>
                            <div>
                                <h4 class="mb-0">NutriBot AI</h4>
                                <small class="text-muted">Asisten nutrisi personal Anda</small>
                            </div>
                        </div>
                        <button class="btn-outline" onclick="closeChatbot()">
                            <i class="fas fa-times me-2"></i>Tutup
                        </button>
                    </div>
                </div>
            </div>

            <div class="chat-container" id="chatContainer">
                <div class="chat-message bot-message">
                    <div class="message-avatar">
                        <i class="fas fa-robot"></i>
                    </div>
                    <div class="message-content">
                        <strong class="text-gradient">NutriBot</strong>
                        <p class="mt-2 mb-3">Halo! 👋 Saya NutriBot, asisten nutrisi pintar Anda! 🌟</p>
                        
                        <div class="nutrition-tip">
                            <p class="mb-2"><strong>✨ Yang bisa saya bantu:</strong></p>
                            <ul class="mb-0">
                                <li>🔢 <strong>Hitung kalori</strong> untuk makanan/minuman</li>
                                <li>📸 <strong>Analisis gambar</strong> makanan & estimasi kalori</li>
                                <li>📄 <strong>Analisis dokumen</strong> label nutrisi & resep</li>
                                <li>💡 <strong>Rekomendasi makanan</strong> sesuai target Anda</li>
                                <li>🥗 <strong>Saran menu harian</strong> yang seimbang</li>
                            </ul>
                        </div>
                        
                        <p class="mt-3">Coba hitung kalori makanan:</p>
                        <div>
                            <button class="quick-reply-btn" onclick="sendQuickReply('100 gram nasi')">
                                🍚 100 gram nasi
                            </button>
                            <button class="quick-reply-btn" onclick="sendQuickReply('2 butir telur')">
                                🥚 2 butir telur
                            </button>
                            <button class="quick-reply-btn" onclick="sendQuickReply('1 porsi ayam goreng')">
                                🍗 1 porsi ayam
                            </button>
                            <button class="quick-reply-btn" onclick="sendQuickReply('200 ml susu')">
                                🥛 200 ml susu
                            </button>
                        </div>
                        
                        <p class="mt-3">Atau coba fitur lainnya:</p>
                        <div>
                            <button class="quick-reply-btn" onclick="showImageUploadModal()">
                                <i class="fas fa-image me-1"></i> Upload Gambar Makanan
                            </button>
                            <button class="quick-reply-btn" onclick="showDocumentUpload()">
                                <i class="fas fa-file-alt me-1"></i> Upload Dokumen
                            </button>
                            <button class="quick-reply-btn" onclick="sendQuickReply('Rekomendasi makanan sehat')">
                                <i class="fas fa-utensils me-1"></i> Rekomendasi Makanan
                            </button>
                            <button class="quick-reply-btn" onclick="sendQuickReply('Daftar makanan dalam database')">
                                <i class="fas fa-list me-1"></i> Database Makanan
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="chat-input-container">
                <div class="d-flex gap-3">
                    <button class="btn-outline" onclick="showImageUploadModal()" title="Upload File">
                        <i class="fas fa-paperclip"></i>
                    </button>
                    <input type="text" class="form-control" id="chatInput" placeholder="Contoh: 100 gram nasi, 2 butir telur, 1 porsi ayam...">
                    <button class="btn-primary" onclick="sendMessage()" style="padding: 14px 24px;">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Page: Settings -->
    <div class="page" id="settingsPage">
        <div class="container py-4" style="max-width: 800px;">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <button class="btn-outline" onclick="showDashboard()">
                    <i class="fas fa-arrow-left me-2"></i>Kembali ke Dashboard
                </button>
                <h4 class="mb-0">Pengaturan</h4>
            </div>

            <div class="glass-card">
                <h4 class="mb-4">Profil & Preferensi</h4>
                
                <div class="profile-info mb-4">
                    <img id="settingsProfileImage" 
                         src="https://ui-avatars.com/api/?name=User&background=10B981&color=fff&size=128" 
                         class="profile-picture-lg">
                    <div class="profile-details">
                        <h5 id="settingsUserName">User</h5>
                        <p class="text-muted" id="settingsUserEmail">user@example.com</p>
                        <div class="d-flex gap-2">
                            <button class="edit-profile-btn" onclick="showEditProfileModal()">
                                <i class="fas fa-edit"></i> Edit Profil
                            </button>
                            <button class="btn-outline" onclick="changeProfilePicture()">
                                <i class="fas fa-camera"></i> Ganti Foto
                            </button>
                        </div>
                    </div>
                </div>

                <div class="dashboard-summary mb-4">
                    <h5 class="mb-3">Informasi Nutrisi</h5>
                    <div class="row">
                        <div class="col-md-4">
                            <div class="text-center p-3">
                                <div class="macro-value text-green" id="settingCalories">0</div>
                                <div class="macro-label">Target Kalori Harian</div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="text-center p-3">
                                <div class="macro-value text-pink" id="settingBMR">0</div>
                                <div class="macro-label">BMR (Basal Metabolic Rate)</div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="text-center p-3">
                                <div class="macro-value text-gradient" id="settingTDEE">0</div>
                                <div class="macro-label">TDEE (Total Daily Expenditure)</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="mt-4">
                    <h5 class="mb-3">Pengaturan Aplikasi</h5>
                    <div class="form-group">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="notificationsSwitch" checked>
                            <label class="form-check-label" for="notificationsSwitch">Aktifkan notifikasi harian</label>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="darkModeSwitch">
                            <label class="form-check-label" for="darkModeSwitch">Mode gelap</label>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="communitySwitch" checked>
                            <label class="form-check-label" for="communitySwitch">Aktifkan fitur komunitas</label>
                        </div>
                    </div>
                </div>

                <div class="mt-5 pt-4 border-top">
                    <div class="text-center">
                        <button class="btn-outline me-3" onclick="exportData()">
                            <i class="fas fa-download me-2"></i>Ekspor Data
                        </button>
                        <button class="btn-primary" onclick="resetApp()">
                            <i class="fas fa-redo me-2"></i>Reset Aplikasi
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bottom Navigation -->
    <div class="bottom-nav">
        <a href="#" class="nav-item active" onclick="showDashboard(); return false;">
            <i class="fas fa-home"></i>
            <span>Home</span>
        </a>
        <a href="#" class="nav-item" onclick="showCommunity(); return false;">
            <i class="fas fa-users"></i>
            <span>Komunitas</span>
        </a>
        <a href="#" class="nav-item" onclick="showChatbot(); return false;">
            <i class="fas fa-robot"></i>
            <span>AI Assistant</span>
        </a>
        <a href="#" class="nav-item" onclick="showSettings(); return false;">
            <i class="fas fa-cog"></i>
            <span>Pengaturan</span>
        </a>
    </div>

    <!-- Modal: Add Food -->
    <div class="modal fade" id="addFoodModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-utensils me-2"></i>Tambah Makanan/Minuman</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-8">
                            <div class="form-group">
                                <label class="form-label">Nama Makanan/Minuman</label>
                                <input type="text" class="form-control" id="foodName" placeholder="Contoh: Nasi Goreng Special">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group">
                                <label class="form-label">Kalori (kkal)</label>
                                <input type="number" class="form-control" id="foodCalories" placeholder="300">
                            </div>
                        </div>
                    </div>

                    <div class="row mt-3">
                        <div class="col-md-4">
                            <div class="form-group">
                                <label class="form-label">Protein (gram)</label>
                                <input type="number" class="form-control" id="foodProtein" placeholder="15">
                                <small class="text-muted">Rekomendasi: 20-30% total kalori</small>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group">
                                <label class="form-label">Karbohidrat (gram)</label>
                                <input type="number" class="form-control" id="foodCarb" placeholder="45">
                                <small class="text-muted">Rekomendasi: 40-50% total kalori</small>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group">
                                <label class="form-label">Lemak (gram)</label>
                                <input type="number" class="form-control" id="foodFat" placeholder="10">
                                <small class="text-muted">Rekomendasi: 20-30% total kalori</small>
                            </div>
                        </div>
                    </div>

                    <div class="form-group mt-3">
                        <label class="form-label">Porsi (opsional)</label>
                        <input type="text" class="form-control" id="foodPortion" placeholder="Contoh: 1 piring sedang, 2 potong, etc.">
                    </div>

                    <div class="form-group mt-3">
                        <label class="form-label">Waktu Makan</label>
                        <select class="form-control" id="foodTime">
                            <option value="Sarapan">Sarapan</option>
                            <option value="Makan Siang" selected>Makan Siang</option>
                            <option value="Makan Malam">Makan Malam</option>
                            <option value="Cemilan">Cemilan</option>
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn-outline" data-bs-dismiss="modal">Batal</button>
                    <button type="button" class="btn-primary" onclick="addFood()">
                        <i class="fas fa-plus me-2"></i>Tambahkan
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal: Welcome Chatbot -->
    <div class="modal fade" id="welcomeChatbotModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-robot me-2"></i>NutriBot AI - Asisten Nutrisi Anda</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" style="height: 600px; overflow: hidden; display: flex; flex-direction: column;">
                    <div class="chat-container" id="welcomeChatContainer" style="flex: 1;">
                        <div class="chat-message bot-message">
                            <div class="message-avatar">
                                <i class="fas fa-robot"></i>
                            </div>
                            <div class="message-content">
                                <strong class="text-gradient">NutriBot</strong>
                                <p class="mt-2">Halo! 👋 Saya NutriBot, asisten nutrisi pintar Anda!</p>
                                
                                <div class="nutrition-tip">
                                    <p class="mb-2"><strong>🎯 Sebelum memulai, saya bisa membantu dengan:</strong></p>
                                    <ul class="mb-0">
                                        <li>🧮 <strong>Menghitung kebutuhan kalori</strong> harian Anda</li>
                                        <li>📊 <strong>Menentukan target</strong> yang realistis dan sehat</li>
                                        <li>💡 <strong>Memberikan tips nutrisi</strong> dasar untuk pemula</li>
                                        <li>📸 <strong>Analisis foto makanan</strong> (upload gambar)</li>
                                        <li>📄 <strong>Analisis dokumen nutrisi</strong> & label makanan</li>
                                    </ul>
                                </div>
                                
                                <p class="mt-3">Apa yang ingin Anda ketahui?</p>
                                <div>
                                    <button class="quick-reply-btn" onclick="sendWelcomeQuickReply('Bagaimana cara menghitung kebutuhan kalori?')">
                                        🧮 Cara Hitung Kalori
                                    </button>
                                    <button class="quick-reply-btn" onclick="sendWelcomeQuickReply('Tips diet sehat untuk pemula')">
                                        💡 Tips Diet Pemula
                                    </button>
                                    <button class="quick-reply-btn" onclick="showImageUploadModal()">
                                        📸 Upload Foto Makanan
                                    </button>
                                    <button class="quick-reply-btn" onclick="sendWelcomeQuickReply('Apa itu BMR dan TDEE?')">
                                        📊 Penjelasan BMR & TDEE
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="chat-input-container mt-3">
                        <div class="d-flex gap-3">
                            <button class="btn-outline" onclick="showImageUploadModal()" title="Upload Gambar">
                                <i class="fas fa-image"></i>
                            </button>
                            <input type="text" class="form-control" id="welcomeChatInput" placeholder="Tanya apa saja tentang nutrisi dan diet...">
                            <button class="btn-primary" onclick="sendWelcomeMessage()" style="padding: 12px 20px;">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal: Upload Gambar/Dokumen -->
    <div class="modal fade" id="uploadModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-file-upload me-2"></i>Upload File untuk Analisis</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="text-center mb-4">
                        <div class="upload-area" id="uploadArea">
                            <i class="fas fa-cloud-upload-alt" style="font-size: 48px; color: var(--primary-green); margin-bottom: 15px;"></i>
                            <h5>Drag & Drop File di sini</h5>
                            <p class="text-muted">atau klik untuk memilih file dari perangkat Anda</p>
                            <p class="small text-muted mt-2">
                                <i class="fas fa-info-circle me-1"></i>
                                Maksimum: 5MB per file • Format: JPG, PNG, PDF, DOC
                            </p>
                        </div>
                        <input type="file" id="fileInput" accept="image/*,.pdf,.txt,.doc,.docx,.png,.jpg,.jpeg" hidden>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Jenis Analisis:</label>
                        <select class="form-control" id="analysisType">
                            <option value="nutrition">Analisis Nutrisi & Estimasi Kalori</option>
                            <option value="label">Analisis Label Makanan</option>
                            <option value="recipe">Analisis Resep & Komposisi</option>
                            <option value="general">Analisis Umum Gambar Makanan</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Keterangan Tambahan (opsional):</label>
                        <textarea class="form-control" id="fileDescription" rows="3" placeholder="Deskripsi singkat tentang file ini..."></textarea>
                    </div>
                    
                    <div id="previewContainer" class="d-none">
                        <div class="file-preview">
                            <h6>Preview File:</h6>
                            <div id="filePreview"></div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn-outline" data-bs-dismiss="modal">Batal</button>
                    <button type="button" class="btn-primary" onclick="processUploadedFile()" id="uploadBtn" disabled>
                        <i class="fas fa-spinner fa-spin d-none me-2"></i>
                        <span>Mulai Analisis File</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal: Edit Profile -->
    <div class="modal fade" id="editProfileModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-user-edit me-2"></i>Edit Profil</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="text-center mb-4">
                        <div class="position-relative d-inline-block">
                            <div class="profile-picture-container" id="profilePictureContainer">
                                <img id="profileImagePreview" 
                                     src="https://ui-avatars.com/api/?name=User&background=10B981&color=fff&size=128" 
                                     class="profile-picture-lg"
                                     style="cursor: pointer;"
                                     onclick="document.getElementById('profileImageInput').click()">
                            </div>
                            <button class="btn-primary position-absolute bottom-0 end-0 rounded-circle" 
                                    style="width: 40px; height: 40px; padding: 0;"
                                    onclick="document.getElementById('profileImageInput').click()">
                                <i class="fas fa-camera"></i>
                            </button>
                            <input type="file" id="profileImageInput" accept="image/*" hidden>
                        </div>
                        <p class="mt-2 text-muted small">Klik foto untuk mengupload gambar baru</p>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Nama Lengkap</label>
                        <input type="text" class="form-control" id="editName" placeholder="Masukkan nama lengkap Anda">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Email</label>
                        <input type="email" class="form-control" id="editEmail" placeholder="email@anda.com">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Bio / Deskripsi Diri</label>
                        <textarea class="form-control" id="editBio" rows="3" placeholder="Ceritakan sedikit tentang diri Anda dan tujuan kesehatan..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Tujuan Utama Kesehatan</label>
                        <select class="form-control" id="editGoal">
                            <option value="deficit">Turunkan Berat Badan</option>
                            <option value="maintain">Pertahankan Berat Badan</option>
                            <option value="surplus">Naikkan Massa Otot</option>
                            <option value="health">Meningkatkan Kesehatan Umum</option>
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn-outline" data-bs-dismiss="modal">Batal</button>
                    <button type="button" class="btn-primary" onclick="saveProfile()">
                        <i class="fas fa-save me-2"></i>Simpan Perubahan
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal: Create Challenge -->
    <div class="modal fade" id="challengeModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-flag me-2"></i>Buat Tantangan Baru</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label class="form-label">Judul Tantangan</label>
                        <input type="text" class="form-control" id="challengeTitle" placeholder="Contoh: 30 Days Water Challenge">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Deskripsi</label>
                        <textarea class="form-control" id="challengeDescription" rows="3" placeholder="Jelaskan tantangan ini..."></textarea>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="form-label">Durasi (hari)</label>
                                <input type="number" class="form-control" id="challengeDuration" min="1" max="365" value="30">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="form-label">Target</label>
                                <input type="text" class="form-control" id="challengeTarget" placeholder="Contoh: 8 gelas/hari">
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Tipe Tantangan</label>
                        <select class="form-control" id="challengeType">
                            <option value="hydration">Hidrasi</option>
                            <option value="exercise">Olahraga</option>
                            <option value="nutrition">Nutrisi</option>
                            <option value="weight">Berat Badan</option>
                            <option value="step">Langkah</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Privasi</label>
                        <select class="form-control" id="challengePrivacy">
                            <option value="public">Publik (Semua bisa ikut)</option>
                            <option value="private">Privat (Hanya dengan undangan)</option>
                            <option value="friends">Teman saja</option>
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn-outline" data-bs-dismiss="modal">Batal</button>
                    <button type="button" class="btn-orange" onclick="createChallenge()">
                        <i class="fas fa-plus me-2"></i>Buat Tantangan
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal: Create Group -->
    <div class="modal fade" id="groupModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-users me-2"></i>Buat Grup Baru</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label class="form-label">Nama Grup</label>
                        <input type="text" class="form-control" id="groupName" placeholder="Contoh: Fitness Indonesia">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Deskripsi Grup</label>
                        <textarea class="form-control" id="groupDescription" rows="3" placeholder="Jelaskan tujuan grup ini..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Tipe Grup</label>
                        <select class="form-control" id="groupType">
                            <option value="fitness">Fitness & Olahraga</option>
                            <option value="weight-loss">Penurunan Berat Badan</option>
                            <option value="muscle-gain">Peningkatan Massa Otot</option>
                            <option value="vegan">Vegan & Vegetarian</option>
                            <option value="general">Umum</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Privasi Grup</label>
                        <select class="form-control" id="groupPrivacy">
                            <option value="public">Publik (Semua bisa bergabung)</option>
                            <option value="private">Privat (Perlu persetujuan admin)</option>
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn-outline" data-bs-dismiss="modal">Batal</button>
                    <button type="button" class="btn-blue" onclick="createGroup()">
                        <i class="fas fa-plus me-2"></i>Buat Grup
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal: Add Friend -->
    <div class="modal fade" id="addFriendModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-user-plus me-2"></i>Tambah Teman</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="search-container mb-4">
                        <i class="fas fa-search search-icon"></i>
                        <input type="text" class="search-bar" id="searchUsers" placeholder="Cari pengguna BiteCount...">
                    </div>
                    <div id="searchUsersResults">
                        <p class="text-center text-muted">Mulai ketik untuk mencari pengguna</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/js/bootstrap.bundle.min.js"></script>
    <script>
        // Data Storage
        let userData = {};
        let foodLog = [];
        let dailyTarget = 0;
        let chatHistory = [];
        let currentChatType = 'dashboard';
        
        // Social & Community Data
        let communityPosts = [];
        let communityChallenges = [];
        let communityGroups = [];
        let communityFriends = [];
        let communityLeaderboard = [];
        let userAchievements = [];

        // Enhanced Food Database
        const foodDatabase = [
            // Rice & Grains
            { 
                name: "Nasi Putih", 
                calories: 130, 
                protein: 2.7, 
                carbs: 28, 
                fat: 0.3, 
                portion: "100g",
                baseQuantity: 100,
                category: "grains",
                description: "Karbohidrat utama Indonesia, sumber energi",
                benefits: "Sumber energi cepat, mudah dicerna"
            },
            { 
                name: "Nasi Merah", 
                calories: 111, 
                protein: 2.6, 
                carbs: 23, 
                fat: 0.9, 
                portion: "100g",
                category: "grains",
                description: "Nasi dengan serat lebih tinggi",
                benefits: "Serat tinggi, indeks glikemik rendah"
            },
            
            // Proteins
            { 
                name: "Ayam Goreng", 
                calories: 246, 
                protein: 27, 
                carbs: 0, 
                fat: 15, 
                portion: "100g",
                category: "protein",
                description: "Ayam digoreng dengan tepung",
                tips: "Hindari kulit untuk mengurangi lemak"
            },
            { 
                name: "Ayam Panggang", 
                calories: 165, 
                protein: 31, 
                carbs: 0, 
                fat: 3.6, 
                portion: "100g",
                category: "protein",
                description: "Ayam dipanggang tanpa kulit"
            },
            { 
                name: "Telur Dadar", 
                calories: 154, 
                protein: 11, 
                carbs: 1, 
                fat: 12, 
                portion: "1 butir (50g)",
                baseQuantity: 50,
                category: "protein"
            },
            { 
                name: "Telur Rebus", 
                calories: 78, 
                protein: 6, 
                carbs: 1, 
                fat: 5, 
                portion: "1 butir (50g)",
                baseQuantity: 50,
                category: "protein"
            },
            
            // Vegetarian Proteins
            { 
                name: "Tempe Goreng", 
                calories: 192, 
                protein: 19, 
                carbs: 9, 
                fat: 11, 
                portion: "100g",
                category: "protein",
                benefits: "Protein nabati, mengandung probiotik"
            },
            { 
                name: "Tahu Goreng", 
                calories: 76, 
                protein: 8, 
                carbs: 1.9, 
                fat: 5, 
                portion: "100g",
                category: "protein"
            },
            
            // Indonesian Dishes
            { 
                name: "Rendang Sapi", 
                calories: 468, 
                protein: 21, 
                carbs: 6, 
                fat: 40, 
                portion: "100g",
                category: "main-dish"
            },
            { 
                name: "Sate Ayam", 
                calories: 210, 
                protein: 25, 
                carbs: 3, 
                fat: 11, 
                portion: "5 tusuk (100g)",
                baseQuantity: 100,
                category: "main-dish"
            },
            { 
                name: "Gado-gado", 
                calories: 275, 
                protein: 11, 
                carbs: 28, 
                fat: 13, 
                portion: "1 porsi (300g)",
                baseQuantity: 300,
                category: "main-dish"
            },
            { 
                name: "Soto Ayam", 
                calories: 220, 
                protein: 15, 
                carbs: 20, 
                fat: 8, 
                portion: "1 mangkuk (400ml)",
                baseQuantity: 400,
                category: "soup"
            },
            
            // Noodles
            { 
                name: "Mie Goreng", 
                calories: 400, 
                protein: 12, 
                carbs: 60, 
                fat: 12, 
                portion: "1 porsi (200g)",
                baseQuantity: 200,
                category: "noodles"
            },
            { 
                name: "Mie Rebus", 
                calories: 350, 
                protein: 10, 
                carbs: 55, 
                fat: 8, 
                portion: "1 porsi (200g)",
                baseQuantity: 200,
                category: "noodles"
            },
            
            // Vegetables
            { 
                name: "Sayur Bayam", 
                calories: 23, 
                protein: 2.9, 
                carbs: 3.6, 
                fat: 0.4, 
                portion: "100g",
                category: "vegetables"
            },
            { 
                name: "Brokoli Rebus", 
                calories: 35, 
                protein: 2.4, 
                carbs: 7.2, 
                fat: 0.4, 
                portion: "100g",
                category: "vegetables"
            },
            
            // Fruits
            { 
                name: "Pisang", 
                calories: 89, 
                protein: 1.1, 
                carbs: 23, 
                fat: 0.3, 
                portion: "1 buah (100g)",
                baseQuantity: 100,
                category: "fruits"
            },
            { 
                name: "Apel", 
                calories: 52, 
                protein: 0.3, 
                carbs: 14, 
                fat: 0.2, 
                portion: "1 buah (100g)",
                baseQuantity: 100,
                category: "fruits"
            },
            { 
                name: "Alpukat", 
                calories: 160, 
                protein: 2, 
                carbs: 9, 
                fat: 15, 
                portion: "1 buah (150g)",
                baseQuantity: 150,
                category: "fruits"
            },
            
            // Dairy & Alternatives
            { 
                name: "Susu Full Cream", 
                calories: 61, 
                protein: 3.2, 
                carbs: 4.7, 
                fat: 3.3, 
                portion: "100ml",
                baseQuantity: 100,
                category: "dairy"
            },
            { 
                name: "Susu Low Fat", 
                calories: 42, 
                protein: 3.4, 
                carbs: 5, 
                fat: 1, 
                portion: "100ml",
                baseQuantity: 100,
                category: "dairy"
            },
            { 
                name: "Yogurt Plain", 
                calories: 59, 
                protein: 10, 
                carbs: 4, 
                fat: 0.4, 
                portion: "100g",
                category: "dairy"
            },
            
            // Beverages
            { 
                name: "Air Mineral", 
                calories: 0, 
                protein: 0, 
                carbs: 0, 
                fat: 0, 
                portion: "100ml",
                baseQuantity: 100,
                category: "beverages"
            },
            { 
                name: "Teh Manis", 
                calories: 30, 
                protein: 0, 
                carbs: 8, 
                fat: 0, 
                portion: "100ml",
                baseQuantity: 100,
                category: "beverages"
            },
            { 
                name: "Kopi Hitam", 
                calories: 2, 
                protein: 0.3, 
                carbs: 0, 
                fat: 0, 
                portion: "100ml",
                baseQuantity: 100,
                category: "beverages"
            },
            { 
                name: "Kopi Susu", 
                calories: 45, 
                protein: 2, 
                carbs: 5, 
                fat: 2, 
                portion: "100ml",
                baseQuantity: 100,
                category: "beverages"
            },
            { 
                name: "Jus Jeruk", 
                calories: 45, 
                protein: 0.7, 
                carbs: 10, 
                fat: 0.2, 
                portion: "100ml",
                baseQuantity: 100,
                category: "beverages"
            },
            { 
                name: "Jus Alpukat", 
                calories: 120, 
                protein: 1.5, 
                carbs: 6, 
                fat: 11, 
                portion: "100ml",
                baseQuantity: 100,
                category: "beverages"
            },
            
            // Snacks
            { 
                name: "Keripik Kentang", 
                calories: 536, 
                protein: 7, 
                carbs: 53, 
                fat: 35, 
                portion: "100g",
                category: "snacks"
            },
            { 
                name: "Kacang Almond", 
                calories: 579, 
                protein: 21, 
                carbs: 22, 
                fat: 50, 
                portion: "100g",
                category: "snacks"
            },
            
            // Breakfast
            { 
                name: "Oatmeal", 
                calories: 68, 
                protein: 2.4, 
                carbs: 12, 
                fat: 1.4, 
                portion: "100g matang",
                category: "breakfast"
            },
            { 
                name: "Roti Gandum", 
                calories: 247, 
                protein: 13, 
                carbs: 41, 
                fat: 3.4, 
                portion: "100g",
                category: "breakfast"
            }
        ];

        // Mock Community Data
        const mockUsers = [
            { id: 1, name: "Andi Pratama", avatar: "https://ui-avatars.com/api/?name=Andi+Pratama&background=3B82F6&color=fff&size=128", streak: 7 },
            { id: 2, name: "Sari Dewi", avatar: "https://ui-avatars.com/api/?name=Sari+Dewi&background=EC4899&color=fff&size=128", streak: 14 },
            { id: 3, name: "Budi Santoso", avatar: "https://ui-avatars.com/api/?name=Budi+Santoso&background=10B981&color=fff&size=128", streak: 21 },
            { id: 4, name: "Maya Indah", avatar: "https://ui-avatars.com/api/?name=Maya+Indah&background=F59E0B&color=fff&size=128", streak: 3 },
            { id: 5, name: "Rizki Ramadhan", avatar: "https://ui-avatars.com/api/?name=Rizki+Ramadhan&background=8B5CF6&color=fff&size=128", streak: 30 }
        ];

        // Mock Challenges
        const mockChallenges = [
            { 
                id: 1, 
                title: "30 Days Water Challenge", 
                description: "Minum 2 liter air setiap hari selama 30 hari", 
                type: "hydration",
                duration: 30,
                target: "2 liter/hari",
                participants: 142,
                progress: 65,
                creator: mockUsers[0]
            },
            { 
                id: 2, 
                title: "10k Steps Daily", 
                description: "Capai 10.000 langkah setiap hari", 
                type: "step",
                duration: 7,
                target: "10.000 langkah/hari",
                participants: 89,
                progress: 42,
                creator: mockUsers[1]
            },
            { 
                id: 3, 
                title: "Vegetarian Week", 
                description: "Makan vegetarian selama 7 hari", 
                type: "nutrition",
                duration: 7,
                target: "0 daging",
                participants: 56,
                progress: 85,
                creator: mockUsers[2]
            }
        ];

        // Mock Groups
        const mockGroups = [
            { 
                id: 1, 
                name: "Fitness Indonesia", 
                description: "Komunitas fitness dan olahraga Indonesia", 
                type: "fitness",
                members: 245,
                image: "https://images.unsplash.com/photo-1536922246289-88c42f957773?w=400&h=200&fit=crop"
            },
            { 
                id: 2, 
                name: "Weight Loss Journey", 
                description: "Berbagi perjalanan penurunan berat badan", 
                type: "weight-loss",
                members: 189,
                image: "https://images.unsplash.com/photo-1518611012118-696072aa579a?w=400&h=200&fit=crop"
            },
            { 
                id: 3, 
                name: "Vegan Indonesia", 
                description: "Komunitas vegan dan vegetarian Indonesia", 
                type: "vegan",
                members: 134,
                image: "https://images.unsplash.com/photo-1512621776951-a57141f2eefd?w=400&h=200&fit=crop"
            }
        ];

        // Initialize Application
        window.onload = function() {
            setTimeout(() => {
                document.getElementById('loadingScreen').classList.add('hidden');
            }, 1500);

            loadData();
            if (userData.name) {
                showDashboard();
            }
            
            setupProfileImageUpload();
            setupEventListeners();
            initializeCommunityData();
            
            // Show welcome tip if new user
            if (!localStorage.getItem('biteCountFirstVisit')) {
                setTimeout(() => {
                    showWelcomeChatbot();
                    localStorage.setItem('biteCountFirstVisit', 'true');
                }, 2000);
            }
        };

        // Setup Event Listeners
        function setupEventListeners() {
            // Profile form submission
            document.getElementById('profileForm').addEventListener('submit', handleProfileSubmit);
            
            // Search food input
            document.getElementById('searchFood').addEventListener('input', handleFoodSearch);
            
            // Search users input
            document.getElementById('searchUsers')?.addEventListener('input', handleUserSearch);
            
            // Chat input enter key
            const chatInput = document.getElementById('chatInput');
            const welcomeChatInput = document.getElementById('welcomeChatInput');
            
            if (chatInput) {
                chatInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') sendMessage();
                });
            }
            
            if (welcomeChatInput) {
                welcomeChatInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') sendWelcomeMessage();
                });
            }
            
            // New post enter key
            const newPostContent = document.getElementById('newPostContent');
            if (newPostContent) {
                newPostContent.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter' && e.ctrlKey) {
                        createNewPost();
                    }
                });
            }
        }

        // Initialize Community Data
        function initializeCommunityData() {
            // Load saved community data
            const savedCommunityData = localStorage.getItem('biteCountCommunity');
            if (savedCommunityData) {
                const data = JSON.parse(savedCommunityData);
                communityPosts = data.posts || [];
                communityChallenges = data.challenges || mockChallenges;
                communityGroups = data.groups || mockGroups;
                communityFriends = data.friends || [];
                communityLeaderboard = data.leaderboard || [];
                userAchievements = data.achievements || [];
            } else {
                // Initialize with mock data
                communityChallenges = mockChallenges;
                communityGroups = mockGroups;
                communityFriends = mockUsers.slice(0, 3);
                generateMockPosts();
                generateLeaderboard();
                saveCommunityData();
            }
        }

        // Generate mock posts
        function generateMockPosts() {
            const postTypes = ['achievement', 'food', 'progress', 'tip', 'question'];
            const messages = [
                "Hari ini berhasil mencapai target kalori! 🎉",
                "Baru mencoba resep salad sehat, enak banget! 🥗",
                "Turun 2kg dalam sebulan! Semangat terus! 💪",
                "Tips: Minum air sebelum makan membantu kontrol porsi 💧",
                "Ada yang punya rekomendasi makanan tinggi protein? 🤔",
                "Berhasil consistency streak 30 hari! 🏆",
                "Sarapan sehat pagi ini: oatmeal dengan buah 🍓",
                "Workout hari ini selesai! Feeling great! 🏋️‍♂️",
                "Berbagi progress foto, ada perubahan nggak? 📸",
                "Baru join challenge 10k steps, wish me luck! 👟"
            ];

            communityPosts = mockUsers.map((user, index) => ({
                id: index + 1,
                userId: user.id,
                userName: user.name,
                userAvatar: user.avatar,
                content: messages[index % messages.length],
                type: postTypes[index % postTypes.length],
                likes: Math.floor(Math.random() * 50) + 10,
                comments: Math.floor(Math.random() * 20) + 1,
                shares: Math.floor(Math.random() * 10),
                timestamp: new Date(Date.now() - (index * 3600000)).toISOString(),
                userLiked: index % 3 === 0,
                userCommented: index % 4 === 0
            }));
        }

        // Generate leaderboard
        function generateLeaderboard() {
            communityLeaderboard = mockUsers.map((user, index) => ({
                ...user,
                points: (index + 1) * 250,
                streak: user.streak || Math.floor(Math.random() * 30) + 1,
                rank: index + 1
            }));
        }

        // Save community data
        function saveCommunityData() {
            const data = {
                posts: communityPosts,
                challenges: communityChallenges,
                groups: communityGroups,
                friends: communityFriends,
                leaderboard: communityLeaderboard,
                achievements: userAchievements,
                lastUpdated: new Date().toISOString()
            };
            localStorage.setItem('biteCountCommunity', JSON.stringify(data));
        }

        // Profile Setup
        function handleProfileSubmit(e) {
            e.preventDefault();
            showLoading();

            userData = {
                name: document.getElementById('userName').value,
                gender: document.getElementById('gender').value,
                age: parseInt(document.getElementById('age').value),
                height: parseInt(document.getElementById('height').value),
                weight: parseInt(document.getElementById('weight').value),
                activity: parseFloat(document.getElementById('activity').value),
                goal: document.getElementById('goal').value,
                email: "",
                bio: "",
                profileImage: "",
                goalText: getGoalText(document.getElementById('goal').value),
                joinDate: new Date().toISOString()
            };

            calculateCalories();
            saveData();

            setTimeout(() => {
                hideLoading();
                showDashboard();
                showToast('🎉 Profil berhasil dibuat!', 'Selamat datang di BiteCount!');
            }, 1000);
        }

        // Calculate BMR & TDEE
        function calculateCalories() {
            let bmr;
            if (userData.gender === 'male') {
                bmr = 10 * userData.weight + 6.25 * userData.height - 5 * userData.age + 5;
            } else {
                bmr = 10 * userData.weight + 6.25 * userData.height - 5 * userData.age - 161;
            }

            const tdee = bmr * userData.activity;

            if (userData.goal === 'deficit') {
                dailyTarget = tdee - 500;
            } else if (userData.goal === 'surplus') {
                dailyTarget = tdee + 500;
            } else {
                dailyTarget = tdee;
            }

            userData.bmr = Math.round(bmr);
            userData.tdee = Math.round(tdee);
            userData.dailyTarget = Math.round(dailyTarget);
        }

        // Get goal text
        function getGoalText(goal) {
            switch(goal) {
                case 'deficit': return 'Turunkan Berat Badan';
                case 'maintain': return 'Pertahankan Berat Badan';
                case 'surplus': return 'Naikkan Massa Otot';
                default: return 'Kesehatan Umum';
            }
        }

        // Search Food
        function handleFoodSearch(e) {
            const query = e.target.value.toLowerCase();
            const results = document.getElementById('searchResults');

            if (query.length < 2) {
                results.innerHTML = '';
                return;
            }

            const filtered = foodDatabase.filter(food => 
                food.name.toLowerCase().includes(query)
            );

            if (filtered.length > 0) {
                results.innerHTML = filtered.map(food => `
                    <div class="food-item" onclick='selectFood(${JSON.stringify(food)})'>
                        <div class="food-item-content">
                            <h5 class="mb-1">${food.name}</h5>
                            <div class="meta">${food.portion} • ${food.calories} kkal</div>
                            <div class="mt-2">
                                <span class="badge bg-green me-2">🥩 ${food.protein}g</span>
                                <span class="badge bg-pink me-2">🍚 ${food.carbs}g</span>
                                <span class="badge bg-secondary">🥑 ${food.fat}g</span>
                            </div>
                        </div>
                        <div class="food-calories">${food.calories}</div>
                    </div>
                `).join('');
            } else {
                results.innerHTML = `
                    <div class="empty-state py-4">
                        <i class="fas fa-search"></i>
                        <p class="mt-3">Tidak ditemukan makanan "${query}"</p>
                        <button class="btn-outline mt-2" onclick="showAddFoodModal()">
                            <i class="fas fa-plus me-2"></i>Tambah Makanan Baru
                        </button>
                    </div>
                `;
            }
        }

        function selectFood(food) {
            const time = new Date().toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' });
            foodLog.push({
                ...food,
                time: time,
                mealTime: getCurrentMealTime()
            });
            saveData();
            updateDashboard();
            document.getElementById('searchFood').value = '';
            document.getElementById('searchResults').innerHTML = '';
            showToast('✅ Berhasil ditambahkan!', `${food.name} telah ditambahkan ke log makanan`);
        }

        function getCurrentMealTime() {
            const hour = new Date().getHours();
            if (hour < 10) return 'Sarapan';
            if (hour < 15) return 'Makan Siang';
            if (hour < 21) return 'Makan Malam';
            return 'Cemilan';
        }

        // Add Food Modal
        function showAddFoodModal() {
            new bootstrap.Modal(document.getElementById('addFoodModal')).show();
        }

        function addFood() {
            const name = document.getElementById('foodName').value.trim();
            const calories = parseInt(document.getElementById('foodCalories').value);
            const protein = parseInt(document.getElementById('foodProtein').value) || 0;
            const carbs = parseInt(document.getElementById('foodCarb').value) || 0;
            const fat = parseInt(document.getElementById('foodFat').value) || 0;
            const portion = document.getElementById('foodPortion').value.trim() || '1 porsi';
            const mealTime = document.getElementById('foodTime').value;

            if (!name || !calories) {
                showToast('⚠️ Perhatian', 'Harap isi nama dan kalori makanan');
                return;
            }

            const time = new Date().toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' });
            
            foodLog.push({
                name,
                calories,
                protein,
                carbs,
                fat,
                portion,
                time,
                mealTime
            });

            saveData();
            updateDashboard();
            bootstrap.Modal.getInstance(document.getElementById('addFoodModal')).hide();
            showToast('✅ Berhasil!', `${name} telah ditambahkan ke log ${mealTime.toLowerCase()}`);

            // Reset form
            ['foodName', 'foodCalories', 'foodProtein', 'foodCarb', 'foodFat', 'foodPortion'].forEach(id => {
                document.getElementById(id).value = '';
            });
            document.getElementById('foodTime').value = 'Makan Siang';
        }

        // Update Dashboard
        function updateDashboard() {
            const totalCalories = foodLog.reduce((sum, food) => sum + food.calories, 0);
            const totalProtein = foodLog.reduce((sum, food) => sum + food.protein, 0);
            const totalCarbs = foodLog.reduce((sum, food) => sum + food.carbs, 0);
            const totalFat = foodLog.reduce((sum, food) => sum + food.fat, 0);

            const remaining = Math.max(userData.dailyTarget - totalCalories, 0);
            const percentage = Math.min((totalCalories / userData.dailyTarget) * 100, 100);

            // Update profile section
            document.getElementById('displayName').textContent = userData.name || 'User';
            document.getElementById('communityUserName').textContent = userData.name || 'User';
            document.getElementById('userGoalBadge').innerHTML = `
                <i class="fas fa-bullseye me-1"></i>${userData.goalText || 'Turunkan Berat Badan'}
            `;
            document.getElementById('userBio').textContent = userData.bio || 'Belum ada bio';
            
            // Update profile image
            const profileImage = document.getElementById('userProfileImage');
            const communityProfileImage = document.getElementById('userProfileImageCommunity');
            const settingsProfileImage = document.getElementById('settingsProfileImage');
            if (userData.profileImage) {
                profileImage.src = userData.profileImage;
                communityProfileImage.src = userData.profileImage;
                settingsProfileImage.src = userData.profileImage;
            } else {
                const name = userData.name || 'User';
                profileImage.src = `https://ui-avatars.com/api/?name=${encodeURIComponent(name)}&background=10B981&color=fff&size=128`;
                communityProfileImage.src = `https://ui-avatars.com/api/?name=${encodeURIComponent(name)}&background=10B981&color=fff&size=128`;
                settingsProfileImage.src = `https://ui-avatars.com/api/?name=${encodeURIComponent(name)}&background=10B981&color=fff&size=128`;
            }

            // Update settings page
            document.getElementById('settingsUserName').textContent = userData.name || 'User';
            document.getElementById('settingsUserEmail').textContent = userData.email || 'user@example.com';
            document.getElementById('settingCalories').textContent = userData.dailyTarget || 0;
            document.getElementById('settingBMR').textContent = userData.bmr || 0;
            document.getElementById('settingTDEE').textContent = userData.tdee || 0;

            // Update calories and macros
            document.getElementById('remainingCalories').textContent = remaining;
            document.getElementById('proteinValue').textContent = totalProtein;
            document.getElementById('carbValue').textContent = totalCarbs;
            document.getElementById('fatValue').textContent = totalFat;

            // Update progress ring
            const ring = document.getElementById('progressRing');
            ring.style.background = `conic-gradient(
                var(--primary-green) 0%, 
                var(--secondary-green) ${percentage / 2}%,
                var(--light-green) ${percentage}%,
                #f0f0f0 ${percentage}%,
                #f0f0f0 100%
            )`;

            // Update community stats
            updateCommunityStats();

            // Update food history
            const historyDiv = document.getElementById('foodHistory');
            const totalItems = document.getElementById('totalItems');
            
            if (foodLog.length === 0) {
                historyDiv.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-utensils"></i>
                        <h5 class="mt-3">Belum ada makanan tercatat</h5>
                        <p class="mb-3">Mulai tambahkan makanan pertama Anda!</p>
                        <button class="btn-primary" onclick="showAddFoodModal()">
                            <i class="fas fa-plus me-2"></i>Tambah Makanan Pertama
                        </button>
                    </div>
                `;
                totalItems.textContent = '0 item';
            } else {
                // Group by meal time
                const grouped = {};
                foodLog.forEach(food => {
                    if (!grouped[food.mealTime]) {
                        grouped[food.mealTime] = [];
                    }
                    grouped[food.mealTime].push(food);
                });

                let html = '';
                for (const [mealTime, foods] of Object.entries(grouped)) {
                    const mealCalories = foods.reduce((sum, f) => sum + f.calories, 0);
                    
                    html += `
                        <div class="mb-4">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <h6 class="mb-0"><i class="fas fa-clock me-2"></i>${mealTime}</h6>
                                <span class="badge bg-green">${mealCalories} kkal</span>
                            </div>
                    `;
                    
                    foods.forEach((food, index) => {
                        html += `
                            <div class="food-item ${index === foods.length - 1 ? 'mb-3' : 'mb-2'}">
                                <div class="food-item-content">
                                    <h5 class="mb-1">${food.name}</h5>
                                    <div class="meta">${food.time} • ${food.portion || '1 porsi'}</div>
                                    <div class="mt-2">
                                        <span class="badge bg-green me-2">🥩 ${food.protein}g</span>
                                        <span class="badge bg-pink me-2">🍚 ${food.carbs}g</span>
                                        <span class="badge bg-secondary me-2">🥑 ${food.fat}g</span>
                                    </div>
                                </div>
                                <div class="food-calories">${food.calories}</div>
                            </div>
                        `;
                    });
                    
                    html += `</div>`;
                }
                
                historyDiv.innerHTML = html;
                totalItems.textContent = `${foodLog.length} item`;
            }
        }

        // Update Community Stats
        function updateCommunityStats() {
            const totalPosts = communityPosts.length;
            const totalLikes = communityPosts.reduce((sum, post) => sum + post.likes, 0);
            const totalFriends = communityFriends.length;

            document.getElementById('communityPosts').textContent = totalPosts;
            document.getElementById('communityLikes').textContent = totalLikes;
            document.getElementById('communityFriends').textContent = totalFriends;
        }

        function removeFood(index) {
            const foodName = foodLog[index].name;
            foodLog.splice(index, 1);
            saveData();
            updateDashboard();
            showToast('🗑️ Dihapus', `${foodName} telah dihapus dari log`);
        }

        // Page Navigation
        function showDashboard() {
            showLoading();
            setTimeout(() => {
                document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
                document.getElementById('dashboardPage').classList.add('active');
                updateDashboard();
                updateNavigation('home');
                hideLoading();
            }, 800);
        }

        function showCommunity() {
            showLoading();
            setTimeout(() => {
                document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
                document.getElementById('communityPage').classList.add('active');
                loadCommunityContent();
                updateNavigation('community');
                hideLoading();
            }, 800);
        }

        function showSettings() {
            showLoading();
            setTimeout(() => {
                document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
                document.getElementById('settingsPage').classList.add('active');
                updateDashboard();
                updateNavigation('settings');
                hideLoading();
            }, 800);
        }

        // Update Bottom Navigation
        function updateNavigation(activePage) {
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            const navItems = document.querySelectorAll('.nav-item');
            switch(activePage) {
                case 'home':
                    navItems[0].classList.add('active');
                    break;
                case 'community':
                    navItems[1].classList.add('active');
                    break;
                case 'chatbot':
                    navItems[2].classList.add('active');
                    break;
                case 'settings':
                    navItems[3].classList.add('active');
                    break;
            }
        }

        // Loading
        function showLoading() {
            document.getElementById('loadingScreen').classList.remove('hidden');
        }

        function hideLoading() {
            document.getElementById('loadingScreen').classList.add('hidden');
        }

        // Toast Notification
        function showToast(title, message) {
            const toast = document.getElementById('toast');
            document.getElementById('toastTitle').textContent = title;
            document.getElementById('toastMessage').textContent = message;
            
            toast.style.display = 'block';
            setTimeout(() => {
                toast.style.display = 'none';
            }, 3000);
        }

        // Storage Management
        function saveData() {
            const data = {
                userData,
                foodLog,
                date: new Date().toDateString()
            };
            localStorage.setItem('biteCountData', JSON.stringify(data));
        }

        function loadData() {
            const saved = localStorage.getItem('biteCountData');
            if (saved) {
                const data = JSON.parse(saved);
                const today = new Date().toDateString();
                
                userData = data.userData;
                dailyTarget = userData.dailyTarget;
                
                if (data.date === today) {
                    foodLog = data.foodLog;
                } else {
                    foodLog = [];
                    saveData();
                }
            }
        }

        function resetApp() {
            if (confirm('⚠️ Apakah Anda yakin ingin mereset semua data? Tindakan ini tidak dapat dibatalkan.')) {
                localStorage.removeItem('biteCountData');
                localStorage.removeItem('biteCountCommunity');
                localStorage.removeItem('biteCountFirstVisit');
                location.reload();
            }
        }

        // Profile Functions
        function showEditProfileModal() {
            const modal = new bootstrap.Modal(document.getElementById('editProfileModal'));
            
            // Fill form with current data
            document.getElementById('editName').value = userData.name || '';
            document.getElementById('editEmail').value = userData.email || '';
            document.getElementById('editBio').value = userData.bio || '';
            document.getElementById('editGoal').value = userData.goal || 'deficit';
            
            // Set profile image preview
            const preview = document.getElementById('profileImagePreview');
            if (userData.profileImage) {
                preview.src = userData.profileImage;
            } else {
                const name = userData.name || 'User';
                preview.src = `https://ui-avatars.com/api/?name=${encodeURIComponent(name)}&background=10B981&color=fff&size=128`;
            }
            
            modal.show();
        }

        function setupProfileImageUpload() {
            const profileImageInput = document.getElementById('profileImageInput');
            const profileImagePreview = document.getElementById('profileImagePreview');
            
            profileImageInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                // Check file size (max 2MB)
                if (file.size > 2 * 1024 * 1024) {
                    showToast('⚠️ Ukuran File Besar', 'Maksimum 2MB untuk foto profil.');
                    return;
                }
                
                // Check file type
                if (!file.type.startsWith('image/')) {
                    showToast('⚠️ Format Salah', 'File harus berupa gambar.');
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    profileImagePreview.src = e.target.result;
                };
                reader.readAsDataURL(file);
            });
        }

        function saveProfile() {
            const name = document.getElementById('editName').value.trim();
            const email = document.getElementById('editEmail').value.trim();
            const bio = document.getElementById('editBio').value.trim();
            const goal = document.getElementById('editGoal').value;
            
            if (!name) {
                showToast('⚠️ Nama Kosong', 'Nama tidak boleh kosong!');
                return;
            }
            
            // Update user data
            userData.name = name;
            userData.email = email;
            userData.bio = bio;
            userData.goal = goal;
            userData.goalText = getGoalText(goal);
            
            // Save profile image if changed
            const preview = document.getElementById('profileImagePreview');
            if (preview.src && !preview.src.includes('ui-avatars.com')) {
                userData.profileImage = preview.src;
            }
            
            // Recalculate calories if goal changed
            if (goal !== userData.goal) {
                userData.goal = goal;
                calculateCalories();
            }
            
            saveData();
            updateDashboard();
            bootstrap.Modal.getInstance(document.getElementById('editProfileModal')).hide();
            showToast('✅ Profil Diperbarui', 'Perubahan berhasil disimpan!');
        }

        function changeProfilePicture() {
            document.getElementById('profileImageInput').click();
        }

        // Community Functions
        function loadCommunityContent() {
            loadCommunityFeed();
            updateCommunityStats();
        }

        function loadCommunityFeed() {
            const feedContainer = document.getElementById('communityFeed');
            
            if (communityPosts.length === 0) {
                feedContainer.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-users"></i>
                        <h5 class="mt-3">Belum ada postingan</h5>
                        <p class="mb-3">Jadilah yang pertama membagikan pencapaian Anda!</p>
                        <button class="btn-primary" onclick="createNewPost()">
                            <i class="fas fa-plus me-2"></i>Buat Postingan Pertama
                        </button>
                    </div>
                `;
                return;
            }
            
            // Sort posts by timestamp (newest first)
            const sortedPosts = [...communityPosts].sort((a, b) => 
                new Date(b.timestamp) - new Date(a.timestamp)
            );
            
            feedContainer.innerHTML = sortedPosts.map(post => `
                <div class="social-post" id="post-${post.id}">
                    <div class="post-header">
                        <img src="${post.userAvatar}" class="post-avatar" alt="${post.userName}">
                        <div class="post-user-info">
                            <h6 class="mb-0">${post.userName}</h6>
                            <div class="time">${formatTimeAgo(post.timestamp)}</div>
                        </div>
                    </div>
                    <div class="post-content">
                        <p class="mb-2">${post.content}</p>
                        ${post.type === 'achievement' ? '<span class="achievement-badge"><i class="fas fa-trophy me-1"></i>Pencapaian</span>' : ''}
                        ${post.type === 'food' ? '<span class="badge bg-green"><i class="fas fa-utensils me-1"></i>Makanan</span>' : ''}
                    </div>
                    <div class="post-stats">
                        <div class="post-stat ${post.userLiked ? 'active' : ''}" onclick="toggleLike(${post.id})">
                            <i class="fas fa-heart ${post.userLiked ? 'text-pink' : ''}"></i>
                            <span>${post.likes}</span>
                        </div>
                        <div class="post-stat" onclick="showComments(${post.id})">
                            <i class="fas fa-comment"></i>
                            <span>${post.comments}</span>
                        </div>
                        <div class="post-stat" onclick="sharePost(${post.id})">
                            <i class="fas fa-share"></i>
                            <span>${post.shares}</span>
                        </div>
                    </div>
                    <div class="post-actions">
                        <button class="action-btn ${post.userLiked ? 'active' : ''}" onclick="toggleLike(${post.id})">
                            <i class="fas fa-heart"></i> Like
                        </button>
                        <button class="action-btn" onclick="showComments(${post.id})">
                            <i class="fas fa-comment"></i> Komentar
                        </button>
                        <button class="action-btn" onclick="sharePost(${post.id})">
                            <i class="fas fa-share"></i> Bagikan
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function formatTimeAgo(timestamp) {
            const now = new Date();
            const postTime = new Date(timestamp);
            const diffMs = now - postTime;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMs / 3600000);
            const diffDays = Math.floor(diffMs / 86400000);

            if (diffMins < 1) return 'Baru saja';
            if (diffMins < 60) return `${diffMins} menit yang lalu`;
            if (diffHours < 24) return `${diffHours} jam yang lalu`;
            if (diffDays < 7) return `${diffDays} hari yang lalu`;
            return postTime.toLocaleDateString('id-ID');
        }

        function switchCommunityTab(tabName) {
            // Update active tab buttons
            document.querySelectorAll('.action-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`tab${tabName.charAt(0).toUpperCase() + tabName.slice(1)}`).classList.add('active');
            
            // Hide all sections
            document.querySelectorAll('.community-section').forEach(section => {
                section.style.display = 'none';
            });
            
            // Show selected section
            document.getElementById(`community${tabName.charAt(0).toUpperCase() + tabName.slice(1)}`).style.display = 'block';
            
            // Load content for the tab
            switch(tabName) {
                case 'feed':
                    loadCommunityFeed();
                    break;
                case 'challenges':
                    loadChallenges();
                    break;
                case 'leaderboard':
                    loadLeaderboard();
                    break;
                case 'groups':
                    loadGroups();
                    break;
                case 'friends':
                    loadFriends();
                    break;
            }
        }

        function loadChallenges() {
            const challengesContainer = document.getElementById('challengesList');
            
            challengesContainer.innerHTML = communityChallenges.map(challenge => `
                <div class="challenge-card">
                    <div class="d-flex justify-content-between align-items-start mb-3">
                        <div>
                            <h6 class="mb-1">${challenge.title}</h6>
                            <p class="text-muted small mb-0">${challenge.description}</p>
                        </div>
                        <span class="badge bg-orange">${challenge.type}</span>
                    </div>
                    <div class="d-flex justify-content-between mb-2">
                        <div class="small">
                            <i class="fas fa-users me-1"></i> ${challenge.participants} peserta
                        </div>
                        <div class="small">
                            <i class="fas fa-calendar me-1"></i> ${challenge.duration} hari
                        </div>
                    </div>
                    <div class="challenge-progress">
                        <div class="challenge-progress-bar" style="width: ${challenge.progress}%"></div>
                    </div>
                    <div class="d-flex justify-content-between align-items-center mt-3">
                        <div class="small">
                            <i class="fas fa-target me-1"></i> Target: ${challenge.target}
                        </div>
                        <button class="btn-outline btn-sm" onclick="joinChallenge(${challenge.id})">
                            <i class="fas fa-plus me-1"></i> Ikuti
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function loadLeaderboard() {
            const leaderboardContainer = document.getElementById('leaderboardList');
            
            leaderboardContainer.innerHTML = communityLeaderboard.map(user => `
                <div class="leaderboard-item">
                    <div class="leaderboard-rank ${user.rank === 1 ? 'gold' : user.rank === 2 ? 'silver' : user.rank === 3 ? 'bronze' : ''}">
                        ${user.rank}
                    </div>
                    <img src="${user.avatar}" class="post-avatar me-3">
                    <div class="flex-grow-1">
                        <h6 class="mb-0">${user.name}</h6>
                        <div class="small">
                            <span class="text-orange me-3"><i class="fas fa-fire me-1"></i> ${user.streak} hari</span>
                            <span class="text-green">${user.points} poin</span>
                        </div>
                    </div>
                    <button class="btn-outline btn-sm" onclick="addFriend(${user.id})">
                        <i class="fas fa-user-plus"></i>
                    </button>
                </div>
            `).join('');
        }

        function loadGroups() {
            const groupsContainer = document.getElementById('groupsList');
            
            groupsContainer.innerHTML = communityGroups.map(group => `
                <div class="group-card">
                    <div class="d-flex">
                        <div class="flex-shrink-0">
                            <div style="width: 80px; height: 80px; background: linear-gradient(135deg, #${Math.floor(Math.random()*16777215).toString(16)}, #${Math.floor(Math.random()*16777215).toString(16)}); border-radius: 12px; display: flex; align-items: center; justify-content: center; color: white; font-size: 24px;">
                                <i class="fas fa-users"></i>
                            </div>
                        </div>
                        <div class="flex-grow-1 ms-3">
                            <h6 class="mb-1">${group.name}</h6>
                            <p class="text-muted small mb-2">${group.description}</p>
                            <div class="d-flex justify-content-between align-items-center">
                                <div class="group-members">
                                    <img src="https://ui-avatars.com/api/?name=User1&background=3B82F6&color=fff&size=128" class="group-member">
                                    <img src="https://ui-avatars.com/api/?name=User2&background=EC4899&color=fff&size=128" class="group-member">
                                    <img src="https://ui-avatars.com/api/?name=User3&background=10B981&color=fff&size=128" class="group-member">
                                    <div style="width: 40px; height: 40px; border-radius: 50%; background: var(--neutral-border); display: flex; align-items: center; justify-content: center; border: 2px solid white; margin-left: -10px;">
                                        <span class="small">+${group.members - 3}</span>
                                    </div>
                                </div>
                                <button class="btn-outline btn-sm" onclick="joinGroup(${group.id})">
                                    <i class="fas fa-plus me-1"></i> Gabung
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function loadFriends() {
            const friendsContainer = document.getElementById('friendsList');
            
            if (communityFriends.length === 0) {
                friendsContainer.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-user-friends"></i>
                        <h5 class="mt-3">Belum ada teman</h5>
                        <p class="mb-3">Mulai tambahkan teman untuk berbagi progres!</p>
                        <button class="btn-primary" onclick="showAddFriendModal()">
                            <i class="fas fa-user-plus me-2"></i>Tambah Teman
                        </button>
                    </div>
                `;
                return;
            }
            
            friendsContainer.innerHTML = communityFriends.map(friend => `
                <div class="friend-item">
                    <img src="${friend.avatar}" class="friend-avatar">
                    <div class="friend-info">
                        <h6 class="mb-0">${friend.name}</h6>
                        <div class="streak"><i class="fas fa-fire me-1"></i> ${friend.streak || 0} hari streak</div>
                    </div>
                    <div class="friend-status ${friend.online ? '' : 'offline'}"></div>
                </div>
            `).join('');
        }

        function createNewPost() {
            const content = document.getElementById('newPostContent').value.trim();
            
            if (!content) {
                showToast('⚠️ Konten Kosong', 'Silakan tulis sesuatu untuk diposting');
                return;
            }
            
            const newPost = {
                id: communityPosts.length + 1,
                userId: 0, // Current user
                userName: userData.name || 'User',
                userAvatar: userData.profileImage || `https://ui-avatars.com/api/?name=${encodeURIComponent(userData.name || 'User')}&background=10B981&color=fff&size=128`,
                content: content,
                type: 'general',
                likes: 0,
                comments: 0,
                shares: 0,
                timestamp: new Date().toISOString(),
                userLiked: false,
                userCommented: false
            };
            
            communityPosts.unshift(newPost);
            saveCommunityData();
            loadCommunityFeed();
            document.getElementById('newPostContent').value = '';
            showToast('✅ Postingan Dibuat', 'Postingan Anda telah dibagikan ke komunitas!');
        }

        function toggleLike(postId) {
            const post = communityPosts.find(p => p.id === postId);
            if (post) {
                if (post.userLiked) {
                    post.likes--;
                } else {
                    post.likes++;
                }
                post.userLiked = !post.userLiked;
                saveCommunityData();
                
                // Update UI
                const postElement = document.getElementById(`post-${postId}`);
                if (postElement) {
                    const likeStat = postElement.querySelector('.post-stat');
                    const likeCount = likeStat.querySelector('span');
                    const likeIcon = likeStat.querySelector('i');
                    const likeBtn = postElement.querySelector('.action-btn');
                    
                    likeCount.textContent = post.likes;
                    likeStat.classList.toggle('active');
                    likeIcon.classList.toggle('text-pink');
                    likeBtn.classList.toggle('active');
                }
            }
        }

        function showComments(postId) {
            // For now, just show a toast
            showToast('💬 Komentar', 'Fitur komentar akan segera hadir!');
        }

        function sharePost(postId) {
            const post = communityPosts.find(p => p.id === postId);
            if (post) {
                post.shares++;
                saveCommunityData();
                
                // Update UI
                const postElement = document.getElementById(`post-${postId}`);
                if (postElement) {
                    const shareStat = postElement.querySelectorAll('.post-stat')[2];
                    const shareCount = shareStat.querySelector('span');
                    shareCount.textContent = post.shares;
                }
                
                showToast('📤 Dibagikan', 'Postingan telah dibagikan!');
            }
        }

        function addPostImage() {
            showToast('🖼️ Tambah Gambar', 'Fitur upload gambar akan segera hadir!');
        }

        function addAchievement() {
            const achievements = [
                "🏆 Streak 7 Hari",
                "🎯 Capai Target Kalori",
                "💪 Workout 5x Seminggu",
                "🥦 Makan Sayur Tiap Hari",
                "💧 Minum 2L Air/Hari",
                "⚖️ Turun 1kg",
                "🧘 Meditasi Rutin",
                "🏃‍♂️ Lari 5km"
            ];
            
            const randomAchievement = achievements[Math.floor(Math.random() * achievements.length)];
            document.getElementById('newPostContent').value += `\n${randomAchievement}`;
        }

        function addFoodToPost() {
            if (foodLog.length > 0) {
                const latestFood = foodLog[foodLog.length - 1];
                document.getElementById('newPostContent').value += `\n🍽️ ${latestFood.name} - ${latestFood.calories} kkal`;
            } else {
                showToast('🍽️ Tambah Makanan', 'Tambahkan makanan ke log terlebih dahulu!');
            }
        }

        function showChallengeModal() {
            new bootstrap.Modal(document.getElementById('challengeModal')).show();
        }

        function createChallenge() {
            const title = document.getElementById('challengeTitle').value.trim();
            const description = document.getElementById('challengeDescription').value.trim();
            const duration = parseInt(document.getElementById('challengeDuration').value);
            const target = document.getElementById('challengeTarget').value.trim();
            const type = document.getElementById('challengeType').value;
            const privacy = document.getElementById('challengePrivacy').value;
            
            if (!title || !description || !target) {
                showToast('⚠️ Data Tidak Lengkap', 'Harap isi semua field yang diperlukan');
                return;
            }
            
            const newChallenge = {
                id: communityChallenges.length + 1,
                title: title,
                description: description,
                type: type,
                duration: duration,
                target: target,
                participants: 1,
                progress: 0,
                creator: {
                    name: userData.name || 'User',
                    avatar: userData.profileImage || `https://ui-avatars.com/api/?name=${encodeURIComponent(userData.name || 'User')}&background=10B981&color=fff&size=128`
                },
                privacy: privacy,
                createdAt: new Date().toISOString()
            };
            
            communityChallenges.push(newChallenge);
            saveCommunityData();
            bootstrap.Modal.getInstance(document.getElementById('challengeModal')).hide();
            
            // Reset form
            ['challengeTitle', 'challengeDescription', 'challengeTarget'].forEach(id => {
                document.getElementById(id).value = '';
            });
            
            showToast('🎯 Tantangan Dibuat', 'Tantangan baru telah dibuat!');
            loadChallenges();
        }

        function joinChallenge(challengeId) {
            const challenge = communityChallenges.find(c => c.id === challengeId);
            if (challenge) {
                challenge.participants++;
                saveCommunityData();
                loadChallenges();
                showToast('✅ Bergabung', `Anda telah bergabung dengan tantangan "${challenge.title}"`);
            }
        }

        function showGroupModal() {
            new bootstrap.Modal(document.getElementById('groupModal')).show();
        }

        function createGroup() {
            const name = document.getElementById('groupName').value.trim();
            const description = document.getElementById('groupDescription').value.trim();
            const type = document.getElementById('groupType').value;
            const privacy = document.getElementById('groupPrivacy').value;
            
            if (!name || !description) {
                showToast('⚠️ Data Tidak Lengkap', 'Harap isi nama dan deskripsi grup');
                return;
            }
            
            const newGroup = {
                id: communityGroups.length + 1,
                name: name,
                description: description,
                type: type,
                members: 1,
                privacy: privacy,
                createdAt: new Date().toISOString()
            };
            
            communityGroups.push(newGroup);
            saveCommunityData();
            bootstrap.Modal.getInstance(document.getElementById('groupModal')).hide();
            
            // Reset form
            ['groupName', 'groupDescription'].forEach(id => {
                document.getElementById(id).value = '';
            });
            
            showToast('👥 Grup Dibuat', 'Grup baru telah dibuat!');
            loadGroups();
        }

        function joinGroup(groupId) {
            const group = communityGroups.find(g => g.id === groupId);
            if (group) {
                group.members++;
                saveCommunityData();
                loadGroups();
                showToast('✅ Bergabung', `Anda telah bergabung dengan grup "${group.name}"`);
            }
        }

        function showAddFriendModal() {
            new bootstrap.Modal(document.getElementById('addFriendModal')).show();
        }

        function handleUserSearch(e) {
            const query = e.target.value.toLowerCase();
            const results = document.getElementById('searchUsersResults');
            
            if (query.length < 2) {
                results.innerHTML = '<p class="text-center text-muted">Mulai ketik untuk mencari pengguna</p>';
                return;
            }
            
            // Filter mock users (excluding current user and existing friends)
            const filteredUsers = mockUsers.filter(user => 
                user.name.toLowerCase().includes(query) && 
                !communityFriends.some(friend => friend.id === user.id) &&
                user.name.toLowerCase() !== userData.name?.toLowerCase()
            );
            
            if (filteredUsers.length > 0) {
                results.innerHTML = filteredUsers.map(user => `
                    <div class="friend-item">
                        <img src="${user.avatar}" class="friend-avatar">
                        <div class="friend-info">
                            <h6 class="mb-0">${user.name}</h6>
                            <div class="streak"><i class="fas fa-fire me-1"></i> ${user.streak} hari streak</div>
                        </div>
                        <button class="btn-primary btn-sm" onclick="addFriend(${user.id})">
                            <i class="fas fa-user-plus me-1"></i> Tambah
                        </button>
                    </div>
                `).join('');
            } else {
                results.innerHTML = `
                    <div class="empty-state py-4">
                        <i class="fas fa-search"></i>
                        <p class="mt-3">Tidak ditemukan pengguna "${query}"</p>
                    </div>
                `;
            }
        }

        function addFriend(userId) {
            const user = mockUsers.find(u => u.id === userId);
            if (user && !communityFriends.some(friend => friend.id === userId)) {
                communityFriends.push(user);
                saveCommunityData();
                showToast('👥 Teman Ditambahkan', `${user.name} telah ditambahkan sebagai teman`);
                
                // Update UI
                if (document.getElementById('communityFriends').style.display !== 'none') {
                    loadFriends();
                }
                
                // Close modal if open
                const modal = bootstrap.Modal.getInstance(document.getElementById('addFriendModal'));
                if (modal) modal.hide();
            }
        }

        // Chatbot Functions
        function showChatbot() {
            showLoading();
            setTimeout(() => {
                document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
                document.getElementById('chatbotPage').classList.add('active');
                currentChatType = 'dashboard';
                updateNavigation('chatbot');
                hideLoading();
            }, 800);
        }

        function showWelcomeChatbot() {
            currentChatType = 'welcome';
            new bootstrap.Modal(document.getElementById('welcomeChatbotModal')).show();
        }

        function closeChatbot() {
            showDashboard();
        }

        function sendQuickReply(message) {
            document.getElementById('chatInput').value = message;
            sendMessage();
        }

        function sendWelcomeQuickReply(message) {
            document.getElementById('welcomeChatInput').value = message;
            sendWelcomeMessage();
        }

        async function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message) return;

            // Add user message
            addChatMessage('user', message);
            input.value = '';

            // Show typing indicator
            showTypingIndicator('chatContainer');

            // Process message with AI
            setTimeout(() => {
                hideTypingIndicator('chatContainer');
                const response = processAIMessage(message);
                addChatMessage('bot', response);
            }, 1500);
        }

        async function sendWelcomeMessage() {
            const input = document.getElementById('welcomeChatInput');
            const message = input.value.trim();
            
            if (!message) return;

            addWelcomeChatMessage('user', message);
            input.value = '';

            // Show typing indicator
            showTypingIndicator('welcomeChatContainer');

            // Process message with AI
            setTimeout(() => {
                hideTypingIndicator('welcomeChatContainer');
                const response = processWelcomeMessage(message);
                addWelcomeChatMessage('bot', response);
            }, 1500);
        }

        function addChatMessage(sender, content) {
            const chatContainer = document.getElementById('chatContainer');
            const messageDiv = document.createElement('div');
            messageDiv.className = `chat-message ${sender}-message`;
            
            const avatar = sender === 'bot' ? '<i class="fas fa-robot"></i>' : (userData.name ? userData.name.charAt(0) : '<i class="fas fa-user"></i>');
            const name = sender === 'bot' ? 'NutriBot' : userData.name || 'Anda';
            
            messageDiv.innerHTML = `
                <div class="message-avatar">${avatar}</div>
                <div class="message-content">
                    <strong>${name}</strong>
                    <div class="mt-2">${content}</div>
                </div>
            `;
            
            chatContainer.appendChild(messageDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
            
            chatHistory.push({ sender, content, timestamp: new Date() });
        }

        function addWelcomeChatMessage(sender, content) {
            const chatContainer = document.getElementById('welcomeChatContainer');
            const messageDiv = document.createElement('div');
            messageDiv.className = `chat-message ${sender}-message`;
            
            const avatar = sender === 'bot' ? '<i class="fas fa-robot"></i>' : '<i class="fas fa-user"></i>';
            const name = sender === 'bot' ? 'NutriBot' : 'Anda';
            
            messageDiv.innerHTML = `
                <div class="message-avatar">${avatar}</div>
                <div class="message-content">
                    <strong>${name}</strong>
                    <div class="mt-2">${content}</div>
                </div>
            `;
            
            chatContainer.appendChild(messageDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        function showTypingIndicator(containerId) {
            const chatContainer = document.getElementById(containerId);
            const typingDiv = document.createElement('div');
            typingDiv.className = 'chat-message bot-message';
            typingDiv.id = 'typingIndicator';
            typingDiv.innerHTML = `
                <div class="message-avatar">
                    <i class="fas fa-robot"></i>
                </div>
                <div class="message-content">
                    <div class="typing-indicator">
                        <span></span><span></span><span></span>
                    </div>
                </div>
            `;
            chatContainer.appendChild(typingDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        function hideTypingIndicator(containerId) {
            const indicator = document.getElementById('typingIndicator');
            if (indicator) indicator.remove();
        }

        // AI Message Processing - UPDATED
        function processAIMessage(message) {
            const lowerMsg = message.toLowerCase();
            
            // Check for pattern "X gram/porsi/sendok/etc [nama makanan]"
            const caloriePattern = /(\d+)\s*(gram|gr|g|porsi|potong|sendok|sdm|butir|buah|iris|gelas|ml|l|liter)?\s+(.+)/i;
            const match = message.match(caloriePattern);
            
            if (match) {
                const quantity = parseInt(match[1]);
                const unit = match[2] ? match[2].toLowerCase() : 'gram';
                const foodName = match[3].trim();
                
                return calculateSpecificFoodCalories(foodName, quantity, unit);
            }
            
            // Check for direct calorie questions
            if (lowerMsg.includes('berapa kalori') || lowerMsg.includes('hitung kalori') || 
                lowerMsg.includes('kalori dalam') || lowerMsg.includes('kalori dari')) {
                return calculateCaloriesResponse(message);
            }
            
            // Check for community questions
            if (lowerMsg.includes('komunitas') || lowerMsg.includes('teman') || lowerMsg.includes('komunitas')) {
                return getCommunityResponse();
            }
            
            if (lowerMsg.includes('tantangan') || lowerMsg.includes('challenge')) {
                return getChallengeResponse();
            }
            
            if (lowerMsg.includes('rekomendasi') || lowerMsg.includes('saran') || lowerMsg.includes('menu')) {
                return getFoodRecommendations();
            }
            
            if (lowerMsg.includes('sarapan') || lowerMsg.includes('pagi')) {
                return getBreakfastMenu();
            }
            
            if (lowerMsg.includes('makan siang') || lowerMsg.includes('siang')) {
                return getLunchMenu();
            }
            
            if (lowerMsg.includes('makan malam') || lowerMsg.includes('malam')) {
                return getDinnerMenu();
            }
            
            if (lowerMsg.includes('deficit') || lowerMsg.includes('diet') || lowerMsg.includes('turun')) {
                return getDeficitAdvice();
            }
            
            if (lowerMsg.includes('surplus') || lowerMsg.includes('naik') || lowerMsg.includes('bulking')) {
                return getSurplusAdvice();
            }
            
            if (lowerMsg.includes('protein') || lowerMsg.includes('otot')) {
                return getProteinFoods();
            }
            
            if (lowerMsg.includes('cemilan') || lowerMsg.includes('snack')) {
                return getHealthySnacks();
            }
            
            if (lowerMsg.includes('upload') || lowerMsg.includes('gambar') || lowerMsg.includes('foto') || lowerMsg.includes('dokumen')) {
                return `
                    <p>📁 <strong>Fitur Upload File:</strong></p>
                    <p>Saya dapat menganalisis berbagai jenis file untuk membantu Anda:</p>
                    
                    <div class="nutrition-tip">
                        <p class="mb-2"><strong>✨ Jenis analisis yang tersedia:</strong></p>
                        <ul class="mb-0">
                            <li>🖼️ <strong>Gambar makanan</strong> - Estimasi kalori & nutrisi</li>
                            <li>📄 <strong>Dokumen label nutrisi</strong> - Analisis komposisi makanan</li>
                            <li>📋 <strong>Resep makanan</strong> - Hitung nutrisi per porsi</li>
                            <li>🧾 <strong>Struk belanja</strong> - Analisis pola belanja makanan</li>
                        </ul>
                    </div>
                    
                    <p class="mt-3">Klik tombol 📎 di samping input chat untuk mengupload file!</p>
                    <button class="quick-reply-btn" onclick="showImageUploadModal()">
                        <i class="fas fa-upload me-1"></i> Upload File Sekarang
                    </button>
                `;
            }
            
            // Check for food database lookup
            if (lowerMsg.includes('daftar makanan') || lowerMsg.includes('database makanan') || 
                lowerMsg.includes('apa saja makanan')) {
                return getFoodDatabaseList();
            }
            
            // Check for specific food lookup
            const foundFood = searchFoodInDatabase(lowerMsg);
            if (foundFood) {
                return showFoodInfo(foundFood);
            }
            
            // Default response
            return getDefaultResponse();
        }

        // New function to calculate specific food calories
        function calculateSpecificFoodCalories(foodName, quantity, unit) {
            // Search for food in database
            const food = searchFoodInDatabase(foodName);
            
            if (food) {
                // Convert quantity to grams if needed
                const quantityInGrams = convertToGrams(quantity, unit, foodName);
                
                // Calculate calories based on quantity
                const calories = Math.round((food.calories / (food.baseQuantity || 100)) * quantityInGrams);
                const protein = Math.round((food.protein / (food.baseQuantity || 100)) * quantityInGrams);
                const carbs = Math.round((food.carbs / (food.baseQuantity || 100)) * quantityInGrams);
                const fat = Math.round((food.fat / (food.baseQuantity || 100)) * quantityInGrams);
                
                let unitDisplay = unit === 'gram' || unit === 'gr' || unit === 'g' ? 'gram' : unit;
                
                return `
                    <p>🔢 <strong>Perhitungan Kalori untuk ${quantity} ${unitDisplay} ${food.name}:</strong></p>
                    
                    <div class="food-recommendation">
                        <div class="d-flex justify-content-between mb-2">
                            <span>Ukuran:</span>
                            <strong>${quantity} ${unitDisplay}</strong>
                        </div>
                        <div class="d-flex justify-content-between mb-2">
                            <span>🔥 Total Kalori:</span>
                            <strong class="text-green">${calories} kkal</strong>
                        </div>
                        <div class="d-flex justify-content-between mb-2">
                            <span>🥩 Protein:</span>
                            <strong>${protein}g</strong>
                        </div>
                        <div class="d-flex justify-content-between mb-2">
                            <span>🍚 Karbohidrat:</span>
                            <strong>${carbs}g</strong>
                        </div>
                        <div class="d-flex justify-content-between mb-2">
                            <span>🥑 Lemak:</span>
                            <strong>${fat}g</strong>
                        </div>
                        <div class="d-flex justify-content-between">
                            <span>📊 Per 100g:</span>
                            <strong>${food.calories} kkal</strong>
                        </div>
                    </div>
                    
                    <div class="nutrition-tip mt-3">
                        <p><strong>📝 Informasi Nutrisi ${food.name}:</strong></p>
                        <div>• ${food.description || getFoodDescription(food.name)}</div>
                        ${food.benefits ? `<div>• Manfaat: ${food.benefits}</div>` : ''}
                        ${food.tips ? `<div>• Tips: ${food.tips}</div>` : ''}
                    </div>
                    
                    <div class="d-flex gap-2 mt-3">
                        <button class="quick-reply-btn" onclick="addFoodFromChat('${food.name}', ${calories}, ${protein}, ${carbs}, ${fat}, '${quantity} ${unitDisplay}')">
                            <i class="fas fa-plus me-1"></i> Tambah ke Log
                        </button>
                        <button class="quick-reply-btn" onclick="sendQuickReply('Rekomendasi makanan sehat')">
                            <i class="fas fa-utensils me-1"></i> Lihat Rekomendasi
                        </button>
                    </div>
                    
                    <p class="mt-3 small text-muted">
                        💡 <strong>Contoh query lain:</strong><br>
                        • "50 gram tempe"<br>
                        • "1 porsi nasi goreng"<br>
                        • "2 butir telur"<br>
                        • "200 ml susu"
                    </p>
                `;
            } else {
                return `
                    <p>🔍 <strong>Makanan "${foodName}" tidak ditemukan dalam database saya.</strong></p>
                    
                    <div class="nutrition-tip">
                        <p><strong>📊 Perkiraan untuk ${quantity} ${unit} ${foodName}:</strong></p>
                        ${getEstimatedNutrition(foodName, quantity, unit)}
                    </div>
                    
                    <p class="mt-3">💡 <strong>Tips:</strong></p>
                    <div>• Gunakan contoh: "100 gram nasi", "1 porsi ayam goreng", "2 butir telur"</div>
                    <div>• Untuk analisis akurat, upload foto makanan Anda</div>
                    <div>• Atau cari makanan serupa di database saya</div>
                    
                    <button class="quick-reply-btn mt-3" onclick="showImageUploadModal()">
                        <i class="fas fa-image me-1"></i> Upload Foto Makanan
                    </button>
                    
                    <button class="quick-reply-btn mt-3" onclick="sendQuickReply('Daftar makanan dalam database')">
                        <i class="fas fa-list me-1"></i> Lihat Database Makanan
                    </button>
                `;
            }
        }

        // Search food in database
        function searchFoodInDatabase(foodName) {
            const lowerFoodName = foodName.toLowerCase();
            
            // Exact match
            for (const food of foodDatabase) {
                if (food.name.toLowerCase() === lowerFoodName || 
                    food.name.toLowerCase().includes(lowerFoodName) ||
                    lowerFoodName.includes(food.name.toLowerCase())) {
                    return food;
                }
            }
            
            // Partial match
            for (const food of foodDatabase) {
                const foodWords = food.name.toLowerCase().split(' ');
                const inputWords = lowerFoodName.split(' ');
                
                const matchCount = inputWords.filter(word => 
                    foodWords.some(foodWord => foodWord.includes(word) || word.includes(foodWord))
                ).length;
                
                if (matchCount >= Math.min(2, inputWords.length)) {
                    return food;
                }
            }
            
            // Alias matching
            const foodAliases = {
                'nasi': 'Nasi Putih',
                'ayam goreng': 'Ayam Goreng',
                'telur': 'Telur Dadar',
                'tempe': 'Tempe Goreng',
                'tahu': 'Tahu Goreng',
                'sate': 'Sate Ayam',
                'rendang': 'Rendang Sapi',
                'soto': 'Soto Ayam',
                'bakso': 'Bakso Sapi',
                'mie': 'Mie Goreng',
                'gado': 'Gado-gado',
                'pisang': 'Pisang',
                'alpukat': 'Alpukat',
                'yogurt': 'Yogurt Plain',
                'oat': 'Oatmeal',
                'susu': 'Susu Full Cream',
                'air': 'Air Mineral',
                'kopi': 'Kopi Hitam',
                'teh': 'Teh Manis',
                'jus': 'Jus Jeruk',
                'roti': 'Roti Gandum'
            };
            
            for (const [alias, realName] of Object.entries(foodAliases)) {
                if (lowerFoodName.includes(alias)) {
                    return foodDatabase.find(f => f.name === realName);
                }
            }
            
            return null;
        }

        // Convert units to grams
        function convertToGrams(quantity, unit, foodName) {
            const lowerUnit = unit.toLowerCase();
            const lowerFoodName = foodName.toLowerCase();
            
            const conversionRates = {
                // Weight
                'gram': 1,
                'gr': 1,
                'g': 1,
                'kg': 1000,
                'ons': 100,
                
                // Volume (approximate for liquids)
                'ml': 1, // 1ml ≈ 1g for water
                'liter': 1000,
                'l': 1000,
                'gelas': 200, // approx 200ml per glass
                
                // Pieces (estimates)
                'porsi': 150, // average portion size
                'potong': 50, // average piece size
                'butir': 50, // average egg size
                'buah': 100, // average fruit size
                'iris': 30, // average slice
                'sendok': 15, // tablespoon
                'sdm': 15, // tablespoon
                'sdt': 5, // teaspoon
                
                // Beverages
                'cangkir': 150, // cup
                'botol': 330, // small bottle
                'kaleng': 330, // can
            };
            
            // Special cases for specific foods
            if (lowerFoodName.includes('nasi') && (lowerUnit === 'porsi' || lowerUnit === 'mangkuk')) {
                return 150; // 1 portion of rice ≈ 150g
            }
            
            if (lowerFoodName.includes('ayam') && lowerUnit === 'potong') {
                return 100; // 1 piece of chicken ≈ 100g
            }
            
            if (lowerFoodName.includes('telur') && lowerUnit === 'butir') {
                return 50; // 1 egg ≈ 50g
            }
            
            return conversionRates[lowerUnit] || 100; // default to 100g if unit unknown
        }

        // Get food description
        function getFoodDescription(foodName) {
            const descriptions = {
                'nasi': 'Sumber karbohidrat utama, memberikan energi untuk aktivitas sehari-hari',
                'ayam': 'Sumber protein hewani yang baik untuk pertumbuhan dan perbaikan sel',
                'telur': 'Protein lengkap dengan semua asam amino esensial',
                'tempe': 'Protein nabati fermentasi yang kaya nutrisi',
                'tahu': 'Protein nabati rendah lemak dari kacang kedelai',
                'ikan': 'Sumber protein dan omega-3 yang baik untuk jantung',
                'sayur': 'Sumber vitamin, mineral, dan serat untuk kesehatan pencernaan',
                'buah': 'Sumber vitamin, mineral, dan antioksidan alami',
                'susu': 'Sumber kalsium untuk kesehatan tulang dan gigi'
            };
            
            const lowerName = foodName.toLowerCase();
            for (const [key, desc] of Object.entries(descriptions)) {
                if (lowerName.includes(key)) {
                    return desc;
                }
            }
            
            return 'Makanan sumber nutrisi penting untuk tubuh';
        }

        // Get estimated nutrition for unknown foods
        function getEstimatedNutrition(foodName, quantity, unit) {
            const lowerName = foodName.toLowerCase();
            let estimate = '';
            
            if (lowerName.includes('nasi') || lowerName.includes('karbo') || lowerName.includes('kentang')) {
                estimate = `Perkiraan: ${quantity} ${unit} mengandung sekitar ${Math.round(quantity * 1.3)} kkal, terutama dari karbohidrat`;
            } else if (lowerName.includes('ayam') || lowerName.includes('daging') || lowerName.includes('ikan')) {
                estimate = `Perkiraan: ${quantity} ${unit} mengandung sekitar ${Math.round(quantity * 2.5)} kkal, tinggi protein`;
            } else if (lowerName.includes('sayur') || lowerName.includes('brokoli') || lowerName.includes('bayam')) {
                estimate = `Perkiraan: ${quantity} ${unit} mengandung sekitar ${Math.round(quantity * 0.3)} kkal, rendah kalori tinggi serat`;
            } else if (lowerName.includes('buah') || lowerName.includes('apel') || lowerName.includes('pisang')) {
                estimate = `Perkiraan: ${quantity} ${unit} mengandung sekitar ${Math.round(quantity * 0.6)} kkal, sumber vitamin`;
            } else if (lowerName.includes('minuman') || lowerName.includes('jus') || lowerName.includes('soda')) {
                estimate = `Perkiraan: ${quantity} ${unit} mengandung sekitar ${Math.round(quantity * 0.4)} kkal, perhatikan kandungan gula`;
            } else {
                estimate = `Perkiraan: ${quantity} ${unit} mengandung sekitar ${Math.round(quantity * 1)} kkal`;
            }
            
            return estimate;
        }

        // Get food database list
        function getFoodDatabaseList() {
            const categories = {};
            
            // Group foods by category
            foodDatabase.forEach(food => {
                if (!categories[food.category]) {
                    categories[food.category] = [];
                }
                categories[food.category].push(food);
            });
            
            let response = `<p>📚 <strong>Database Makanan BiteCount:</strong></p>`;
            
            // Create category sections
            Object.entries(categories).forEach(([category, foods]) => {
                response += `
                    <div class="food-recommendation mt-3">
                        <h6>${getCategoryName(category)}</h6>
                        <div class="mt-2">
                `;
                
                foods.forEach(food => {
                    response += `
                        <div class="d-flex justify-content-between align-items-center py-2 border-bottom">
                            <div>
                                <strong>${food.name}</strong>
                                <div class="small text-muted">${food.portion}</div>
                            </div>
                            <div class="text-end">
                                <div class="text-green"><strong>${food.calories} kkal</strong></div>
                                <div class="small">🥩${food.protein}g 🍚${food.carbs}g 🥑${food.fat}g</div>
                            </div>
                        </div>
                    `;
                });
                
                response += `</div></div>`;
            });
            
            response += `
                <div class="nutrition-tip mt-3">
                    <p><strong>💡 Cara menggunakan:</strong></p>
                    <div>• Tanya: "100 gram nasi" → hasil: kalori untuk 100g nasi</div>
                    <div>• Tanya: "2 butir telur" → hasil: kalori untuk 2 telur</div>
                    <div>• Tanya: "1 porsi ayam goreng" → hasil: kalori 1 porsi ayam</div>
                </div>
                
                <p class="mt-3">🔍 <strong>Coba contoh:</strong></p>
                <div class="d-flex flex-wrap gap-2">
                    <button class="quick-reply-btn" onclick="sendQuickReply('100 gram nasi')">
                        100 gram nasi
                    </button>
                    <button class="quick-reply-btn" onclick="sendQuickReply('2 butir telur')">
                        2 butir telur
                    </button>
                    <button class="quick-reply-btn" onclick="sendQuickReply('1 porsi ayam goreng')">
                        1 porsi ayam
                    </button>
                    <button class="quick-reply-btn" onclick="sendQuickReply('200 ml susu')">
                        200 ml susu
                    </button>
                </div>
            `;
            
            return response;
        }

        // Get category name
        function getCategoryName(category) {
            const categoryNames = {
                'grains': '🌾 Nasi & Biji-bijian',
                'protein': '🥩 Protein',
                'main-dish': '🍛 Makanan Utama',
                'soup': '🍲 Sup & Kuah',
                'noodles': '🍜 Mie & Pasta',
                'vegetables': '🥬 Sayuran',
                'fruits': '🍎 Buah-buahan',
                'dairy': '🥛 Susu & Produk Susu',
                'beverages': '🥤 Minuman',
                'snacks': '🍿 Camilan',
                'breakfast': '🍳 Sarapan'
            };
            
            return categoryNames[category] || category;
        }

        // Show food info
        function showFoodInfo(food) {
            return `
                <p>🍽️ <strong>Informasi Nutrisi ${food.name}:</strong></p>
                
                <div class="food-recommendation">
                    <div class="d-flex justify-content-between mb-2">
                        <span>Ukuran Porsi:</span>
                        <strong>${food.portion}</strong>
                    </div>
                    <div class="d-flex justify-content-between mb-2">
                        <span>🔥 Kalori:</span>
                        <strong class="text-green">${food.calories} kkal</strong>
                    </div>
                    <div class="d-flex justify-content-between mb-2">
                        <span>🥩 Protein:</span>
                        <strong>${food.protein}g</strong>
                    </div>
                    <div class="d-flex justify-content-between mb-2">
                        <span>🍚 Karbohidrat:</span>
                        <strong>${food.carbs}g</strong>
                    </div>
                    <div class="d-flex justify-content-between">
                        <span>🥑 Lemak:</span>
                        <strong>${food.fat}g</strong>
                    </div>
                </div>
                
                ${food.description ? `
                    <div class="nutrition-tip mt-3">
                        <p><strong>📝 Deskripsi:</strong></p>
                        <div>${food.description}</div>
                    </div>
                ` : ''}
                
                ${food.benefits ? `
                    <div class="nutrition-tip mt-2">
                        <p><strong>✅ Manfaat:</strong></p>
                        <div>${food.benefits}</div>
                    </div>
                ` : ''}
                
                ${food.tips ? `
                    <div class="food-recommendation mt-2">
                        <p><strong>💡 Tips:</strong></p>
                        <div>${food.tips}</div>
                    </div>
                ` : ''}
                
                <p class="mt-3"><strong>🔢 Hitung kalori untuk jumlah tertentu:</strong></p>
                <div class="d-flex flex-wrap gap-2">
                    <button class="quick-reply-btn" onclick="sendQuickReply('100 gram ${food.name}')">
                        100 gram
                    </button>
                    <button class="quick-reply-btn" onclick="sendQuickReply('1 porsi ${food.name}')">
                        1 porsi
                    </button>
                    <button class="quick-reply-btn" onclick="sendQuickReply('2 ${food.name}')">
                        2 ${food.name.split(' ')[0]}
                    </button>
                </div>
                
                <div class="d-flex gap-2 mt-3">
                    <button class="quick-reply-btn" onclick="addFoodFromChat('${food.name}', ${food.calories}, ${food.protein}, ${food.carbs}, ${food.fat}, '${food.portion}')">
                        <i class="fas fa-plus me-1"></i> Tambah ke Log
                    </button>
                    <button class="quick-reply-btn" onclick="sendQuickReply('Daftar makanan dalam database')">
                        <i class="fas fa-list me-1"></i> Database Lain
                    </button>
                </div>
            `;
        }

        // Update calculateCaloriesResponse function
        function calculateCaloriesResponse(message) {
            const foodName = extractFoodName(message);
            const quantityMatch = message.match(/(\d+)\s*(gram|gr|g|porsi|potong|sendok|sdm|butir|buah|iris|gelas|ml|l|liter)?/i);
            
            let quantity = 100; // default 100g
            let unit = 'gram'; // default unit
            
            if (quantityMatch) {
                quantity = parseInt(quantityMatch[1]);
                unit = quantityMatch[2] ? quantityMatch[2].toLowerCase() : 'gram';
            }
            
            return calculateSpecificFoodCalories(foodName, quantity, unit);
        }

        function extractFoodName(message) {
            const words = message.toLowerCase().split(' ');
            const stopWords = ['berapa', 'kalori', 'dalam', 'hitung', 'ada', 'di', 'untuk', 'apa', 'yang'];
            const foodWords = words.filter(w => !stopWords.includes(w) && w.length > 2);
            return foodWords.join(' ') || 'makanan tersebut';
        }

        function getFoodRecommendations() {
            if (!userData.dailyTarget) {
                return `<p>Silakan setup profil terlebih dahulu untuk mendapatkan rekomendasi personal!</p>`;
            }
            
            const remaining = userData.dailyTarget - foodLog.reduce((sum, f) => sum + f.calories, 0);
            const goal = userData.goal;
            
            let recommendations = [];
            
            if (goal === 'deficit') {
                recommendations = foodDatabase
                    .filter(f => f.calories < 300 && f.protein > 10)
                    .sort((a, b) => a.calories - b.calories)
                    .slice(0, 6);
            } else if (goal === 'surplus') {
                recommendations = foodDatabase
                    .filter(f => f.calories > 300 && f.protein > 15)
                    .sort((a, b) => b.calories - a.calories)
                    .slice(0, 6);
            } else {
                recommendations = foodDatabase
                    .filter(f => f.calories > 150 && f.calories < 400)
                    .slice(0, 6);
            }
            
            let response = `
                <p>🥗 <strong>Rekomendasi Makanan untuk Target "${userData.goalText}":</strong></p>
                <p><strong>Sisa kalori hari ini: ${Math.max(remaining, 0)} kkal</strong></p>
            `;
            
            recommendations.forEach(food => {
                response += `
                    <div class="food-recommendation">
                        <div class="d-flex justify-content-between align-items-start">
                            <div>
                                <strong>${food.name}</strong>
                                <div class="small text-muted">${food.portion}</div>
                            </div>
                            <span class="badge bg-green">${food.calories} kkal</span>
                        </div>
                        <div class="mt-2">
                            <span class="badge bg-green me-2">🥩 ${food.protein}g</span>
                            <span class="badge bg-pink me-2">🍚 ${food.carbs}g</span>
                            <span class="badge bg-secondary">🥑 ${food.fat}g</span>
                        </div>
                    </div>
                `;
            });
            
            response += `
                <div class="text-center mt-3">
                    <button class="quick-reply-btn" onclick="showAddFoodModal()">
                        <i class="fas fa-plus me-1"></i> Tambah Makanan Lain
                    </button>
                </div>
            `;
            
            return response;
        }

        function getBreakfastMenu() {
            return `
                <p>🌅 <strong>Rekomendasi Menu Sarapan Sehat:</strong></p>
                
                <div class="nutrition-tip">
                    <p><strong>💡 Tips Sarapan Sehat:</strong></p>
                    <div>• Sarapan sebaiknya 20-25% dari total kalori harian</div>
                    <div>• Kombinasikan protein, karbohidrat kompleks, dan serat</div>
                    <div>• Hindari sarapan tinggi gula yang membuat cepat lapar</div>
                </div>
                
                <div class="food-recommendation mt-3">
                    <strong>🍳 Opsi 1: Sarapan Tinggi Protein (350 kkal)</strong>
                    <div>• 2 butir telur dadar dengan sayuran</div>
                    <div>• 1 potong roti gandum</div>
                    <div>• 1 gelas susu rendah lemak</div>
                </div>
                
                <div class="food-recommendation mt-2">
                    <strong>🥣 Opsi 2: Sarapan Serat Tinggi (300 kkal)</strong>
                    <div>• Oatmeal 40g dengan buah berry</div>
                    <div>• 1 sendok makan chia seeds</div>
                    <div>• 1 gelas teh hijau tanpa gula</div>
                </div>
                
                <div class="food-recommendation mt-2">
                    <strong>🥗 Opsi 3: Sarapan Rendah Kalori (250 kkal)</strong>
                    <div>• Smoothie bowl: pisang, bayam, yogurt</div>
                    <div>• 1 sendok makan almond butter</div>
                    <div>• Taburan granola rendah gula</div>
                </div>
            `;
        }

        function getLunchMenu() {
            return `
                <p>☀️ <strong>Rekomendasi Menu Makan Siang Sehat:</strong></p>
                
                <div class="nutrition-tip">
                    <p><strong>💡 Tips Makan Siang:</strong></p>
                    <div>• Makan siang sebaiknya 35-40% dari total kalori harian</div>
                    <div>• Porsi terbesar untuk energi sepanjang hari</div>
                    <div>• Kombinasi protein, karbohidrat, sayuran</div>
                </div>
                
                <div class="food-recommendation mt-3">
                    <strong>🍱 Opsi 1: Menu Lengkap (650 kkal)</strong>
                    <div>• Nasi merah 150g (160 kkal)</div>
                    <div>• Ayam panggang tanpa kulit 150g (250 kkal)</div>
                    <div>• Sayur brokoli dan wortel kukus (80 kkal)</div>
                    <div>• Tahu goreng 100g (160 kkal)</div>
                </div>
                
                <div class="food-recommendation mt-2">
                    <strong>🥘 Opsi 2: Menu Rendah Karbo (550 kkal)</strong>
                    <div>• Salad dengan ayam panggang 200g (300 kkal)</div>
                    <div>• Alpukat 1/2 buah (120 kkal)</div>
                    <div>• Kacang merah 50g (130 kkal)</div>
                    <div>• Dressing minyak zaitun</div>
                </div>
                
                <div class="food-recommendation mt-2">
                    <strong>🍲 Opsi 3: Menu Traditional Indonesia (600 kkal)</strong>
                    <div>• Nasi putih 100g (130 kkal)</div>
                    <div>• Ikan bakar 150g (200 kkal)</div>
                    <div>• Tempe goreng 100g (190 kkal)</div>
                    <div>• Sayur asem (80 kkal)</div>
                </div>
            `;
        }

        function getDinnerMenu() {
            return `
                <p>🌙 <strong>Rekomendasi Menu Makan Malam Sehat:</strong></p>
                
                <div class="nutrition-tip">
                    <p><strong>💡 Tips Makan Malam:</strong></p>
                    <div>• Makan malam sebaiknya 25-30% dari total kalori harian</div>
                    <div>• Lebih ringan dari makan siang</div>
                    <div>• Hindari makan 3 jam sebelum tidur</div>
                    <div>• Fokus pada protein dan sayuran</div>
                </div>
                
                <div class="food-recommendation mt-3">
                    <strong>🥣 Opsi 1: Makan Malam Ringan (400 kkal)</strong>
                    <div>• Sup ayam dengan sayuran (250 kkal)</div>
                    <div>• Roti gandum 1 potong (80 kkal)</div>
                    <div>• Buah apel 1 buah (70 kkal)</div>
                </div>
                
                <div class="food-recommendation mt-2">
                    <strong>🥗 Opsi 2: Salad Protein (350 kkal)</strong>
                    <div>• Mix greens dengan tuna (200 kkal)</div>
                    <div>• Telur rebus 1 butir (70 kkal)</div>
                    <div>• Alpukat 1/4 buah (60 kkal)</div>
                    <div>• Dressing lemon dan olive oil (20 kkal)</div>
                </div>
                
                <div class="food-recommendation mt-2">
                    <strong>🍲 Opsi 3: Indonesian Light Dinner (450 kkal)</strong>
                    <div>• Soto ayam tanpa nasi (220 kkal)</div>
                    <div>• Tahu goreng 2 potong (150 kkal)</div>
                    <div>• Kerupuk 2 buah (80 kkal)</div>
                </div>
            `;
        }

        function getDeficitAdvice() {
            return `
                <p>📉 <strong>Panduan Diet Defisit Kalori:</strong></p>
                
                <div class="nutrition-tip">
                    <p><strong>Prinsip Dasar Defisit Kalori:</strong></p>
                    <div>• Kurangi 300-500 kkal dari TDEE Anda</div>
                    <div>• Fokus pada makanan tinggi protein dan serat</div>
                    <div>• Minum air putih 2-3 liter per hari</div>
                    <div>• Makan perlahan, kunyah dengan baik</div>
                    <div>• Tidur yang cukup 7-8 jam per malam</div>
                </div>
                
                <div class="food-recommendation mt-3">
                    <p><strong>✅ Makanan yang Disarankan:</strong></p>
                    <div>• Sayuran hijau (brokoli, bayam, kangkung)</div>
                    <div>• Protein tanpa lemak (ayam, ikan, telur, tahu)</div>
                    <div>• Buah-buahan rendah gula (berry, apel, pir)</div>
                    <div>• Karbohidrat kompleks (nasi merah, oatmeal, ubi)</div>
                </div>
                
                <div class="nutrition-tip mt-3">
                    <p><strong>❌ Hindari atau Batasi:</strong></p>
                    <div>• Makanan tinggi gula dan tepung olahan</div>
                    <div>• Minuman manis dan soda</div>
                    <div>• Gorengan dan makanan tinggi lemak jenuh</div>
                    <div>• Makanan cepat saji</div>
                </div>
                
                <p class="mt-3">💪 <strong>Kombinasikan</strong> dengan olahraga kardio 3-4x seminggu dan strength training 2-3x seminggu untuk hasil terbaik!</p>
            `;
        }

        function getSurplusAdvice() {
            return `
                <p>📈 <strong>Panduan Diet Surplus Kalori (Bulking):</strong></p>
                
                <div class="nutrition-tip">
                    <p><strong>Prinsip Dasar Surplus Kalori:</strong></p>
                    <div>• Tambah 300-500 kkal dari TDEE Anda</div>
                    <div>• Protein: 1.6-2.2g per kg berat badan</div>
                    <div>• Karbohidrat kompleks untuk energi latihan</div>
                    <div>• Lemak sehat untuk hormon dan pemulihan</div>
                    <div>• Makan setiap 3-4 jam</div>
                </div>
                
                <div class="food-recommendation mt-3">
                    <p><strong>✅ Makanan yang Disarankan:</strong></p>
                    <div>• Sumber protein: ayam, ikan, daging, telur, susu</div>
                    <div>• Karbohidrat kompleks: nasi, kentang, oatmeal, pasta</div>
                    <div>• Lemak sehat: alpukat, kacang-kacangan, minyak zaitun</div>
                    <div>• Buah-buahan: pisang, mangga, buah kering</div>
                </div>
                
                <div class="nutrition-tip mt-3">
                    <p><strong>🍽️ Contoh Jadwal Makan (3000 kkal):</strong></p>
                    <div>• Sarapan (07:00): 700 kkal</div>
                    <div>• Snack pagi (10:00): 300 kkal</div>
                    <div>• Makan siang (13:00): 800 kkal</div>
                    <div>• Pre-workout (16:00): 300 kkal</div>
                    <div>• Post-workout (18:30): 400 kkal</div>
                    <div>• Makan malam (20:30): 500 kkal</div>
                </div>
                
                <p class="mt-3">🏋️ <strong>Kombinasikan</strong> dengan program strength training yang terstruktur dan istirahat yang cukup untuk pertumbuhan otot optimal!</p>
            `;
        }

        function getProteinFoods() {
            const highProteinFoods = foodDatabase
                .filter(f => f.protein > 10)
                .sort((a, b) => b.protein - a.protein)
                .slice(0, 8);
            
            let response = `<p>🥩 <strong>Makanan Tinggi Protein:</strong></p>`;
            
            response += `
                <div class="nutrition-tip">
                    <p><strong>💡 Manfaat Protein:</strong></p>
                    <div>• Membangun dan memperbaiki jaringan otot</div>
                    <div>• Membuat kenyang lebih lama</div>
                    <div>• Meningkatkan metabolisme</div>
                    <div>• Mendukung sistem imun</div>
                </div>
            `;
            
            highProteinFoods.forEach(food => {
                response += `
                    <div class="food-recommendation mt-2">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <strong>${food.name}</strong>
                                <div class="small text-muted">${food.portion}</div>
                            </div>
                            <div class="text-end">
                                <div class="macro-value">${food.protein}g</div>
                                <div class="macro-label">protein</div>
                            </div>
                        </div>
                        <div class="mt-2">
                            <span class="badge bg-green">${food.calories} kkal</span>
                            <span class="badge bg-pink ms-2">${food.carbs}g karbo</span>
                            <span class="badge bg-secondary ms-2">${food.fat}g lemak</span>
                        </div>
                    </div>
                `;
            });
            
            response += `
                <p class="mt-3">💪 <strong>Rekomendasi asupan protein:</strong></p>
                <div>• Pemula: 1.2-1.5g per kg berat badan</div>
                <div>• Aktif olahraga: 1.6-2.2g per kg berat badan</div>
                <div>• Atlet: 2.2-2.5g per kg berat badan</div>
            `;
            
            return response;
        }

        function getHealthySnacks() {
            const healthySnacks = [
                { name: "Yogurt Greek", calories: 100, protein: 10, carbs: 4, fat: 0.4, portion: "100g" },
                { name: "Kacang Almond", calories: 164, protein: 6, carbs: 6, fat: 14, portion: "28g (23 biji)" },
                { name: "Telur Rebus", calories: 78, protein: 6, carbs: 1, fat: 5, portion: "1 butir" },
                { name: "Buah Apel", calories: 95, protein: 0.5, carbs: 25, fat: 0.3, portion: "1 buah sedang" },
                { name: "Edamame", calories: 120, protein: 11, carbs: 9, fat: 5, portion: "100g" },
                { name: "Keju Cottage", calories: 84, protein: 14, carbs: 3, fat: 2.3, portion: "100g" },
                { name: "Wortel Baby", calories: 35, protein: 1, carbs: 8, fat: 0.2, portion: "100g" },
                { name: "Pisang", calories: 105, protein: 1.3, carbs: 27, fat: 0.4, portion: "1 buah sedang" }
            ];
            
            let response = `<p>🍎 <strong>Cemilan Sehat Rekomendasi:</strong></p>`;
            
            response += `
                <div class="nutrition-tip">
                    <p><strong>💡 Tips Memilih Cemilan Sehat:</strong></p>
                    <div>• Pilih cemilan dengan protein dan serat</div>
                    <div>• Batasi cemilan tinggi gula dan garam</div>
                    <div>• Perhatikan porsi (100-200 kkal per cemilan)</div>
                    <div>• Minum air putih bersama cemilan</div>
                </div>
            `;
            
            healthySnacks.forEach(snack => {
                response += `
                    <div class="food-recommendation mt-2">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <strong>${snack.name}</strong>
                                <div class="small text-muted">${snack.portion}</div>
                            </div>
                            <span class="badge bg-green">${snack.calories} kkal</span>
                        </div>
                        <div class="mt-2">
                            <span class="badge bg-green">🥩 ${snack.protein}g</span>
                            <span class="badge bg-pink ms-2">🍚 ${snack.carbs}g</span>
                            <span class="badge bg-secondary ms-2">🥑 ${snack.fat}g</span>
                        </div>
                    </div>
                `;
            });
            
            response += `
                <p class="mt-3">⏰ <strong>Waktu cemilan yang tepat:</strong></p>
                <div>• Pagi (10:00-11:00): Cemilan protein tinggi</div>
                <div>• Sore (15:00-16:00): Cemilan buah atau kacang</div>
                <div>• Malam (21:00): Cemilan ringan jika lapar</div>
            `;
            
            return response;
        }

        function getCommunityResponse() {
            return `
                <p>👥 <strong>Fitur Komunitas BiteCount:</strong></p>
                
                <div class="nutrition-tip">
                    <p><strong>✨ Apa yang bisa Anda lakukan di komunitas:</strong></p>
                    <ul class="mb-0">
                        <li>📝 <strong>Bagikan postingan</strong> tentang pencapaian Anda</li>
                        <li>🎯 <strong>Ikuti tantangan</strong> bersama komunitas</li>
                        <li>🏆 <strong>Lihat peringkat</strong> di leaderboard</li>
                        <li>👥 <strong>Bergabung dengan grup</strong> sesuai minat</li>
                        <li>🤝 <strong>Tambah teman</strong> untuk saling mendukung</li>
                    </ul>
                </div>
                
                <p class="mt-3"><strong>🏆 Pencapaian yang bisa Anda dapatkan:</strong></p>
                <div class="d-flex flex-wrap gap-2">
                    <span class="achievement-badge"><i class="fas fa-fire"></i> Streak 7 Hari</span>
                    <span class="achievement-badge"><i class="fas fa-trophy"></i> Tantangan Selesai</span>
                    <span class="achievement-badge"><i class="fas fa-users"></i> Komunitas Aktif</span>
                </div>
                
                <p class="mt-3">Klik tombol 👥 di dashboard untuk mulai menjelajahi komunitas!</p>
                
                <button class="quick-reply-btn mt-2" onclick="showCommunity()">
                    <i class="fas fa-users me-1"></i> Buka Komunitas
                </button>
            `;
        }

        function getChallengeResponse() {
            return `
                <p>🎯 <strong>Tantangan Komunitas BiteCount:</strong></p>
                
                <div class="nutrition-tip">
                    <p><strong>🔥 Tantangan yang sedang aktif:</strong></p>
                    <div>• <strong>30 Days Water Challenge</strong> - Minum 2L air/hari (${communityChallenges[0]?.participants || 0} peserta)</div>
                    <div>• <strong>10k Steps Daily</strong> - 10.000 langkah/hari (${communityChallenges[1]?.participants || 0} peserta)</div>
                    <div>• <strong>Vegetarian Week</strong> - Makan vegetarian 7 hari (${communityChallenges[2]?.participants || 0} peserta)</div>
                </div>
                
                <p class="mt-3"><strong>💪 Manfaat ikut tantangan:</strong></p>
                <div>• Meningkatkan motivasi dan konsistensi</div>
                <div>• Dukungan dari komunitas</div>
                <div>• Track progress yang terstruktur</div>
                <div>• Dapatkan achievement dan poin</div>
                
                <div class="d-flex gap-2 mt-3">
                    <button class="quick-reply-btn" onclick="showCommunity()">
                        <i class="fas fa-flag me-1"></i> Lihat Tantangan
                    </button>
                    <button class="quick-reply-btn" onclick="sendQuickReply('Tips konsisten olahraga')">
                        <i class="fas fa-dumbbell me-1"></i> Tips Konsisten
                    </button>
                </div>
            `;
        }

        function getDefaultResponse() {
            return `
                <p>Hmm, saya tidak yakin memahami pertanyaan Anda. Saya bisa membantu dengan:</p>
                
                <div class="d-flex flex-wrap gap-2 mt-3">
                    <button class="quick-reply-btn" onclick="sendQuickReply('100 gram nasi')">
                        🔢 Hitung Kalori Makanan
                    </button>
                    <button class="quick-reply-btn" onclick="sendQuickReply('Rekomendasi makanan sehat')">
                        🥗 Rekomendasi Makanan
                    </button>
                    <button class="quick-reply-btn" onclick="sendQuickReply('Menu sarapan sehat')">
                        🍽️ Menu Harian
                    </button>
                    <button class="quick-reply-btn" onclick="sendQuickReply('Tips diet deficit')">
                        📉 Tips Diet Deficit
                    </button>
                    <button class="quick-reply-btn" onclick="showImageUploadModal()">
                        📸 Upload File Analisis
                    </button>
                </div>
                
                <p class="mt-3">Atau tanyakan sesuatu yang spesifik tentang nutrisi dan diet!</p>
            `;
        }

        // Welcome chatbot processing
        function processWelcomeMessage(message) {
            const lowerMsg = message.toLowerCase();
            
            if (lowerMsg.includes('cara hitung') || lowerMsg.includes('menghitung') || lowerMsg.includes('kebutuhan kalori')) {
                return `
                    <p>🧮 <strong>Cara Menghitung Kebutuhan Kalori:</strong></p>
                    
                    <div class="food-recommendation">
                        <p><strong>1. BMR (Basal Metabolic Rate):</strong></p>
                        <div>• <strong>Pria:</strong> (10 × berat kg) + (6.25 × tinggi cm) - (5 × usia) + 5</div>
                        <div>• <strong>Wanita:</strong> (10 × berat kg) + (6.25 × tinggi cm) - (5 × usia) - 161</div>
                        
                        <p class="mt-3"><strong>2. TDEE (Total Daily Energy Expenditure):</strong></p>
                        <div>• <strong>Rumus:</strong> BMR × tingkat aktivitas</div>
                        <div>• Sangat sedentari (jarang olahraga): ×1.2</div>
                        <div>• Sedikit aktif (1-3x/minggu): ×1.375</div>
                        <div>• Cukup aktif (3-5x/minggu): ×1.55</div>
                        <div>• Sangat aktif (6-7x/minggu): ×1.725</div>
                        <div>• Ekstra aktif (olahraga 2x sehari): ×1.9</div>
                        
                        <p class="mt-3"><strong>3. Target Kalori Harian:</strong></p>
                        <div>• <span class="text-green">Turun berat:</span> TDEE - 500 kkal</div>
                        <div>• <span class="text-pink">Pertahankan:</span> TDEE</div>
                        <div>• <span class="text-gradient">Naik berat:</span> TDEE + 500 kkal</div>
                    </div>
                    
                    <p class="mt-3"><strong>Contoh:</strong> Pria 30 tahun, 70kg, 170cm, aktivitas sedang = ±2500 kkal/hari</p>
                    
                    <button class="quick-reply-btn mt-2" onclick="sendWelcomeQuickReply('Apa itu BMR dan TDEE?')">
                        📚 Pelajari Lebih Lanjut
                    </button>
                `;
            }
            
            if (lowerMsg.includes('tips') || lowerMsg.includes('pemula') || lowerMsg.includes('awal')) {
                return `
                    <p>💡 <strong>Tips Diet Sehat untuk Pemula:</strong></p>
                    
                    <div class="nutrition-tip">
                        <p><strong>Prinsip Dasar Diet Sehat:</strong></p>
                        <div>1. <strong>Konsistensi</strong> lebih penting daripada kesempurnaan</div>
                        <div>2. <strong>Minum air</strong> 2-3 liter per hari</div>
                        <div>3. <strong>Makan perlahan</strong>, kunyah dengan baik</div>
                        <div>4. <strong>Protein setiap makan</strong> untuk kenyang lebih lama</div>
                        <div>5. <strong>Sayuran</strong> setengah piring setiap makan</div>
                    </div>
                    
                    <div class="food-recommendation mt-3">
                        <p><strong>Langkah Awal yang Praktis:</strong></p>
                        <div>1. Hitung kebutuhan kalori (saya bantu!)</div>
                        <div>2. Mulai tracking makanan 3 hari pertama</div>
                        <div>3. Fokus pada protein dan serat</div>
                        <div>4. Kurangi minuman manis bertahap</div>
                        <div>5. Tambahkan jalan kaki 30 menit/hari</div>
                    </div>
                    
                    <p class="mt-3">🎯 <strong>Target realistis:</strong> 0.5-1kg per minggu untuk penurunan berat badan yang sehat dan berkelanjutan.</p>
                `;
            }
            
            if (lowerMsg.includes('upload') || lowerMsg.includes('gambar') || lowerMsg.includes('foto')) {
                return `
                    <p>📸 <strong>Analisis Gambar Makanan:</strong></p>
                    <p>Saya menggunakan teknologi AI canggih untuk menganalisis foto makanan Anda:</p>
                    
                    <div class="nutrition-tip">
                        <div>✅ <strong>Estimasi kalori</strong> berdasarkan jenis dan porsi makanan</div>
                        <div>✅ <strong>Identifikasi nutrisi</strong> (protein, karbohidrat, lemak)</div>
                        <div>✅ <strong>Rekomendasi porsi</strong> sesuai target Anda</div>
                        <div>✅ <strong>Tips modifikasi</strong> untuk versi lebih sehat</div>
                    </div>
                    
                    <p class="mt-3"><strong>Cara menggunakan:</strong></p>
                    <ol>
                        <li>Klik tombol 📸 di bawah</li>
                        <li>Ambil foto makanan atau pilih dari galeri</li>
                        <li>Tunggu analisis 2-3 detik</li>
                        <li>Dapatkan analisis nutrisi lengkap!</li>
                    </ol>
                    
                    <div class="text-center mt-3">
                        <button class="quick-reply-btn" onclick="showImageUploadModal()">
                            <i class="fas fa-camera me-1"></i> Ambil/Upload Foto
                        </button>
                    </div>
                `;
            }
            
            if (lowerMsg.includes('bmr') || lowerMsg.includes('tdee')) {
                return `
                    <p>📊 <strong>Memahami BMR dan TDEE:</strong></p>
                    
                    <div class="nutrition-tip">
                        <p><strong>BMR (Basal Metabolic Rate):</strong></p>
                        <div>• Kalori yang tubuh bakar saat istirahat total (tidur)</div>
                        <div>• Untuk fungsi dasar: bernapas, sirkulasi darah, sel regenerasi</div>
                        <div>• Sekitar 60-70% total pengeluaran kalori harian</div>
                    </div>
                    
                    <div class="food-recommendation mt-3">
                        <p><strong>TDEE (Total Daily Energy Expenditure):</strong></p>
                        <div>• Total kalori yang tubuh bakar dalam sehari</div>
                        <div>• Termasuk BMR + aktivitas fisik + pencernaan makanan</div>
                        <div>• Angka ini menentukan kebutuhan kalori harian Anda</div>
                    </div>
                    
                    <p class="mt-3"><strong>Contoh:</strong></p>
                    <div>BMR Anda: 1600 kkal</div>
                    <div>Aktivitas fisik: 400 kkal</div>
                    <div>Pencernaan: 100 kkal</div>
                    <div><strong>TDEE: 2100 kkal</strong></div>
                `;
            }
            
            // Default welcome response
            return `
                <p>Saya bisa membantu Anda memulai perjalanan nutrisi yang sehat dengan:</p>
                
                <div class="d-flex flex-wrap gap-2 mt-3">
                    <button class="quick-reply-btn" onclick="sendWelcomeQuickReply('Bagaimana cara menghitung kebutuhan kalori?')">
                        🧮 Hitung Kebutuhan Kalori
                    </button>
                    <button class="quick-reply-btn" onclick="sendWelcomeQuickReply('Tips diet sehat untuk pemula')">
                        💡 Tips Diet Pemula
                    </button>
                    <button class="quick-reply-btn" onclick="showImageUploadModal()">
                        📸 Analisis Foto Makanan
                    </button>
                    <button class="quick-reply-btn" onclick="sendWelcomeQuickReply('Apa itu BMR dan TDEE?')">
                        📊 Penjelasan BMR & TDEE
                    </button>
                </div>
                
                <p class="mt-3">Atau tanyakan langsung tentang nutrisi, diet, dan gaya hidup sehat!</p>
            `;
        }

        function addFoodFromChat(name, calories, protein, carbs, fat, portion = "1 porsi") {
            const time = new Date().toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' });
            foodLog.push({
                name,
                calories,
                protein,
                carbs,
                fat,
                portion,
                time,
                mealTime: getCurrentMealTime()
            });
            
            saveData();
            updateDashboard();
            
            // Update chat with confirmation
            const chatContainer = document.getElementById('chatContainer');
            const botMessageDiv = document.createElement('div');
            botMessageDiv.className = 'chat-message bot-message';
            botMessageDiv.innerHTML = `
                <div class="message-avatar">
                    <i class="fas fa-robot"></i>
                </div>
                <div class="message-content">
                    <strong>NutriBot</strong>
                    <div class="mt-2">
                        <p>✅ <strong>${name}</strong> telah ditambahkan ke log harian Anda!</p>
                        <div class="food-recommendation">
                            <div class="d-flex justify-content-between">
                                <span>Waktu:</span>
                                <strong>${time} (${getCurrentMealTime()})</strong>
                            </div>
                            <div class="d-flex justify-content-between mt-1">
                                <span>Kalori:</span>
                                <strong class="text-green">${calories} kkal</strong>
                            </div>
                            <div class="d-flex justify-content-between mt-1">
                                <span>Protein:</span>
                                <strong>${protein}g</strong>
                            </div>
                        </div>
                    </div>
                    <button class="quick-reply-btn mt-2" onclick="showDashboard()">
                        <i class="fas fa-chart-bar me-1"></i> Lihat Dashboard
                    </button>
                </div>
            `;
            chatContainer.appendChild(botMessageDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
            
            showToast('✅ Berhasil!', `${name} telah ditambahkan ke log makanan`);
        }

        // Upload Functionalities
        function showImageUploadModal() {
            const modal = new bootstrap.Modal(document.getElementById('uploadModal'));
            modal.show();
            
            // Reset modal
            document.getElementById('previewContainer').classList.add('d-none');
            document.getElementById('filePreview').innerHTML = '';
            document.getElementById('uploadBtn').disabled = true;
            document.getElementById('fileDescription').value = '';
            document.getElementById('analysisType').value = 'nutrition';
            
            // Setup drag and drop
            setupDragAndDrop();
        }

        function showDocumentUpload() {
            showImageUploadModal();
            document.getElementById('analysisType').value = 'label';
        }

        function setupDragAndDrop() {
            const uploadArea = document.getElementById('uploadArea');
            const fileInput = document.getElementById('fileInput');
            
            uploadArea.addEventListener('click', () => fileInput.click());
            
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('active');
            });
            
            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('active');
            });
            
            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('active');
                
                if (e.dataTransfer.files.length) {
                    fileInput.files = e.dataTransfer.files;
                    previewFile(e.dataTransfer.files[0]);
                }
            });
            
            fileInput.addEventListener('change', (e) => {
                if (e.target.files.length) {
                    previewFile(e.target.files[0]);
                }
            });
        }

        function previewFile(file) {
            if (!file) return;
            
            // Check file size (max 5MB)
            if (file.size > 5 * 1024 * 1024) {
                showToast('⚠️ File Terlalu Besar', 'Maksimum 5MB per file.');
                return;
            }
            
            const previewContainer = document.getElementById('previewContainer');
            const filePreview = document.getElementById('filePreview');
            
            previewContainer.classList.remove('d-none');
            
            if (file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    filePreview.innerHTML = `
                        <div class="text-center">
                            <img src="${e.target.result}" 
                                 style="max-width: 200px; max-height: 150px; border-radius: 8px; border: 2px solid var(--primary-green);"
                                 class="img-fluid">
                            <p class="mt-2 mb-0"><strong>${file.name}</strong></p>
                            <p class="text-muted small">${(file.size / 1024).toFixed(2)} KB • ${file.type}</p>
                        </div>
                    `;
                };
                reader.readAsDataURL(file);
            } else {
                filePreview.innerHTML = `
                    <div class="text-center">
                        <i class="fas fa-file-alt" style="font-size: 48px; color: var(--primary-pink);"></i>
                        <p class="mt-2 mb-0"><strong>${file.name}</strong></p>
                        <p class="text-muted small">${(file.size / 1024).toFixed(2)} KB • ${file.type}</p>
                    </div>
                `;
            }
            
            document.getElementById('uploadBtn').disabled = false;
        }

        async function processUploadedFile() {
            const fileInput = document.getElementById('fileInput');
            const analysisType = document.getElementById('analysisType').value;
            const description = document.getElementById('fileDescription').value;
            
            if (!fileInput.files.length) {
                showToast('⚠️ File Kosong', 'Pilih file terlebih dahulu!');
                return;
            }
            
            const file = fileInput.files[0];
            const uploadBtn = document.getElementById('uploadBtn');
            
            // Show loading
            uploadBtn.disabled = true;
            uploadBtn.querySelector('i').classList.remove('d-none');
            
            try {
                // Simulate processing delay
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                // Determine which chat container to use
                let chatContainer;
                let isWelcomeChat = false;
                
                if (currentChatType === 'welcome' || document.getElementById('welcomeChatbotModal').classList.contains('show')) {
                    chatContainer = document.getElementById('welcomeChatContainer');
                    isWelcomeChat = true;
                } else {
                    chatContainer = document.getElementById('chatContainer');
                }
                
                // Add user message with file info
                const userMessageDiv = document.createElement('div');
                userMessageDiv.className = 'chat-message user-message';
                userMessageDiv.innerHTML = `
                    <div class="message-avatar">
                        ${isWelcomeChat ? '<i class="fas fa-user"></i>' : (userData.name ? userData.name.charAt(0) : '<i class="fas fa-user"></i>')}
                    </div>
                    <div class="message-content">
                        <strong>${isWelcomeChat ? 'Anda' : (userData.name || 'Anda')}</strong>
                        <div class="mt-2">
                            <p><i class="fas fa-paperclip me-1"></i> <strong>${file.name}</strong></p>
                            ${description ? `<p><em>"${description}"</em></p>` : ''}
                            <small class="opacity-75">${file.type.startsWith('image/') ? '🖼️ Gambar' : '📄 Dokumen'} • ${getAnalysisTypeText(analysisType)}</small>
                        </div>
                    </div>
                `;
                chatContainer.appendChild(userMessageDiv);
                
                // Process based on file type and analysis type
                const response = await analyzeUploadedFile(file, analysisType, description);
                
                // Add bot response
                const botMessageDiv = document.createElement('div');
                botMessageDiv.className = 'chat-message bot-message';
                botMessageDiv.innerHTML = `
                    <div class="message-avatar">
                        <i class="fas fa-robot"></i>
                    </div>
                    <div class="message-content">
                        <strong>NutriBot</strong>
                        <div class="mt-2">${response}</div>
                    </div>
                `;
                
                chatContainer.appendChild(botMessageDiv);
                chatContainer.scrollTop = chatContainer.scrollHeight;
                
                // Add to chat history
                chatHistory.push({
                    type: 'file',
                    fileName: file.name,
                    analysisType: analysisType,
                    description: description,
                    response: response
                });
                
                // Close modal
                bootstrap.Modal.getInstance(document.getElementById('uploadModal')).hide();
                
                showToast('📊 Analisis Selesai', 'File berhasil dianalisis!');
                
            } catch (error) {
                console.error('Upload error:', error);
                showToast('⚠️ Error', 'Terjadi kesalahan saat memproses file.');
            } finally {
                // Reset button
                uploadBtn.disabled = false;
                uploadBtn.querySelector('i').classList.add('d-none');
                
                // Reset form
                document.getElementById('fileInput').value = '';
                document.getElementById('fileDescription').value = '';
                document.getElementById('previewContainer').classList.add('d-none');
            }
        }

        function getAnalysisTypeText(type) {
            const types = {
                'nutrition': 'Analisis Nutrisi',
                'label': 'Analisis Label',
                'recipe': 'Analisis Resep',
                'general': 'Analisis Umum'
            };
            return types[type] || 'Analisis';
        }

        async function analyzeUploadedFile(file, analysisType, description) {
            const fileType = file.type;
            
            if (fileType.startsWith('image/')) {
                return analyzeImageFile(file, analysisType, description);
            } else {
                return analyzeDocumentFile(file, analysisType, description);
            }
        }

        function analyzeImageFile(file, analysisType, description) {
            const mockResponses = {
                'nutrition': `
                    <p>🔍 <strong>Analisis Nutrisi dari Gambar Makanan:</strong></p>
                    
                    <div class="nutrition-tip">
                        <p><strong>📸 Hasil Deteksi Gambar:</strong></p>
                        <div>• Makanan: <strong>Nasi Goreng dengan Ayam dan Sayuran</strong></div>
                        <div>• Estimasi porsi: <strong>1 porsi sedang</strong></div>
                        <div>• Waktu makan: <strong>Makan siang</strong></div>
                    </div>
                    
                    <div class="food-recommendation mt-3">
                        <p><strong>📊 Estimasi Nutrisi (per porsi):</strong></p>
                        <div class="d-flex justify-content-between">
                            <span>🔥 Total Kalori:</span>
                            <strong class="text-green">450-550 kkal</strong>
                        </div>
                        <div class="d-flex justify-content-between mt-1">
                            <span>🥩 Protein:</span>
                            <strong>20-25g</strong>
                        </div>
                        <div class="d-flex justify-content-between mt-1">
                            <span>🍚 Karbohidrat:</span>
                            <strong>55-65g</strong>
                        </div>
                        <div class="d-flex justify-content-between mt-1">
                            <span>🥑 Lemak:</span>
                            <strong>15-20g</strong>
                        </div>
                    </div>
                    
                    <div class="nutrition-tip mt-3">
                        <p><strong>💡 Rekomendasi Nutrisi:</strong></p>
                        <div>✅ Komposisi cukup seimbang</div>
                        <div>✅ Protein dari ayam cukup baik</div>
                        <div>⚠️ Perhatikan kandungan minyak/margarin</div>
                        <div>💡 Tambahkan sayuran lebih banyak</div>
                    </div>
                    
                    <button class="quick-reply-btn mt-3" onclick="addMockFoodFromImage()">
                        <i class="fas fa-plus me-1"></i> Tambahkan ke Log (500 kkal)
                    </button>
                `,
                'label': `
                    <p>📄 <strong>Analisis Label Makanan:</strong></p>
                    
                    <div class="nutrition-tip">
                        <p><strong>🏷️ Informasi Produk:</strong></p>
                        <div>• Produk: <strong>Susu Almond Organik</strong></div>
                        <div>• Merek: <strong>AlmondFresh</strong></div>
                        <div>• Ukuran sajian: <strong>250ml</strong></div>
                        <div>• Servings per container: <strong>4</strong></div>
                    </div>
                    
                    <div class="food-recommendation mt-3">
                        <p><strong>📊 Fakta Nutrisi (per 250ml):</strong></p>
                        <div class="d-flex justify-content-between">
                            <span>Energi:</span>
                            <strong class="text-green">120 kkal</strong>
                        </div>
                        <div class="d-flex justify-content-between mt-1">
                            <span>Lemak Total:</span>
                            <strong>5g</strong>
                        </div>
                        <div class="d-flex justify-content-between mt-1">
                            <span>Lemak Jenuh:</span>
                            <strong>0.5g</strong>
                        </div>
                        <div class="d-flex justify-content-between mt-1">
                            <span>Karbohidrat:</span>
                            <strong>15g</strong>
                        </div>
                        <div class="d-flex justify-content-between mt-1">
                            <span>Gula:</span>
                            <strong>8g</strong>
                        </div>
                        <div class="d-flex justify-content-between mt-1">
                            <span>Protein:</span>
                            <strong>3g</strong>
                        </div>
                        <div class="d-flex justify-content-between mt-1">
                            <span>Serat:</span>
                            <strong>2g</strong>
                        </div>
                        <div class="d-flex justify-content-between mt-1">
                            <span>Natrium:</span>
                            <strong>180mg</strong>
                        </div>
                    </div>
                    
                    <div class="nutrition-tip mt-3">
                        <p><strong>💡 Analisis Kesehatan:</strong></p>
                        <div>✅ Rendah lemak jenuh (baik untuk jantung)</div>
                        <div>✅ Sumber kalsium (30% kebutuhan harian)</div>
                        <div>⚠️ Perhatikan kandungan gula tambahan</div>
                        <div>✅ Cocok untuk vegetarian dan vegan</div>
                    </div>
                `,
                'recipe': `
                    <p>📋 <strong>Analisis Resep Makanan:</strong></p>
                    
                    <div class="nutrition-tip">
                        <p><strong>🍲 Resep Terdeteksi:</strong></p>
                        <div>• Nama: <strong>Smoothie Bowl Berry Protein</strong></div>
                        <div>• Jenis: <strong>Sarapan/Makanan Ringan</strong></div>
                        <div>• Tingkat kesulitan: <strong>Mudah</strong></div>
                        <div>• Waktu persiapan: <strong>10 menit</strong></div>
                        <div>• Untuk: <strong>2 porsi</strong></div>
                    </div>
                    
                    <div class="food-recommendation mt-3">
                        <p><strong>📊 Nutrisi per Porsi:</strong></p>
                        <div class="d-flex justify-content-between">
                            <span>🔥 Kalori:</span>
                            <strong class="text-green">280 kkal</strong>
                        </div>
                        <div class="d-flex justify-content-between mt-1">
                            <span>🥩 Protein:</span>
                            <strong>18g</strong>
                        </div>
                        <div class="d-flex justify-content-between mt-1">
                            <span>🍚 Karbohidrat:</span>
                            <strong>35g</strong>
                        </div>
                        <div class="d-flex justify-content-between mt-1">
                            <span>🥑 Lemak:</span>
                            <strong>8g</strong>
                        </div>
                        <div class="d-flex justify-content-between mt-1">
                            <span>🥬 Serat:</span>
                            <strong>7g</strong>
                        </div>
                    </div>
                    
                    <div class="nutrition-tip mt-3">
                        <p><strong>💡 Rekomendasi Penyajian:</strong></p>
                        <div>• Cocok untuk sarapan atau post-workout</div>
                        <div>• Tinggi protein untuk pemulihan otot</div>
                        <div>• Kaya serat untuk pencernaan sehat</div>
                        <div>• Sumber antioksidan dari buah berry</div>
                    </div>
                    
                    <button class="quick-reply-btn mt-3" onclick="sendQuickReply('Resep smoothie sehat')">
                        <i class="fas fa-utensils me-1"></i> Lihat Resep Lengkap
                    </button>
                `,
                'general': `
                    <p>📸 <strong>Analisis Gambar Makanan Umum:</strong></p>
                    
                    <div class="nutrition-tip">
                        <p><strong>🔍 Hasil Deteksi:</strong></p>
                        <div>• Jenis makanan: <strong>Makanan Seimbang (Protein + Karbo + Sayur)</strong></div>
                        <div>• Komposisi visual: <strong>40% sayuran, 30% protein, 30% karbohidrat</strong></div>
                        <div>• Tingkat kesehatan: <strong>Tinggi (9/10)</strong></div>
                        <div>• Cocok untuk: <strong>Makan siang atau makan malam</strong></div>
                    </div>
                    
                    <div class="food-recommendation mt-3">
                        <p><strong>📊 Estimasi Nutrisi:</strong></p>
                        <div class="d-flex justify-content-between">
                            <span>Kalori total:</span>
                            <strong class="text-green">400-500 kkal</strong>
                        </div>
                        <div class="d-flex justify-content-between mt-1">
                            <span>Protein:</span>
                            <strong>25-30g</strong>
                        </div>
                        <div class="d-flex justify-content-between mt-1">
                            <span>Karbohidrat:</span>
                            <strong>40-50g</strong>
                        </div>
                        <div class="d-flex justify-content-between mt-1">
                            <span>Lemak:</span>
                            <strong>10-15g</strong>
                        </div>
                    </div>
                    
                    <div class="nutrition-tip mt-3">
                        <p><strong>✅ Poin Positif:</strong></p>
                        <div>• Komposisi makanan sangat seimbang</div>
                        <div>• Variasi warna sayuran menunjukkan nutrisi beragam</div>
                        <div>• Protein dari sumber yang baik (ayam/ikan)</div>
                        <div>• Porsi yang tepat untuk sekali makan</div>
                    </div>
                    
                    <div class="food-recommendation mt-3">
                        <p><strong>💡 Saran Penyempurnaan:</strong></p>
                        <div>• Tambahkan lemak sehat (alpukat, minyak zaitun)</div>
                        <div>• Gunakan nasi merah untuk serat lebih tinggi</div>
                        <div>• Tambahkan rempah untuk antioksidan</div>
                    </div>
                `
            };
            
            return mockResponses[analysisType] || mockResponses['general'];
        }

        function analyzeDocumentFile(file, analysisType, description) {
            const mockResponses = {
                'label': `
                    <p>📄 <strong>Analisis Dokumen Label Nutrisi:</strong></p>
                    
                    <div class="nutrition-tip">
                        <p><strong>🏭 Informasi Produk:</strong></p>
                        <div>• Produk: <strong>Protein Bar Chocolate</strong></div>
                        <div>• Merek: <strong>FitFuel</strong></div>
                        <div>• Berat bersih: <strong>60g per bar</strong></div>
                        <div>• Kategori: <strong>Makanan ringan sehat</strong></div>
                    </div>
                    
                    <div class="food-recommendation mt-3">
                        <p><strong>📊 Komposisi Nutrisi (per 60g):</strong></p>
                        <div class="d-flex justify-content-between">
                            <span>Energi:</span>
                            <strong class="text-green">220 kkal</strong>
                        </div>
                        <div class="d-flex justify-content-between mt-1">
                            <span>Lemak Total:</span>
                            <strong>7g</strong>
                        </div>
                        <div class="d-flex justify-content-between mt-1">
                            <span>Lemak Jenuh:</span>
                            <strong>3g</strong>
                        </div>
                        <div class="d-flex justify-content-between mt-1">
                            <span>Karbohidrat:</span>
                            <strong>24g</strong>
                        </div>
                        <div class="d-flex justify-content-between mt-1">
                            <span>Gula:</span>
                            <strong>5g</strong>
                        </div>
                        <div class="d-flex justify-content-between mt-1">
                            <span>Protein:</span>
                            <strong>20g</strong>
                        </div>
                        <div class="d-flex justify-content-between mt-1">
                            <span>Serat:</span>
                            <strong>8g</strong>
                        </div>
                        <div class="d-flex justify-content-between mt-1">
                            <span>Natrium:</span>
                            <strong>120mg</strong>
                        </div>
                    </div>
                    
                    <div class="nutrition-tip mt-3">
                        <p><strong>💡 Penilaian Nutrisi:</strong></p>
                        <div>✅ Rasio protein tinggi (baik untuk otot)</div>
                        <div>✅ Serat tinggi (membantu pencernaan)</div>
                        <div>✅ Gula rendah (lebih sehat)</div>
                        <div>⚠️ Lemak jenuh agak tinggi</div>
                        <div>✅ Cocok sebagai snack post-workout</div>
                    </div>
                    
                    <p class="mt-3"><strong>⭐ Rating Kesehatan: 8/10</strong></p>
                `,
                'recipe': `
                    <p>📋 <strong>Analisis Dokumen Resep:</strong></p>
                    
                    <div class="nutrition-tip">
                        <p><strong>🍳 Resep Terdeteksi:</strong></p>
                        <div>• Nama: <strong>Omelet Sayuran Tinggi Protein</strong></div>
                        <div>• Waktu: <strong>Sarapan</strong></div>
                        <div>• Porsi: <strong>Untuk 2 orang</strong></div>
                        <div>• Level: <strong>Pemula</strong></div>
                        <div>• Diet: <strong>Rendah karbo, tinggi protein</strong></div>
                    </div>
                    
                    <div class="food-recommendation mt-3">
                        <p><strong>🥗 Bahan Utama:</strong></p>
                        <div>• Telur: 4 butir</div>
                        <div>• Bayam: 100g</div>
                        <div>• Jamur: 50g</div>
                        <div>• Paprika: 1 buah</div>
                        <div>• Keju parut: 30g</div>
                        <div>• Minyak zaitun: 1 sdm</div>
                    </div>
                    
                    <div class="food-recommendation mt-3">
                        <p><strong>📊 Nutrisi per Porsi:</strong></p>
                        <div class="d-flex justify-content-between">
                            <span>🔥 Kalori:</span>
                            <strong class="text-green">320 kkal</strong>
                        </div>
                        <div class="d-flex justify-content-between mt-1">
                            <span>🥩 Protein:</span>
                            <strong>25g</strong>
                        </div>
                        <div class="d-flex justify-content-between mt-1">
                            <span>🍚 Karbohidrat:</span>
                            <strong>8g</strong>
                        </div>
                        <div class="d-flex justify-content-between mt-1">
                            <span>🥑 Lemak:</span>
                            <strong>22g</strong>
                        </div>
                        <div class="d-flex justify-content-between mt-1">
                            <span>🥬 Serat:</span>
                            <strong>4g</strong>
                        </div>
                    </div>
                    
                    <div class="nutrition-tip mt-3">
                        <p><strong>💡 Keunggulan Resep:</strong></p>
                        <div>✅ Protein tinggi untuk kenyang lama</div>
                        <div>✅ Sayuran beragam untuk vitamin</div>
                        <div>✅ Lemak sehat dari minyak zaitun</div>
                        <div>✅ Rendah karbohidrat</div>
                        <div>✅ Cepat dan mudah dibuat</div>
                    </div>
                    
                    <button class="quick-reply-btn mt-3" onclick="addFoodFromChat('Omelet Sayuran', 320, 25, 8, 22, '1 porsi')">
                        <i class="fas fa-plus me-1"></i> Tambahkan ke Log
                    </button>
                `,
                'general': `
                    <p>📄 <strong>Analisis Dokumen Nutrisi:</strong></p>
                    
                    <div class="nutrition-tip">
                        <p><strong>📚 Konten Terdeteksi:</strong></p>
                        <div>• Tipe: <strong>Panduan Nutrisi Dasar</strong></div>
                        <div>• Topik: <strong>Makronutrien (Protein, Karbo, Lemak)</strong></div>
                        <div>• Level: <strong>Pemula hingga Menengah</strong></div>
                        <div>• Sumber: <strong>Terpercaya</strong></div>
                    </div>
                    
                    <div class="food-recommendation mt-3">
                        <p><strong>💡 Ringkasan Konten:</strong></p>
                        <div>• <strong>Protein:</strong> 1-1.5g per kg berat badan untuk umum, 2g+ untuk atlet</div>
                        <div>• <strong>Karbohidrat:</strong> 45-65% total kalori, pilih kompleks</div>
                        <div>• <strong>Lemak:</strong> 20-35% total kalori, fokus lemak sehat</div>
                        <div>• <strong>Serat:</strong> Minimal 25g per hari</div>
                        <div>• <strong>Air:</strong> 2-3 liter per hari</div>
                    </div>
                    
                    <div class="nutrition-tip mt-3">
                        <p><strong>✅ Poin Penting:</strong></p>
                        <div>• Kualitas nutrisi lebih penting dari kuantitas</div>
                        <div>• Variasi makanan kunci untuk mikronutrien</div>
                        <div>• Konsistensi lebih penting dari kesempurnaan</div>
                        <div>• Sesuaikan dengan kebutuhan individu</div>
                    </div>
                    
                    <button class="quick-reply-btn mt-3" onclick="sendQuickReply('Tips nutrisi dasar')">
                        <i class="fas fa-graduation-cap me-1"></i> Pelajari Lebih Lanjut
                    </button>
                `
            };
            
            return mockResponses[analysisType] || mockResponses['general'];
        }

        function addMockFoodFromImage() {
            const time = new Date().toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' });
            foodLog.push({
                name: "Nasi Goreng (Analisis Gambar)",
                calories: 500,
                protein: 22,
                carbs: 60,
                fat: 18,
                portion: "1 porsi",
                time: time,
                mealTime: getCurrentMealTime()
            });
            saveData();
            updateDashboard();
            
            // Update chat with confirmation
            const chatContainer = document.getElementById('chatContainer');
            const botMessageDiv = document.createElement('div');
            botMessageDiv.className = 'chat-message bot-message';
            botMessageDiv.innerHTML = `
                <div class="message-avatar">
                    <i class="fas fa-robot"></i>
                </div>
                <div class="message-content">
                    <strong>NutriBot</strong>
                    <div class="mt-2">
                        <p>✅ <strong>Makanan dari analisis gambar berhasil ditambahkan!</strong></p>
                        <div class="food-recommendation">
                            <div class="d-flex justify-content-between">
                                <span>Nama:</span>
                                <strong>Nasi Goreng (Analisis Gambar)</strong>
                            </div>
                            <div class="d-flex justify-content-between mt-1">
                                <span>Kalori:</span>
                                <strong class="text-green">500 kkal</strong>
                            </div>
                            <div class="d-flex justify-content-between mt-1">
                                <span>Protein:</span>
                                <strong>22g</strong>
                            </div>
                            <div class="d-flex justify-content-between mt-1">
                                <span>Waktu:</span>
                                <strong>${time}</strong>
                            </div>
                        </div>
                    </div>
                    <button class="quick-reply-btn mt-2" onclick="showDashboard()">
                        <i class="fas fa-chart-bar me-1"></i> Lihat Dashboard
                    </button>
                </div>
            `;
            chatContainer.appendChild(botMessageDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
            
            showToast('✅ Berhasil!', 'Makanan dari analisis gambar ditambahkan');
        }

        // Export data function
        function exportData() {
            const data = {
                userData,
                foodLog,
                communityData: {
                    posts: communityPosts,
                    challenges: communityChallenges,
                    groups: communityGroups,
                    friends: communityFriends,
                    leaderboard: communityLeaderboard,
                    achievements: userAchievements
                },
                exportDate: new Date().toISOString(),
                totalCalories: foodLog.reduce((sum, f) => sum + f.calories, 0)
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `bitecount-data-${new Date().toISOString().split('T')[0]}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            showToast('📤 Data Diekspor', 'Data berhasil diunduh sebagai file JSON');
        }

        // Initialize upload area when modal shown
        document.getElementById('uploadModal').addEventListener('shown.bs.modal', function () {
            setupDragAndDrop();
        });

        // Dark mode toggle
        document.getElementById('darkModeSwitch')?.addEventListener('change', function(e) {
            if (e.target.checked) {
                document.body.style.background = 'linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)';
                document.body.style.color = '#f0f0f0';
            } else {
                document.body.style.background = '';
                document.body.style.color = '';
            }
        });

        // Community switch
        document.getElementById('communitySwitch')?.addEventListener('change', function(e) {
            if (!e.target.checked) {
                showToast('👥 Komunitas', 'Fitur komunitas telah dinonaktifkan');
            } else {
                showToast('👥 Komunitas', 'Fitur komunitas telah diaktifkan');
            }
        });
    </script>
</body>
</html>