<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BiteCount - Pelacak Kalori</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link rel="manifest" href="#" id="manifest-placeholder">
    <meta name="theme-color" content="#1a4d2e">
    <style>
        :root {
            --dark-green: #1a4d2e;
            --medium-green: #2d6a4f;
            --light-green: #52b788;
            --bright-pink: #ff006e;
            --light-pink: #ff4d94;
            --bg-light: #f8f9fa;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--dark-green) 0%, var(--medium-green) 100%);
            min-height: 100vh;
        }

        .gradient-bg {
            background: linear-gradient(135deg, var(--dark-green) 0%, var(--medium-green) 100%);
        }

        /* Auth Pages */
        .auth-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .auth-card {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
            max-width: 450px;
            width: 100%;
            animation: slideUp 0.5s ease-out;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .auth-header {
            background: linear-gradient(135deg, var(--bright-pink) 0%, var(--light-pink) 100%);
            padding: 40px 30px;
            text-align: center;
            color: white;
        }

        .auth-header h2 {
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 2rem;
        }

        .auth-header p {
            opacity: 0.9;
            font-size: 0.95rem;
        }

        .auth-body {
            padding: 40px 30px;
        }

        .form-control {
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 12px 15px;
            transition: all 0.3s;
        }

        .form-control:focus {
            border-color: var(--bright-pink);
            box-shadow: 0 0 0 0.2rem rgba(255, 0, 110, 0.15);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--bright-pink) 0%, var(--light-pink) 100%);
            border: none;
            border-radius: 10px;
            padding: 12px;
            font-weight: bold;
            transition: transform 0.2s;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 0, 110, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--medium-green) 0%, var(--light-green) 100%);
            border: none;
            border-radius: 10px;
            padding: 12px;
            font-weight: bold;
        }

        /* Main App */
        .app-container {
            display: none;
        }

        .app-header {
            background: linear-gradient(135deg, var(--dark-green) 0%, var(--medium-green) 100%);
            color: white;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }

        .app-header h1 {
            font-size: 1.8rem;
            font-weight: bold;
            margin: 0;
        }

        .app-content {
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .card {
            border: none;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            overflow: hidden;
            transition: transform 0.3s;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card-header {
            background: linear-gradient(135deg, var(--bright-pink) 0%, var(--light-pink) 100%);
            color: white;
            font-weight: bold;
            border: none;
            padding: 15px 20px;
        }

        .food-item {
            background: white;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
        }

        .food-item:hover {
            box-shadow: 0 5px 15px rgba(0,0,0,0.15);
            transform: translateX(5px);
        }

        .food-info h5 {
            color: var(--dark-green);
            margin: 0 0 5px 0;
            font-weight: bold;
        }

        .food-calories {
            background: linear-gradient(135deg, var(--bright-pink) 0%, var(--light-pink) 100%);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: bold;
        }

        .stats-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        .stats-number {
            font-size: 2.5rem;
            font-weight: bold;
            background: linear-gradient(135deg, var(--bright-pink) 0%, var(--light-pink) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .btn-delete {
            background: none;
            border: none;
            color: var(--bright-pink);
            font-size: 1.2rem;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .btn-delete:hover {
            transform: scale(1.2);
        }

        .social-search {
            background: linear-gradient(135deg, var(--light-green) 0%, var(--medium-green) 100%);
            color: white;
            border: none;
            border-radius: 10px;
            padding: 12px 20px;
            font-weight: bold;
            transition: all 0.3s;
        }

        .social-search:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(45, 106, 79, 0.4);
            color: white;
        }

        .meal-plan-item {
            background: linear-gradient(135deg, rgba(255, 0, 110, 0.1) 0%, rgba(255, 77, 148, 0.1) 100%);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            border-left: 4px solid var(--bright-pink);
        }

        @media (max-width: 768px) {
            .food-item {
                flex-direction: column;
                text-align: center;
                gap: 10px;
            }
        }

        .alert-custom {
            border-radius: 10px;
            border: none;
        }
    </style>
</head>
<body>
    <!-- Login Page -->
    <div id="loginPage" class="auth-container gradient-bg">
        <div class="auth-card">
            <div class="auth-header">
                <h2><i class="fas fa-utensils"></i> BiteCount</h2>
                <p>Kelola kalori makananmu dengan mudah</p>
            </div>
            <div class="auth-body">
                <form id="loginForm">
                    <div class="mb-3">
                        <label class="form-label">Email</label>
                        <input type="email" class="form-control" id="loginEmail" placeholder="nama@email.com" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Password</label>
                        <input type="password" class="form-control" id="loginPassword" placeholder="Minimal 6 karakter" required>
                    </div>
                    <div class="mb-3 form-check">
                        <input type="checkbox" class="form-check-input" id="rememberMe">
                        <label class="form-check-label" for="rememberMe">Ingat Saya</label>
                    </div>
                    <button type="submit" class="btn btn-primary w-100 mb-3">
                        <i class="fas fa-sign-in-alt"></i> Login
                    </button>
                    <div class="text-center">
                        <a href="#" id="showForgotPassword" style="color: var(--bright-pink);">Lupa Password?</a>
                    </div>
                    <hr>
                    <div class="text-center">
                        <p class="mb-2">Belum punya akun?</p>
                        <button type="button" class="btn btn-success w-100" id="showRegister">
                            <i class="fas fa-user-plus"></i> Daftar Sekarang
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Register Page -->
    <div id="registerPage" class="auth-container gradient-bg" style="display: none;">
        <div class="auth-card">
            <div class="auth-header">
                <h2><i class="fas fa-user-plus"></i> Daftar</h2>
                <p>Buat akun baru untuk memulai</p>
            </div>
            <div class="auth-body">
                <form id="registerForm">
                    <div class="mb-3">
                        <label class="form-label">Nama Lengkap</label>
                        <input type="text" class="form-control" id="registerName" placeholder="Nama Anda" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Email</label>
                        <input type="email" class="form-control" id="registerEmail" placeholder="nama@email.com" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Password</label>
                        <input type="password" class="form-control" id="registerPassword" placeholder="Minimal 6 karakter" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Konfirmasi Password</label>
                        <input type="password" class="form-control" id="registerConfirmPassword" placeholder="Ulangi password" required>
                    </div>
                    <button type="submit" class="btn btn-primary w-100 mb-3">
                        <i class="fas fa-check"></i> Daftar
                    </button>
                    <div class="text-center">
                        <p class="mb-0">Sudah punya akun? <a href="#" id="showLogin" style="color: var(--bright-pink);">Login di sini</a></p>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Forgot Password Page -->
    <div id="forgotPasswordPage" class="auth-container gradient-bg" style="display: none;">
        <div class="auth-card">
            <div class="auth-header">
                <h2><i class="fas fa-key"></i> Lupa Password</h2>
                <p>Reset password Anda</p>
            </div>
            <div class="auth-body">
                <form id="forgotPasswordForm">
                    <div class="mb-3">
                        <label class="form-label">Email</label>
                        <input type="email" class="form-control" id="forgotEmail" placeholder="nama@email.com" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Password Baru</label>
                        <input type="password" class="form-control" id="newPassword" placeholder="Minimal 6 karakter" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Konfirmasi Password Baru</label>
                        <input type="password" class="form-control" id="confirmNewPassword" placeholder="Ulangi password" required>
                    </div>
                    <button type="submit" class="btn btn-primary w-100 mb-3">
                        <i class="fas fa-sync"></i> Reset Password
                    </button>
                    <div class="text-center">
                        <a href="#" id="backToLogin" style="color: var(--bright-pink);">Kembali ke Login</a>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div id="appContainer" class="app-container">
        <div class="app-header">
            <div class="container-fluid">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h1><i class="fas fa-utensils"></i> BiteCount</h1>
                        <small>Selamat datang, <span id="userName"></span>!</small>
                    </div>
                    <button class="btn btn-outline-light" id="logoutBtn">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </button>
                </div>
            </div>
        </div>

        <div class="app-content">
            <!-- Stats -->
            <div class="row mb-4">
                <div class="col-md-4 mb-3">
                    <div class="stats-card">
                        <i class="fas fa-fire fa-3x mb-2" style="color: var(--bright-pink);"></i>
                        <div class="stats-number" id="totalCalories">0</div>
                        <p class="text-muted mb-0">Total Kalori Hari Ini</p>
                    </div>
                </div>
                <div class="col-md-4 mb-3">
                    <div class="stats-card">
                        <i class="fas fa-hamburger fa-3x mb-2" style="color: var(--light-green);"></i>
                        <div class="stats-number" id="totalMeals">0</div>
                        <p class="text-muted mb-0">Jumlah Makanan</p>
                    </div>
                </div>
                <div class="col-md-4 mb-3">
                    <div class="stats-card">
                        <i class="fas fa-calendar-check fa-3x mb-2" style="color: var(--medium-green);"></i>
                        <div class="stats-number" id="mealPlanCount">0</div>
                        <p class="text-muted mb-0">Meal Plan</p>
                    </div>
                </div>
            </div>

            <!-- Input Form -->
            <div class="card">
                <div class="card-header">
                    <i class="fas fa-plus-circle"></i> Tambah Makanan/Minuman
                </div>
                <div class="card-body">
                    <form id="foodForm">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Nama Makanan/Minuman</label>
                                <input type="text" class="form-control" id="foodName" placeholder="Contoh: Nasi Goreng" required>
                            </div>
                            <div class="col-md-3 mb-3">
                                <label class="form-label">Kalori</label>
                                <input type="number" class="form-control" id="foodCalories" placeholder="0" required>
                            </div>
                            <div class="col-md-3 mb-3">
                                <label class="form-label">Porsi</label>
                                <input type="number" class="form-control" id="foodPortion" placeholder="1" value="1" required>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-plus"></i> Tambahkan
                        </button>
                    </form>
                </div>
            </div>

            <!-- Food List -->
            <div class="card">
                <div class="card-header">
                    <i class="fas fa-list"></i> Daftar Makanan Hari Ini
                </div>
                <div class="card-body">
                    <div id="foodList"></div>
                </div>
            </div>

            <!-- Meal Plan -->
            <div class="card">
                <div class="card-header">
                    <i class="fas fa-clipboard-list"></i> Meal Plan Saya
                </div>
                <div class="card-body">
                    <form id="mealPlanForm" class="mb-3">
                        <div class="row">
                            <div class="col-md-8 mb-2">
                                <input type="text" class="form-control" id="mealPlanName" placeholder="Contoh: Sarapan - Oatmeal & Buah" required>
                            </div>
                            <div class="col-md-4 mb-2">
                                <button type="submit" class="btn btn-success w-100">
                                    <i class="fas fa-plus"></i> Tambah Plan
                                </button>
                            </div>
                        </div>
                    </form>
                    <div id="mealPlanList"></div>
                </div>
            </div>

            <!-- Social Media Search -->
            <div class="card">
                <div class="card-header">
                    <i class="fas fa-dumbbell"></i> Cari Rekomendasi Olahraga
                </div>
                <div class="card-body text-center">
                    <p class="mb-3">Temukan inspirasi olahraga dari media sosial</p>
                    <div class="row g-3">
                        <div class="col-md-4">
                            <a href="https://www.youtube.com/results?search_query=olahraga+ringan+pemula" target="_blank" class="btn social-search w-100">
                                <i class="fab fa-youtube"></i> YouTube
                            </a>
                        </div>
                        <div class="col-md-4">
                            <a href="https://www.instagram.com/explore/tags/workout/" target="_blank" class="btn social-search w-100">
                                <i class="fab fa-instagram"></i> Instagram
                            </a>
                        </div>
                        <div class="col-md-4">
                            <a href="https://www.tiktok.com/search?q=workout%20routine" target="_blank" class="btn social-search w-100">
                                <i class="fab fa-tiktok"></i> TikTok
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script>
        // Simple hash function for password
        function simpleHash(str) {
            let hash = 0;
            for (let i = 0; i < str.length; i++) {
                const char = str.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash = hash & hash;
            }
            return hash.toString(36);
        }

        // Auth System
        class AuthSystem {
            constructor() {
                this.currentUser = null;
                this.init();
            }

            init() {
                this.checkSession();
                this.setupEventListeners();
            }

            setupEventListeners() {
                document.getElementById('loginForm').addEventListener('submit', (e) => this.handleLogin(e));
                document.getElementById('registerForm').addEventListener('submit', (e) => this.handleRegister(e));
                document.getElementById('forgotPasswordForm').addEventListener('submit', (e) => this.handleForgotPassword(e));
                document.getElementById('showRegister').addEventListener('click', () => this.showPage('register'));
                document.getElementById('showLogin').addEventListener('click', () => this.showPage('login'));
                document.getElementById('showForgotPassword').addEventListener('click', () => this.showPage('forgot'));
                document.getElementById('backToLogin').addEventListener('click', () => this.showPage('login'));
                document.getElementById('logoutBtn').addEventListener('click', () => this.logout());
            }

            showPage(page) {
                document.getElementById('loginPage').style.display = 'none';
                document.getElementById('registerPage').style.display = 'none';
                document.getElementById('forgotPasswordPage').style.display = 'none';
                document.getElementById('appContainer').style.display = 'none';

                if (page === 'login') {
                    document.getElementById('loginPage').style.display = 'flex';
                } else if (page === 'register') {
                    document.getElementById('registerPage').style.display = 'flex';
                } else if (page === 'forgot') {
                    document.getElementById('forgotPasswordPage').style.display = 'flex';
                } else if (page === 'app') {
                    document.getElementById('appContainer').style.display = 'block';
                }
            }

            handleRegister(e) {
                e.preventDefault();
                const name = document.getElementById('registerName').value;
                const email = document.getElementById('registerEmail').value;
                const password = document.getElementById('registerPassword').value;
                const confirmPassword = document.getElementById('registerConfirmPassword').value;

                if (password.length < 6) {
                    alert('Password harus minimal 6 karakter!');
                    return;
                }

                if (password !== confirmPassword) {
                    alert('Password tidak cocok!');
                    return;
                }

                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!emailRegex.test(email)) {
                    alert('Email tidak valid!');
                    return;
                }

                const users = JSON.parse(localStorage.getItem('bitecount_users') || '[]');
                
                if (users.find(u => u.email === email)) {
                    alert('Email sudah terdaftar!');
                    return;
                }

                const newUser = {
                    id: Date.now(),
                    name: name,
                    email: email,
                    password: simpleHash(password)
                };

                users.push(newUser);
                localStorage.setItem('bitecount_users', JSON.stringify(users));
                
                alert('Pendaftaran berhasil! Silakan login.');
                this.showPage('login');
                document.getElementById('registerForm').reset();
            }

            handleLogin(e) {
                e.preventDefault();
                const email = document.getElementById('loginEmail').value;
                const password = document.getElementById('loginPassword').value;
                const rememberMe = document.getElementById('rememberMe').checked;

                const users = JSON.parse(localStorage.getItem('bitecount_users') || '[]');
                const user = users.find(u => u.email === email && u.password === simpleHash(password));

                if (!user) {
                    alert('Email atau password salah!');
                    return;
                }

                this.currentUser = user;
                const sessionData = {
                    userId: user.id,
                    email: user.email,
                    name: user.name,
                    rememberMe: rememberMe
                };

                localStorage.setItem('bitecount_session', JSON.stringify(sessionData));
                
                document.getElementById('userName').textContent = user.name;
                this.showPage('app');
                app.loadUserData();
                document.getElementById('loginForm').reset();
            }

            handleForgotPassword(e) {
                e.preventDefault();
                const email = document.getElementById('forgotEmail').value;
                const newPassword = document.getElementById('newPassword').value;
                const confirmNewPassword = document.getElementById('confirmNewPassword').value;

                if (newPassword.length < 6) {
                    alert('Password harus minimal 6 karakter!');
                    return;
                }

                if (newPassword !== confirmNewPassword) {
                    alert('Password tidak cocok!');
                    return;
                }

                const users = JSON.parse(localStorage.getItem('bitecount_users') || '[]');
                const userIndex = users.findIndex(u => u.email === email);

                if (userIndex === -1) {
                    alert('Email tidak ditemukan!');
                    return;
                }

                users[userIndex].password = simpleHash(newPassword);
                localStorage.setItem('bitecount_users', JSON.stringify(users));

                alert('Password berhasil direset! Silakan login dengan password baru.');
                this.showPage('login');
                document.getElementById('forgotPasswordForm').reset();
            }

            checkSession() {
                const session = JSON.parse(localStorage.getItem('bitecount_session') || 'null');
                
                if (session && session.rememberMe) {
                    const users = JSON.parse(localStorage.getItem('bitecount_users') || '[]');
                    const user = users.find(u => u.id === session.userId);
                    
                    if (user) {
                        this.currentUser = user;
                        document.getElementById('userName').textContent = user.name;
                        this.showPage('app');
                        app.loadUserData();
                        return;
                    }
                }
                
                this.showPage('login');
            }

            logout() {
                if (confirm('Yakin ingin logout?')) {
                    localStorage.removeItem('bitecount_session');
                    this.currentUser = null;
                    this.showPage('login');
                }
            }

            getCurrentUserId() {
                return this.currentUser ? this.currentUser.id : null;
            }
        }

        // Main App
        class BiteCountApp {
            constructor() {
                this.foods = [];
                this.mealPlans = [];
                this.setupEventListeners();
            }

            setupEventListeners() {
                document.getElementById('foodForm').addEventListener('submit', (e) => this.addFood(e));
                document.getElementById('mealPlanForm').addEventListener('submit', (e) => this.addMealPlan(e));
            }

            loadUserData() {
                const userId = auth.getCurrentUserId();
                if (!userId) return;

                const userKey = `bitecount_data_${userId}`;
                const data = JSON.parse(localStorage.getItem(userKey) || '{"foods":[],"mealPlans":[]}');
                
                this.foods = data.foods || [];
                this.mealPlans = data.mealPlans || [];
                
                this.render();
            }

            saveUserData() {
                const userId = auth.getCurrentUserId();
                if (!userId) return;

                const userKey = `bitecount_data_${userId}`;
                const data = {
                    foods: this.foods,
                    mealPlans: this.mealPlans
                };
                
                localStorage.setItem(userKey, JSON.stringify(data));
            }

            addFood(e) {
                e.preventDefault();
                const name = document.getElementById('foodName').value;
                const calories = parseInt(document.getElementById('foodCalories').value);
                const portion = parseInt(document.getElementById('foodPortion').value);

                const food = {
                    id: Date.now(),
                    name: name,
                    calories: calories * portion,
                    portion: portion,
                    date: new Date().toLocaleDateString('id-ID')
                };

                this.foods.push(food);
                this.saveUserData();
                this.render();
                document.getElementById('foodForm').reset();
                document.getElementById('foodPortion').value = 1;
            }

            deleteFood(id) {
                if (confirm('Hapus makanan ini?')) {
                    this.foods = this.foods.filter(f => f.id !== id);
                    this.saveUserData();
                    this.render();
                }
            }

            addMealPlan(e) {
                e.preventDefault();
                const name = document.getElementById('mealPlanName').value;

                const plan = {
                    id: Date.now(),
                    name: name,
                    created: new Date().toLocaleDateString('id-ID')
                };

                this.mealPlans.push(plan);
                this.saveUserData();
                this.render();
                document.getElementById('mealPlanForm').reset();
            }

            deleteMealPlan(id) {
                if (confirm('Hapus meal plan ini?')) {
                    this.mealPlans = this.mealPlans.filter(m => m.id !== id);
                    this.saveUserData();
                    this.render();
                }
            }

            render() {
                // Render food list
                const foodList = document.getElementById('foodList');
                const today